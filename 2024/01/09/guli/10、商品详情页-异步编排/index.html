<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>Hexo | Hexo</title><meta name="author" content="John Doe"><meta name="copyright" content="John Doe"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="1. 商品详情当用户搜索到商品，肯定会点击查看，就会进入商品详情页，接下来我们完成商品详情页的展示。 商品详情浏览量比较大，并发高，我们会独立开启一个微服务，用来展示商品详情。 1.1. 创建module    pom.xml依赖： 12345678910111213141516171819202122232425262728293031323334353637383940414243444546">
<meta property="og:type" content="article">
<meta property="og:title" content="Hexo">
<meta property="og:url" content="https://beiliu266.github.io/2024/01/09/guli/10%E3%80%81%E5%95%86%E5%93%81%E8%AF%A6%E6%83%85%E9%A1%B5-%E5%BC%82%E6%AD%A5%E7%BC%96%E6%8E%92/index.html">
<meta property="og:site_name" content="Hexo">
<meta property="og:description" content="1. 商品详情当用户搜索到商品，肯定会点击查看，就会进入商品详情页，接下来我们完成商品详情页的展示。 商品详情浏览量比较大，并发高，我们会独立开启一个微服务，用来展示商品详情。 1.1. 创建module    pom.xml依赖： 12345678910111213141516171819202122232425262728293031323334353637383940414243444546">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://i.loli.net/2021/02/24/5O1day2nriDzjSu.png">
<meta property="article:published_time" content="2024-01-09T12:30:18.803Z">
<meta property="article:modified_time" content="2020-07-01T02:35:04.000Z">
<meta property="article:author" content="John Doe">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://i.loli.net/2021/02/24/5O1day2nriDzjSu.png"><link rel="shortcut icon" href="/img/favicon.png"><link rel="canonical" href="https://beiliu266.github.io/2024/01/09/guli/10%E3%80%81%E5%95%86%E5%93%81%E8%AF%A6%E6%83%85%E9%A1%B5-%E5%BC%82%E6%AD%A5%E7%BC%96%E6%8E%92/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox/fancybox.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  dateSuffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: undefined,
  infinitegrid: {
    js: 'https://cdn.jsdelivr.net/npm/@egjs/infinitegrid/dist/infinitegrid.min.js',
    buttonText: '加载更多'
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: false,
  },
  autoDarkmode: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'Hexo',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2020-07-01 10:35:04'
}</script><script>(win=>{
      win.saveToLocal = {
        set: (key, value, ttl) => {
          if (ttl === 0) return
          const now = Date.now()
          const expiry = now + ttl * 86400000
          const item = {
            value,
            expiry
          }
          localStorage.setItem(key, JSON.stringify(item))
        },
      
        get: key => {
          const itemStr = localStorage.getItem(key)
      
          if (!itemStr) {
            return undefined
          }
          const item = JSON.parse(itemStr)
          const now = Date.now()
      
          if (now > item.expiry) {
            localStorage.removeItem(key)
            return undefined
          }
          return item.value
        }
      }
    
      win.getScript = (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        script.onerror = reject
        script.onload = script.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          script.onload = script.onreadystatechange = null
          resolve()
        }

        Object.keys(attr).forEach(key => {
          script.setAttribute(key, attr[key])
        })

        document.head.appendChild(script)
      })
    
      win.getCSS = (url, id = false) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onerror = reject
        link.onload = link.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          link.onload = link.onreadystatechange = null
          resolve()
        }
        document.head.appendChild(link)
      })
    
      win.activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
        if (t === 'dark') activateDarkMode()
        else if (t === 'light') activateLightMode()
      
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
      const detectApple = () => {
        if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
          document.documentElement.classList.add('apple')
        }
      }
      detectApple()
    })(window)</script><meta name="generator" content="Hexo 7.0.0"></head><body><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="https://i.loli.net/2021/02/24/5O1day2nriDzjSu.png" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="sidebar-site-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">27</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">0</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">0</div></a></div><hr class="custom-hr"/></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header"><nav id="nav"><span id="blog-info"><a href="/" title="Hexo"><span class="site-name">Hexo</span></a></span><div id="menus"><div id="toggle-menu"><a class="site-page" href="javascript:void(0);"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">无题</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2024-01-09T12:30:18.803Z" title="发表于 2024-01-09 20:30:18">2024-01-09</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2020-07-01T02:35:04.000Z" title="更新于 2020-07-01 10:35:04">2020-07-01</time></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title=""><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><h1 id="1-商品详情"><a href="#1-商品详情" class="headerlink" title="1. 商品详情"></a>1. 商品详情</h1><p>当用户搜索到商品，肯定会点击查看，就会进入商品详情页，接下来我们完成商品详情页的展示。</p>
<p>商品详情浏览量比较大，并发高，我们会独立开启一个微服务，用来展示商品详情。</p>
<h2 id="1-1-创建module"><a href="#1-1-创建module" class="headerlink" title="1.1. 创建module"></a>1.1. 创建module</h2><p><img src="/assets/1568530059417.png" alt="1568530059417"></p>
<p><img src="/assets/1586073353159.png" alt="1586073353159"></p>
<p> <img src="/assets/1586075917607.png" alt="1586075917607"></p>
<p>pom.xml依赖：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">project</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0&quot;</span> <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0 https://maven.apache.org/xsd/maven-4.0.0.xsd&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">modelVersion</span>&gt;</span>4.0.0<span class="tag">&lt;/<span class="name">modelVersion</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">parent</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.atguigu<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>gmall<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>0.0.1-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">parent</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.atguigu<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>gmall-item<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>0.0.1-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">name</span>&gt;</span>gmall-item<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">description</span>&gt;</span>谷粒商城商品详情页<span class="tag">&lt;/<span class="name">description</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">java.version</span>&gt;</span>1.8<span class="tag">&lt;/<span class="name">java.version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.atguigu<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>gmall-pms-interface<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>0.0.1-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.atguigu<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>gmall-wms-interface<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>0.0.1-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.atguigu<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>gmall-sms-interface<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>0.0.1-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-alibaba-nacos-config<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-alibaba-nacos-discovery<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-alibaba-sentinel<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-openfeign<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-zipkin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-test<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">exclusions</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">exclusion</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.junit.vintage<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>junit-vintage-engine<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">exclusion</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">exclusions</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">build</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">plugins</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-maven-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">plugins</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">build</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>bootstrap.properties：</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">application:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">item-service</span></span><br><span class="line">  <span class="attr">cloud:</span></span><br><span class="line">    <span class="attr">nacos:</span></span><br><span class="line">      <span class="attr">config:</span></span><br><span class="line">        <span class="attr">server-addr:</span> <span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span><span class="string">:8848</span></span><br></pre></td></tr></table></figure>

<p>application.properties：</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">18088</span></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">cloud:</span></span><br><span class="line">    <span class="attr">nacos:</span></span><br><span class="line">      <span class="attr">discovery:</span></span><br><span class="line">        <span class="attr">server-addr:</span> <span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span><span class="string">:8848</span></span><br><span class="line">    <span class="attr">sentinel:</span></span><br><span class="line">      <span class="attr">transport:</span></span><br><span class="line">        <span class="attr">dashboard:</span> <span class="string">localhost:8080</span></span><br><span class="line">        <span class="attr">port:</span> <span class="number">8719</span></span><br><span class="line">  <span class="attr">zipkin:</span></span><br><span class="line">    <span class="attr">base-url:</span> <span class="string">http://localhost:9411</span></span><br><span class="line">    <span class="attr">discovery-client-enabled:</span> <span class="literal">false</span></span><br><span class="line">    <span class="attr">sender:</span></span><br><span class="line">      <span class="attr">type:</span> <span class="string">web</span></span><br><span class="line">  <span class="attr">sleuth:</span></span><br><span class="line">    <span class="attr">sampler:</span></span><br><span class="line">      <span class="attr">probability:</span> <span class="number">1</span></span><br><span class="line">  <span class="attr">redis:</span></span><br><span class="line">    <span class="attr">host:</span> <span class="number">172.16</span><span class="number">.116</span><span class="number">.100</span></span><br><span class="line"><span class="attr">feign:</span></span><br><span class="line">  <span class="attr">sentinel:</span></span><br><span class="line">    <span class="attr">enabled:</span> <span class="literal">true</span></span><br><span class="line"><span class="attr">logging:</span></span><br><span class="line">  <span class="attr">level:</span></span><br><span class="line">    <span class="attr">com.atguigu.gmall:</span> <span class="string">debug</span></span><br></pre></td></tr></table></figure>

<p>GmallItemApplication：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="meta">@EnableDiscoveryClient</span></span><br><span class="line"><span class="meta">@EnableFeignClients</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">GmallItemApplication</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        SpringApplication.run(GmallItemApplication.class, args);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>别忘了配置网关：</p>
<p><img src="/assets/1586076078719.png" alt="1586076078719"></p>
<h2 id="1-2-数据模型"><a href="#1-2-数据模型" class="headerlink" title="1.2. 数据模型"></a>1.2. 数据模型</h2><p>当点击搜索列表中的一个记录，会跳转到商品详情页。这个商品详情页是一个spu？还是<strong>sku</strong>？</p>
<p>以京东为例：</p>
<p>在京东搜索小米，出现搜索列表后。点击其中一条记录，跳转到商品详情页，这个商品详情页展示的是：</p>
<p><img src="/assets/1589709971270.png" alt="1589709971270"></p>
<p>结合页面，商品详情页需要的数据有：</p>
<p>面包屑信息：</p>
<ul>
<li>三级分类</li>
<li>品牌</li>
<li>spu的名称</li>
</ul>
<p>sku相关信息：</p>
<ul>
<li>sku的基本信息（标题、副标题、价格、大图片等）</li>
<li>sku的所有图片</li>
<li>sku的所有促销信息</li>
<li>sku的库存情况（是否有货）</li>
</ul>
<p>spu下所有销售组合：</p>
<ul>
<li>每个销售属性可取值集合，方便渲染可选值列表</li>
<li>当前商品的销售属性，方便渲染选中项</li>
<li>销售属性组合与skuId的映射关系，方便切换sku</li>
</ul>
<p>商品详情信息：</p>
<ul>
<li>spu的描述信息</li>
<li>spu的所有基本规格分组及规格参数</li>
</ul>
<p>最终设计如下：</p>
<p> <img src="/assets/1589710328081.png" alt="1589710328081"></p>
<p>商品详情页总的数据模型：ItemVO</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ItemVo</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 三级分类</span></span><br><span class="line">    <span class="keyword">private</span> List&lt;CategoryEntity&gt; categories;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 品牌</span></span><br><span class="line">    <span class="keyword">private</span> Long brandId;</span><br><span class="line">    <span class="keyword">private</span> String brandName;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// spu</span></span><br><span class="line">    <span class="keyword">private</span> Long spuId;</span><br><span class="line">    <span class="keyword">private</span> String spuName;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// sku</span></span><br><span class="line">    <span class="keyword">private</span> Long skuId;</span><br><span class="line">    <span class="keyword">private</span> String title;</span><br><span class="line">    <span class="keyword">private</span> String subTitle;</span><br><span class="line">    <span class="keyword">private</span> BigDecimal price;</span><br><span class="line">    <span class="keyword">private</span> Integer weight;</span><br><span class="line">    <span class="keyword">private</span> String defaltImage;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// sku图片</span></span><br><span class="line">    <span class="keyword">private</span> List&lt;SkuImagesEntity&gt; images;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 营销信息</span></span><br><span class="line">    <span class="keyword">private</span> List&lt;ItemSaleVo&gt; sales;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 是否有货</span></span><br><span class="line">    <span class="keyword">private</span> <span class="type">Boolean</span> <span class="variable">store</span> <span class="operator">=</span> <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// sku所属spu下的所有sku的销售属性</span></span><br><span class="line">    <span class="comment">// [&#123;attrId: 3, attrName: &#x27;颜色&#x27;, attrValues: &#x27;白色&#x27;,&#x27;黑色&#x27;,&#x27;粉色&#x27;&#125;,</span></span><br><span class="line">    <span class="comment">// &#123;attrId: 8, attrName: &#x27;内存&#x27;, attrValues: &#x27;6G&#x27;,&#x27;8G&#x27;,&#x27;12G&#x27;&#125;,</span></span><br><span class="line">    <span class="comment">// &#123;attrId: 9, attrName: &#x27;存储&#x27;, attrValues: &#x27;128G&#x27;,&#x27;256G&#x27;,&#x27;512G&#x27;&#125;]</span></span><br><span class="line">    <span class="keyword">private</span> List&lt;SaleAttrValueVo&gt; saleAttrs;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 当前sku的销售属性：&#123;3:&#x27;白色&#x27;,8:&#x27;8G&#x27;,9:&#x27;128G&#x27;&#125;</span></span><br><span class="line">    <span class="keyword">private</span> Map&lt;Long, String&gt; saleAttr;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// sku列表：&#123;&#x27;白色,8G,128G&#x27;: 4, &#x27;白色,8G,256G&#x27;: 5, &#x27;白色,8G,512G&#x27;: 6, &#x27;白色,12G,128G&#x27;: 7&#125;</span></span><br><span class="line">    <span class="keyword">private</span> String skusJson;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// spu的海报信息</span></span><br><span class="line">    <span class="keyword">private</span> List&lt;String&gt; spuImages;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 规格参数组及组下的规格参数(带值)</span></span><br><span class="line">    <span class="keyword">private</span> List&lt;ItemGroupVo&gt; groups;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ItemSaleVo：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ItemSaleVo</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> String type; <span class="comment">// 积分 满减 打折</span></span><br><span class="line">    <span class="keyword">private</span> String desc; <span class="comment">// 描述信息</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ItemGroupVo：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ItemGroupVo</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String groupName;</span><br><span class="line">    <span class="keyword">private</span> List&lt;AttrValueVo&gt; attrValues;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>AttrValueVo：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AttrValueVo</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Long attrId;</span><br><span class="line">    <span class="keyword">private</span> String attrName;</span><br><span class="line">    <span class="keyword">private</span> String attrValue;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>SaleAttrValueVo：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SaleAttrValueVo</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Long attrId;</span><br><span class="line">    <span class="keyword">private</span> String attrName;</span><br><span class="line">    <span class="keyword">private</span> Set&lt;String&gt; attrValues;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h2 id="1-3-远程调用接口"><a href="#1-3-远程调用接口" class="headerlink" title="1.3. 远程调用接口"></a>1.3. 远程调用接口</h2><p>跳转到商品详情页时，已知条件只有一个skuId。为渲染商品详情页，需要的远程数据结构提供数据：</p>
<ol>
<li><p>根据skuId查询sku（已有）</p>
</li>
<li><p>根据sku中的三级分类id查询一二三级分类</p>
</li>
<li><p>根据sku中的品牌id查询品牌（已有）</p>
</li>
<li><p>根据sku中的spuId查询spu信息（已有）</p>
</li>
<li><p>根据skuId查询sku所有图片</p>
</li>
<li><p>根据skuId查询sku的所有营销信息</p>
</li>
<li><p>根据skuId查询sku的库存信息（已有）</p>
</li>
<li><p>根据sku中的spuId查询spu下的所有销售属性</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">[</span></span><br><span class="line">  <span class="punctuation">&#123;</span></span><br><span class="line">	attrId<span class="punctuation">:</span> <span class="number">3</span><span class="punctuation">,</span></span><br><span class="line">	attrName<span class="punctuation">:</span> &#x27;颜色&#x27;<span class="punctuation">,</span></span><br><span class="line">	attrValues<span class="punctuation">:</span> <span class="punctuation">[</span>&#x27;白色&#x27;<span class="punctuation">,</span> &#x27;黑色&#x27;<span class="punctuation">,</span> &#x27;粉色&#x27;<span class="punctuation">]</span></span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="punctuation">&#123;</span></span><br><span class="line">	attrId<span class="punctuation">:</span> <span class="number">8</span><span class="punctuation">,</span></span><br><span class="line">	attrName<span class="punctuation">:</span> &#x27;内存&#x27;<span class="punctuation">,</span></span><br><span class="line">	attrValues<span class="punctuation">:</span> <span class="punctuation">[</span>&#x27;<span class="number">6</span>G&#x27;<span class="punctuation">,</span> &#x27;<span class="number">8</span>G&#x27;<span class="punctuation">,</span> &#x27;<span class="number">12</span>G&#x27;<span class="punctuation">]</span></span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="punctuation">&#123;</span></span><br><span class="line">	attrId<span class="punctuation">:</span> <span class="number">9</span><span class="punctuation">,</span></span><br><span class="line">	attrName<span class="punctuation">:</span> &#x27;存储&#x27;<span class="punctuation">,</span></span><br><span class="line">	attrValues<span class="punctuation">:</span> <span class="punctuation">[</span>&#x27;<span class="number">128</span>G&#x27;<span class="punctuation">,</span> &#x27;<span class="number">256</span>G&#x27;<span class="punctuation">,</span> &#x27;<span class="number">512</span>G&#x27;<span class="punctuation">]</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">]</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>根据skuId查询当前sku的销售属性</p>
</li>
<li><p>根据sku中的spuId查询spu下所有sku：销售属性组合与skuId映射关系</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span>&#x27;白色<span class="punctuation">,</span><span class="number">8</span>G<span class="punctuation">,</span><span class="number">128</span>G&#x27;<span class="punctuation">:</span> <span class="number">4</span><span class="punctuation">,</span> &#x27;白色<span class="punctuation">,</span><span class="number">8</span>G<span class="punctuation">,</span><span class="number">256</span>G&#x27;<span class="punctuation">:</span> <span class="number">5</span><span class="punctuation">,</span> &#x27;白色<span class="punctuation">,</span><span class="number">8</span>G<span class="punctuation">,</span><span class="number">512</span>G&#x27;<span class="punctuation">:</span> <span class="number">6</span><span class="punctuation">,</span> &#x27;白色<span class="punctuation">,</span><span class="number">12</span>G<span class="punctuation">,</span><span class="number">128</span>G&#x27;<span class="punctuation">:</span> <span class="number">7</span><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>根据sku中spuId查询spu的描述信息（已有）</p>
</li>
<li><p>根据分类id、spuId及skuId查询分组及组下的规格参数值</p>
</li>
</ol>
<h3 id="1-3-1-添加远程接口"><a href="#1-3-1-添加远程接口" class="headerlink" title="1.3.1. 添加远程接口"></a>1.3.1. 添加远程接口</h3><p>这些数据模型需要调用远程接口从其他微服务获取，所以这里先编写feign接口</p>
<p> <img src="/assets/1586079205681.png" alt="1586079205681"></p>
<p>GmallPmsClient：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@FeignClient(&quot;pms-service&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">GmallPmsClient</span> <span class="keyword">extends</span> <span class="title class_">GmallPmsApi</span> &#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>GmallSmsClient：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@FeignClient(&quot;sms-service&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">GmallSmsClient</span> <span class="keyword">extends</span> <span class="title class_">GmallSmsApi</span> &#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>GmallWmsClient：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@FeignClient(&quot;wms-service&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">GmallWmsClient</span> <span class="keyword">extends</span> <span class="title class_">GmallWmsApi</span> &#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>有些接口已经有了，直接给GmallPmsApi添加方法即可：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 根据id查询sku信息</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> id</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line"><span class="meta">@GetMapping(&quot;pms/sku/&#123;id&#125;&quot;)</span></span><br><span class="line"><span class="keyword">public</span> ResponseVo&lt;SkuEntity&gt; <span class="title function_">querySkuById</span><span class="params">(<span class="meta">@PathVariable(&quot;id&quot;)</span> Long id)</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 根据id查询spu信息</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> id</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line"><span class="meta">@GetMapping(&quot;pms/spu/&#123;id&#125;&quot;)</span></span><br><span class="line"><span class="keyword">public</span> ResponseVo&lt;SpuEntity&gt; <span class="title function_">querySpuById</span><span class="params">(<span class="meta">@PathVariable(&quot;id&quot;)</span> Long id)</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 根据id查询spu的描述信息</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> spuId</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line"><span class="meta">@GetMapping(&quot;pms/spudesc/&#123;spuId&#125;&quot;)</span></span><br><span class="line"><span class="keyword">public</span> ResponseVo&lt;SpuDescEntity&gt; <span class="title function_">querySpuDescById</span><span class="params">(<span class="meta">@PathVariable(&quot;spuId&quot;)</span> Long spuId)</span>;</span><br></pre></td></tr></table></figure>



<h3 id="1-3-2-根据三级分类id查询一二三级分类"><a href="#1-3-2-根据三级分类id查询一二三级分类" class="headerlink" title="1.3.2. 根据三级分类id查询一二三级分类"></a>1.3.2. 根据三级分类id查询一二三级分类</h3><p>在CategoryController中添加方法：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@GetMapping(&quot;all/&#123;cid3&#125;&quot;)</span></span><br><span class="line"><span class="keyword">public</span> ResponseVo&lt;List&lt;CategoryEntity&gt;&gt; <span class="title function_">queryCategoriesByCid3</span><span class="params">(<span class="meta">@PathVariable(&quot;cid3&quot;)</span>Long cid3)</span>&#123;</span><br><span class="line">    List&lt;CategoryEntity&gt; itemCategoryVos = <span class="built_in">this</span>.categoryService.queryCategoriesByCid3(cid3);</span><br><span class="line">    <span class="keyword">return</span> ResponseVo.ok(itemCategoryVos);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>在CategoryService接口中添加方法：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">List&lt;CategoryEntity&gt; <span class="title function_">queryCategoriesByCid3</span><span class="params">(Long cid3)</span>;</span><br></pre></td></tr></table></figure>

<p>在CategoryServiceImpl实现类中添加方法：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> List&lt;CategoryEntity&gt; <span class="title function_">queryCategoriesByCid3</span><span class="params">(Long cid3)</span> &#123;</span><br><span class="line">    <span class="comment">// 查询三级分类</span></span><br><span class="line">    <span class="type">CategoryEntity</span> <span class="variable">categoryEntity3</span> <span class="operator">=</span> <span class="built_in">this</span>.categoryMapper.selectById(cid3);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 查询二级分类</span></span><br><span class="line">    <span class="type">CategoryEntity</span> <span class="variable">categoryEntity2</span> <span class="operator">=</span> <span class="built_in">this</span>.categoryMapper.selectById(categoryEntity3.getParentId());</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 查询一级分类</span></span><br><span class="line">    <span class="type">CategoryEntity</span> <span class="variable">categoryEntity1</span> <span class="operator">=</span> <span class="built_in">this</span>.categoryMapper.selectById(categoryEntity2.getParentId());</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> Arrays.asList(categoryEntity1, categoryEntity2, categoryEntity3);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>在GmallPmsApi中添加接口方法：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@GetMapping(&quot;pms/category/all/&#123;cid3&#125;&quot;)</span></span><br><span class="line"><span class="keyword">public</span> ResponseVo&lt;List&lt;CategoryEntity&gt;&gt; <span class="title function_">queryCategoriesByCid3</span><span class="params">(<span class="meta">@PathVariable(&quot;cid3&quot;)</span>Long cid3)</span>;</span><br></pre></td></tr></table></figure>



<h3 id="1-3-3-根据skuId查询sku的图片"><a href="#1-3-3-根据skuId查询sku的图片" class="headerlink" title="1.3.3. 根据skuId查询sku的图片"></a>1.3.3. 根据skuId查询sku的图片</h3><p>在SkuImagesController中添加：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@GetMapping(&quot;sku/&#123;skuId&#125;&quot;)</span></span><br><span class="line"><span class="keyword">public</span> ResponseVo&lt;List&lt;SkuImagesEntity&gt;&gt; <span class="title function_">queryImagesBySkuId</span><span class="params">(<span class="meta">@PathVariable(&quot;skuId&quot;)</span> Long skuId)</span>&#123;</span><br><span class="line">    List&lt;SkuImagesEntity&gt; imagesEntities = <span class="built_in">this</span>.skuImagesService.list(<span class="keyword">new</span> <span class="title class_">QueryWrapper</span>&lt;SkuImagesEntity&gt;().eq(<span class="string">&quot;sku_id&quot;</span>, skuId));</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> ResponseVo.ok(imagesEntities);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>在GmallPmsApi中添加接口方法：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@GetMapping(&quot;pms/skuimages/sku/&#123;skuId&#125;&quot;)</span></span><br><span class="line"><span class="keyword">public</span> ResponseVo&lt;List&lt;SkuImagesEntity&gt;&gt; <span class="title function_">queryImagesBySkuId</span><span class="params">(<span class="meta">@PathVariable(&quot;skuId&quot;)</span>Long skuId)</span>;</span><br></pre></td></tr></table></figure>



<h3 id="1-3-4-查询sku的营销信息"><a href="#1-3-4-查询sku的营销信息" class="headerlink" title="1.3.4. 查询sku的营销信息"></a>1.3.4. 查询sku的营销信息</h3><p>在SkuBoundsController中添加查询营销信息的方法：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@GetMapping(&quot;sku/&#123;skuId&#125;&quot;)</span></span><br><span class="line"><span class="keyword">public</span> ResponseVo&lt;List&lt;ItemSaleVo&gt;&gt; <span class="title function_">querySalesBySkuId</span><span class="params">(<span class="meta">@PathVariable(&quot;skuId&quot;)</span>Long skuId)</span>&#123;</span><br><span class="line">    List&lt;ItemSaleVo&gt; itemSaleVos = <span class="built_in">this</span>.skuBoundsService.querySalesBySkuId(skuId);</span><br><span class="line">    <span class="keyword">return</span> ResponseVo.ok(itemSaleVos);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>在SkuBoundsService中添加接口方法：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">List&lt;ItemSaleVo&gt; <span class="title function_">querySalesBySkuId</span><span class="params">(Long skuId)</span>;</span><br></pre></td></tr></table></figure>

<p>在SkuBoundsServiceImpl中实现接口方法：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> List&lt;ItemSaleVo&gt; <span class="title function_">querySalesBySkuId</span><span class="params">(Long skuId)</span> &#123;</span><br><span class="line">    List&lt;ItemSaleVo&gt; itemSaleVos = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">    <span class="comment">// 查询积分信息</span></span><br><span class="line">    <span class="type">SkuBoundsEntity</span> <span class="variable">skuBoundsEntity</span> <span class="operator">=</span> <span class="built_in">this</span>.getOne(<span class="keyword">new</span> <span class="title class_">QueryWrapper</span>&lt;SkuBoundsEntity&gt;().eq(<span class="string">&quot;sku_id&quot;</span>, skuId));</span><br><span class="line">    <span class="type">ItemSaleVo</span> <span class="variable">bounds</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ItemSaleVo</span>();</span><br><span class="line">    bounds.setType(<span class="string">&quot;积分&quot;</span>);</span><br><span class="line">    bounds.setDesc(<span class="string">&quot;送&quot;</span> + skuBoundsEntity.getGrowBounds() + <span class="string">&quot;成长积分，送&quot;</span> + skuBoundsEntity.getBuyBounds() + <span class="string">&quot;购物积分&quot;</span>);</span><br><span class="line">    itemSaleVos.add(bounds);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 查询满减信息</span></span><br><span class="line">    <span class="type">SkuFullReductionEntity</span> <span class="variable">reductionEntity</span> <span class="operator">=</span> <span class="built_in">this</span>.reductionMapper.selectOne(<span class="keyword">new</span> <span class="title class_">QueryWrapper</span>&lt;SkuFullReductionEntity&gt;().eq(<span class="string">&quot;sku_id&quot;</span>, skuId));</span><br><span class="line">    <span class="type">ItemSaleVo</span> <span class="variable">reduction</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ItemSaleVo</span>();</span><br><span class="line">    reduction.setType(<span class="string">&quot;满减&quot;</span>);</span><br><span class="line">    reduction.setDesc(<span class="string">&quot;满&quot;</span> + reductionEntity.getFullPrice() + <span class="string">&quot;减&quot;</span> + reductionEntity.getReducePrice());</span><br><span class="line">    itemSaleVos.add(reduction);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 查询打折信息</span></span><br><span class="line">    <span class="type">SkuLadderEntity</span> <span class="variable">ladderEntity</span> <span class="operator">=</span> <span class="built_in">this</span>.ladderMapper.selectOne(<span class="keyword">new</span> <span class="title class_">QueryWrapper</span>&lt;SkuLadderEntity&gt;().eq(<span class="string">&quot;sku_id&quot;</span>, skuId));</span><br><span class="line">    <span class="type">ItemSaleVo</span> <span class="variable">ladder</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ItemSaleVo</span>();</span><br><span class="line">    ladder.setType(<span class="string">&quot;打折&quot;</span>);</span><br><span class="line">    ladder.setDesc(<span class="string">&quot;满&quot;</span> + ladderEntity.getFullCount() + <span class="string">&quot;件打&quot;</span> + ladderEntity.getDiscount().divide(<span class="keyword">new</span> <span class="title class_">BigDecimal</span>(<span class="number">10</span>)) + <span class="string">&quot;折&quot;</span>);</span><br><span class="line">    itemSaleVos.add(ladder);</span><br><span class="line">    <span class="keyword">return</span> itemSaleVos;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>在GmallSmsApi中添加数据接口方法</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@GetMapping(&quot;sms/skubounds/sku/&#123;skuId&#125;&quot;)</span></span><br><span class="line"><span class="keyword">public</span> ResponseVo&lt;List&lt;ItemSaleVo&gt;&gt; <span class="title function_">querySalesBySkuId</span><span class="params">(<span class="meta">@PathVariable(&quot;skuId&quot;)</span>Long skuId)</span>;</span><br></pre></td></tr></table></figure>



<h3 id="1-3-5-根据spuId查询spu下的所有销售属性"><a href="#1-3-5-根据spuId查询spu下的所有销售属性" class="headerlink" title="1.3.5. 根据spuId查询spu下的所有销售属性"></a>1.3.5. 根据spuId查询spu下的所有销售属性</h3><p>SkuAttrValueController中添加查询方法：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@GetMapping(&quot;spu/&#123;spuId&#125;&quot;)</span></span><br><span class="line"><span class="keyword">public</span> ResponseVo&lt;List&lt;SaleAttrValueVo&gt;&gt; <span class="title function_">querySkuAttrValuesBySpuId</span><span class="params">(<span class="meta">@PathVariable(&quot;spuId&quot;)</span>Long spuId)</span>&#123;</span><br><span class="line">    List&lt;SaleAttrValueVo&gt; saleAttrValueVos = <span class="built_in">this</span>.skuAttrValueService.querySkuAttrValuesBySpuId(spuId);</span><br><span class="line">    <span class="keyword">return</span> ResponseVo.ok(saleAttrValueVos);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>在SkuSaleAttrValueService接口中添加抽象方法：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">List&lt;SaleAttrValueVo&gt; <span class="title function_">querySkuAttrValuesBySpuId</span><span class="params">(Long spuId)</span>;</span><br></pre></td></tr></table></figure>

<p>在SkuSaleAttrValueServiceImpl中实现该方法：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Autowired</span></span><br><span class="line"><span class="keyword">private</span> SkuAttrValueMapper skuAttrValueMapper;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> List&lt;SaleAttrValueVo&gt; <span class="title function_">querySkuAttrValuesBySpuId</span><span class="params">(Long spuId)</span> &#123;</span><br><span class="line">    List&lt;AttrValueVo&gt; attrValueVos = skuAttrValueMapper.querySkuAttrValuesBySpuId(spuId);</span><br><span class="line">    <span class="comment">// 以attrId进行分组</span></span><br><span class="line">    Map&lt;Long, List&lt;AttrValueVo&gt;&gt; map = attrValueVos.stream().collect(groupingBy(AttrValueVo::getAttrId));</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 创建一个List&lt;SaleAttrValueVo&gt;</span></span><br><span class="line">    List&lt;SaleAttrValueVo&gt; saleAttrValueVos = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">    map.forEach((attrId, attrs) -&gt; &#123;</span><br><span class="line">        <span class="type">SaleAttrValueVo</span> <span class="variable">saleAttrValueVo</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SaleAttrValueVo</span>();</span><br><span class="line">        <span class="comment">// attrId</span></span><br><span class="line">        saleAttrValueVo.setAttrId(attrId);</span><br><span class="line">        <span class="comment">// attrName</span></span><br><span class="line">        saleAttrValueVo.setAttrName(attrs.get(<span class="number">0</span>).getAttrName());</span><br><span class="line">        <span class="comment">// attrValues</span></span><br><span class="line">        Set&lt;String&gt; attrValues = attrs.stream().map(AttrValueVo::getAttrValue).collect(Collectors.toSet());</span><br><span class="line">        saleAttrValueVo.setAttrValues(attrValues);</span><br><span class="line">        saleAttrValueVos.add(saleAttrValueVo);</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> saleAttrValueVos;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>SkuAttrValueMapper接口添加方法：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Mapper</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">SkuAttrValueMapper</span> <span class="keyword">extends</span> <span class="title class_">BaseMapper</span>&lt;SkuAttrValueEntity&gt; &#123;</span><br><span class="line"></span><br><span class="line">    List&lt;AttrValueVo&gt; <span class="title function_">querySkuAttrValuesBySpuId</span><span class="params">(Long spuId)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>SkuAttrValueMapper.xml中配置映射：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">mapper</span> <span class="keyword">PUBLIC</span> <span class="string">&quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;</span> <span class="string">&quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">&quot;com.atguigu.gmall.pms.mapper.SkuAttrValueMapper&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;querySkuAttrValuesBySpuId&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;com.atguigu.gmall.pms.vo.AttrValueVo&quot;</span>&gt;</span></span><br><span class="line">        select a.attr_id,attr_name,a.attr_value</span><br><span class="line">            from pms_sku_attr_value a INNER JOIN pms_sku b on a.sku_id=b.id</span><br><span class="line">        where spu_id=#&#123;spuId&#125;;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br></pre></td></tr></table></figure>



<p>在GmallPmsApi中添加数据接口：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@GetMapping(&quot;pms/skuattrvalue/spu/&#123;spuId&#125;&quot;)</span></span><br><span class="line"><span class="keyword">public</span> ResponseVo&lt;List&lt;SaleAttrValueVo&gt;&gt; <span class="title function_">querySkuAttrValuesBySpuId</span><span class="params">(<span class="meta">@PathVariable(&quot;spuId&quot;)</span>Long spuId)</span>;</span><br></pre></td></tr></table></figure>



<h3 id="1-3-6-查询spu下skuId及销售属性的关系"><a href="#1-3-6-查询spu下skuId及销售属性的关系" class="headerlink" title="1.3.6. 查询spu下skuId及销售属性的关系"></a>1.3.6. 查询spu下skuId及销售属性的关系</h3><p>给SkuAttrValueController添加方法：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@GetMapping(&quot;spu/sku/&#123;spuId&#125;&quot;)</span></span><br><span class="line"><span class="keyword">public</span> ResponseVo&lt;String&gt; <span class="title function_">querySkusJsonBySpuId</span><span class="params">(<span class="meta">@PathVariable(&quot;spuId&quot;)</span> Long spuId)</span>&#123;</span><br><span class="line">    <span class="type">String</span> <span class="variable">skusJson</span> <span class="operator">=</span> <span class="built_in">this</span>.skuAttrValueService.querySkusJsonBySpuId(spuId);</span><br><span class="line">    <span class="keyword">return</span> ResponseVo.ok(skusJson);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>给SkuAttrValueService接口添加方法：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">String <span class="title function_">querySkusJsonBySpuId</span><span class="params">(Long spuId)</span>;</span><br></pre></td></tr></table></figure>

<p>SkuAttrValueServiceImpl实现类实现接口方法：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">querySkusJsonBySpuId</span><span class="params">(Long spuId)</span> &#123;</span><br><span class="line">    <span class="comment">// [&#123;&quot;sku_id&quot;: 3, &quot;attr_values&quot;: &quot;暗夜黑,12G,512G&quot;&#125;, &#123;&quot;sku_id&quot;: 4, &quot;attr_values&quot;: &quot;白天白,12G,512G&quot;&#125;]</span></span><br><span class="line">    List&lt;Map&lt;String, Object&gt;&gt; skus = <span class="built_in">this</span>.skuAttrValueMapper.querySkusJsonBySpuId(spuId);</span><br><span class="line">    <span class="comment">// 转换成：&#123;&#x27;暗夜黑,12G,512G&#x27;: 3, &#x27;白天白,12G,512G&#x27;: 4&#125;</span></span><br><span class="line">    Map&lt;String, Long&gt; map = skus.stream().collect(Collectors.toMap(sku -&gt; sku.get(<span class="string">&quot;attr_values&quot;</span>).toString(), sku -&gt; (Long) sku.get(<span class="string">&quot;sku_id&quot;</span>)));</span><br><span class="line">    <span class="keyword">return</span> JSON.toJSONString(map);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>给SkuAttrValueMapper添加querySkusJsonBySpuId方法：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Mapper</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">SkuAttrValueMapper</span> <span class="keyword">extends</span> <span class="title class_">BaseMapper</span>&lt;SkuAttrValueEntity&gt; &#123;</span><br><span class="line"></span><br><span class="line">    List&lt;AttrValueVo&gt; <span class="title function_">querySkuAttrValuesBySpuId</span><span class="params">(Long spuId)</span>;</span><br><span class="line"></span><br><span class="line">    List&lt;Map&lt;String, Object&gt;&gt; <span class="title function_">querySkusJsonBySpuId</span><span class="params">(Long spuId)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>给SkuAttrValueMapper.xml映射文件添加映射：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;querySkusJsonBySpuId&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;hashmap&quot;</span>&gt;</span></span><br><span class="line">    select GROUP_CONCAT(a.attr_value) as attr_values, a.sku_id</span><br><span class="line">    from pms_sku_attr_value a INNER JOIN pms_sku b on a.sku_id=b.id</span><br><span class="line">    where b.spu_id=#&#123;spuId&#125; group by a.sku_id</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>



<p>给GmallPmsApi添加接口方法：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@GetMapping(&quot;pms/skuattrvalue/spu/sku/&#123;spuId&#125;&quot;)</span></span><br><span class="line"><span class="keyword">public</span> ResponseVo&lt;String&gt; <span class="title function_">querySkusJsonBySpuId</span><span class="params">(<span class="meta">@PathVariable(&quot;spuId&quot;)</span> Long spuId)</span>;</span><br></pre></td></tr></table></figure>



<h3 id="1-3-7-查询组及组下参数和值"><a href="#1-3-7-查询组及组下参数和值" class="headerlink" title="1.3.7. 查询组及组下参数和值"></a>1.3.7. 查询组及组下参数和值</h3><p>在AttrGroupController中添加方法：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@GetMapping(&quot;withattrvalues&quot;)</span></span><br><span class="line"><span class="keyword">public</span> ResponseVo&lt;List&lt;ItemGroupVo&gt;&gt; <span class="title function_">queryGroupsBySpuIdAndCid</span><span class="params">(</span></span><br><span class="line"><span class="params">    <span class="meta">@RequestParam(&quot;spuId&quot;)</span>Long spuId,</span></span><br><span class="line"><span class="params">    <span class="meta">@RequestParam(&quot;skuId&quot;)</span>Long skuId,</span></span><br><span class="line"><span class="params">    <span class="meta">@RequestParam(&quot;cid&quot;)</span>Long cid</span></span><br><span class="line"><span class="params">    )</span>&#123;</span><br><span class="line">        List&lt;ItemGroupVo&gt; itemGroupVOS = attrGroupService.queryGroupsBySpuIdAndCid(spuId, skuId, cid);</span><br><span class="line">        <span class="keyword">return</span> ResponseVo.ok(itemGroupVOS);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p>在AttrGroupService接口中添加接口方法：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">List&lt;ItemGroupVo&gt; <span class="title function_">queryGroupsBySpuIdAndCid</span><span class="params">(Long spuId, Long skuId, Long cid)</span>;</span><br></pre></td></tr></table></figure>

<p>在AttrGroupServiceImpl实现类中添加实现方法：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Autowired</span></span><br><span class="line"><span class="keyword">private</span> SpuAttrValueMapper spuAttrValueMapper;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Autowired</span></span><br><span class="line"><span class="keyword">private</span> SkuAttrValueMapper skuAttrValueMapper;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> List&lt;ItemGroupVo&gt; <span class="title function_">queryGroupsBySpuIdAndCid</span><span class="params">(Long spuId, Long skuId, Long cid)</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 1.根据cid查询分组</span></span><br><span class="line">    List&lt;AttrGroupEntity&gt; attrGroupEntities = <span class="built_in">this</span>.list(<span class="keyword">new</span> <span class="title class_">QueryWrapper</span>&lt;AttrGroupEntity&gt;().eq(<span class="string">&quot;category_id&quot;</span>, cid));</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (CollectionUtils.isEmpty(attrGroupEntities))&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 2.遍历分组查询每个组下的attr</span></span><br><span class="line">    <span class="keyword">return</span> attrGroupEntities.stream().map(group -&gt; &#123;</span><br><span class="line">        <span class="type">ItemGroupVo</span> <span class="variable">itemGroupVo</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ItemGroupVo</span>();</span><br><span class="line">        itemGroupVo.setGroupId(group.getId());</span><br><span class="line">        itemGroupVo.setGroupName(group.getName());</span><br><span class="line"></span><br><span class="line">        List&lt;AttrEntity&gt; attrEntities = <span class="built_in">this</span>.attrMapper.selectList(<span class="keyword">new</span> <span class="title class_">QueryWrapper</span>&lt;AttrEntity&gt;().eq(<span class="string">&quot;group_id&quot;</span>, group.getId()));</span><br><span class="line">        <span class="keyword">if</span> (!CollectionUtils.isEmpty(attrEntities))&#123;</span><br><span class="line">            List&lt;Long&gt; attrIds = attrEntities.stream().map(AttrEntity::getId).collect(Collectors.toList());</span><br><span class="line">            <span class="comment">// 3.attrId结合spuId查询规格参数对应值</span></span><br><span class="line">            List&lt;SpuAttrValueEntity&gt; spuAttrValueEntities = <span class="built_in">this</span>.spuAttrValueMapper.selectList(<span class="keyword">new</span> <span class="title class_">QueryWrapper</span>&lt;SpuAttrValueEntity&gt;().eq(<span class="string">&quot;spu_id&quot;</span>, spuId).in(<span class="string">&quot;attr_id&quot;</span>, attrIds));</span><br><span class="line">            List&lt;SkuAttrValueEntity&gt; skuAttrValueEntities = <span class="built_in">this</span>.skuAttrValueMapper.selectList(<span class="keyword">new</span> <span class="title class_">QueryWrapper</span>&lt;SkuAttrValueEntity&gt;().eq(<span class="string">&quot;sku_id&quot;</span>, skuId).in(<span class="string">&quot;attr_id&quot;</span>, attrIds));</span><br><span class="line"></span><br><span class="line">            List&lt;AttrValueVo&gt; attrValueVos = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">            <span class="keyword">if</span> (!CollectionUtils.isEmpty(spuAttrValueEntities))&#123;</span><br><span class="line">                List&lt;AttrValueVo&gt; spuAttrValueVos = spuAttrValueEntities.stream().map(attrValue -&gt; &#123;</span><br><span class="line">                    <span class="type">AttrValueVo</span> <span class="variable">attrValueVo</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">AttrValueVo</span>();</span><br><span class="line">                    BeanUtils.copyProperties(attrValue, attrValueVo);</span><br><span class="line">                    <span class="keyword">return</span> attrValueVo;</span><br><span class="line">                &#125;).collect(Collectors.toList());</span><br><span class="line">                attrValueVos.addAll(spuAttrValueVos);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (!CollectionUtils.isEmpty(skuAttrValueEntities))&#123;</span><br><span class="line">                List&lt;AttrValueVo&gt; skuAttrValueVos = skuAttrValueEntities.stream().map(attrValue -&gt; &#123;</span><br><span class="line">                    <span class="type">AttrValueVo</span> <span class="variable">attrValueVo</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">AttrValueVo</span>();</span><br><span class="line">                    BeanUtils.copyProperties(attrValue, attrValueVo);</span><br><span class="line">                    <span class="keyword">return</span> attrValueVo;</span><br><span class="line">                &#125;).collect(Collectors.toList());</span><br><span class="line">                attrValueVos.addAll(skuAttrValueVos);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            itemGroupVo.setAttrValues(attrValueVos);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> itemGroupVo;</span><br><span class="line">    &#125;).collect(Collectors.toList());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h2 id="1-4-给商品详情页提供数据"><a href="#1-4-给商品详情页提供数据" class="headerlink" title="1.4. 给商品详情页提供数据"></a>1.4. 给商品详情页提供数据</h2><p>请求路径：&#x2F;item&#x2F;{skuId}</p>
<p>请求参数：skuId</p>
<p>请求方式：GET</p>
<p>响应：ItemVO的json数据</p>
<p> <img src="/assets/1589713495784.png" alt="1589713495784"></p>
<p>ItemController：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;item&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ItemController</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> ItemService itemService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(&quot;&#123;skuId&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> ResponseVo&lt;ItemVo&gt; <span class="title function_">load</span><span class="params">(<span class="meta">@PathVariable(&quot;skuId&quot;)</span>Long skuId)</span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="type">ItemVo</span> <span class="variable">itemVo</span> <span class="operator">=</span> <span class="built_in">this</span>.itemService.load(skuId);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> ResponseVo.ok(itemVo);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ItemService：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ItemService</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> GmallPmsClient pmsClient;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> GmallWmsClient wmsClient;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> GmallSmsClient smsClient;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> ThreadPoolExecutor threadPoolExecutor;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> ItemVo <span class="title function_">load</span><span class="params">(Long skuId)</span> &#123;</span><br><span class="line"></span><br><span class="line">        <span class="type">ItemVo</span> <span class="variable">itemVo</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ItemVo</span>();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 根据skuId查询sku的信息1</span></span><br><span class="line">        ResponseVo&lt;SkuEntity&gt; skuEntityResponseVo = <span class="built_in">this</span>.pmsClient.querySkuById(skuId);</span><br><span class="line">        <span class="type">SkuEntity</span> <span class="variable">skuEntity</span> <span class="operator">=</span> skuEntityResponseVo.getData();</span><br><span class="line">        <span class="keyword">if</span> (skuEntity == <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        itemVo.setSkuId(skuId);</span><br><span class="line">        itemVo.setTitle(skuEntity.getTitle());</span><br><span class="line">        itemVo.setSubTitle(skuEntity.getSubtitle());</span><br><span class="line">        itemVo.setPrice(skuEntity.getPrice());</span><br><span class="line">        itemVo.setWeight(skuEntity.getWeight());</span><br><span class="line">        itemVo.setDefaltImage(skuEntity.getDefaultImage());</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 根据cid3查询分类信息2</span></span><br><span class="line">        ResponseVo&lt;List&lt;CategoryEntity&gt;&gt; categoryResponseVo = <span class="built_in">this</span>.pmsClient.queryCategoriesByCid3(skuEntity.getCategoryId());</span><br><span class="line">        List&lt;CategoryEntity&gt; categoryEntities = categoryResponseVo.getData();</span><br><span class="line">        itemVo.setCategories(categoryEntities);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 根据品牌的id查询品牌3</span></span><br><span class="line">        ResponseVo&lt;BrandEntity&gt; brandEntityResponseVo = <span class="built_in">this</span>.pmsClient.queryBrandById(skuEntity.getBrandId());</span><br><span class="line">        <span class="type">BrandEntity</span> <span class="variable">brandEntity</span> <span class="operator">=</span> brandEntityResponseVo.getData();</span><br><span class="line">        <span class="keyword">if</span> (brandEntity != <span class="literal">null</span>) &#123;</span><br><span class="line">            itemVo.setBrandId(brandEntity.getId());</span><br><span class="line">            itemVo.setBrandName(brandEntity.getName());</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 根据spuId查询spu4</span></span><br><span class="line">        ResponseVo&lt;SpuEntity&gt; spuEntityResponseVo = <span class="built_in">this</span>.pmsClient.querySpuById(skuEntity.getSpuId());</span><br><span class="line">        <span class="type">SpuEntity</span> <span class="variable">spuEntity</span> <span class="operator">=</span> spuEntityResponseVo.getData();</span><br><span class="line">        <span class="keyword">if</span> (spuEntity != <span class="literal">null</span>) &#123;</span><br><span class="line">            itemVo.setSpuId(spuEntity.getId());</span><br><span class="line">            itemVo.setSpuName(spuEntity.getName());</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 跟据skuId查询图片5</span></span><br><span class="line">        ResponseVo&lt;List&lt;SkuImagesEntity&gt;&gt; skuImagesResponseVo = <span class="built_in">this</span>.pmsClient.queryImagesBySkuId(skuId);</span><br><span class="line">        List&lt;SkuImagesEntity&gt; skuImagesEntities = skuImagesResponseVo.getData();</span><br><span class="line">        itemVo.setImages(skuImagesEntities);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 根据skuId查询sku营销信息6</span></span><br><span class="line">        ResponseVo&lt;List&lt;ItemSaleVo&gt;&gt; salesResponseVo = <span class="built_in">this</span>.smsClient.querySalesBySkuId(skuId);</span><br><span class="line">        List&lt;ItemSaleVo&gt; sales = salesResponseVo.getData();</span><br><span class="line">        itemVo.setSales(sales);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 根据skuId查询sku的库存信息7</span></span><br><span class="line">        ResponseVo&lt;List&lt;WareSkuEntity&gt;&gt; wareSkuResponseVo = <span class="built_in">this</span>.wmsClient.queryWareSkusBySkuId(skuId);</span><br><span class="line">        List&lt;WareSkuEntity&gt; wareSkuEntities = wareSkuResponseVo.getData();</span><br><span class="line">        <span class="keyword">if</span> (!CollectionUtils.isEmpty(wareSkuEntities)) &#123;</span><br><span class="line">            itemVo.setStore(wareSkuEntities.stream().anyMatch(wareSkuEntity -&gt; wareSkuEntity.getStock() - wareSkuEntity.getStockLocked() &gt; <span class="number">0</span>));</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 根据spuId查询spu下的所有sku的销售属性8</span></span><br><span class="line">        ResponseVo&lt;List&lt;SaleAttrValueVo&gt;&gt; saleAttrValueVoResponseVo = <span class="built_in">this</span>.pmsClient.querySkuAttrValuesBySpuId(skuEntity.getSpuId());</span><br><span class="line">        List&lt;SaleAttrValueVo&gt; saleAttrValueVos = saleAttrValueVoResponseVo.getData();</span><br><span class="line">        itemVo.setSaleAttrs(saleAttrValueVos);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 当前sku的销售属性9</span></span><br><span class="line">        ResponseVo&lt;List&lt;SkuAttrValueEntity&gt;&gt; saleAttrResponseVo = <span class="built_in">this</span>.pmsClient.querySkuAttrValuesBySkuId(skuId);</span><br><span class="line">        List&lt;SkuAttrValueEntity&gt; skuAttrValueEntities = saleAttrResponseVo.getData();</span><br><span class="line">        Map&lt;Long, String&gt; map = skuAttrValueEntities.stream().collect(Collectors.toMap(SkuAttrValueEntity::getAttrId, SkuAttrValueEntity::getAttrValue));</span><br><span class="line">        itemVo.setSaleAttr(map);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 根据spuId查询spu下的所有sku及销售属性的映射关系10</span></span><br><span class="line">        ResponseVo&lt;String&gt; skusJsonResponseVo = <span class="built_in">this</span>.pmsClient.querySkusJsonBySpuId(skuEntity.getSpuId());</span><br><span class="line">        <span class="type">String</span> <span class="variable">skusJson</span> <span class="operator">=</span> skusJsonResponseVo.getData();</span><br><span class="line">        itemVo.setSkusJson(skusJson);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 根据spuId查询spu的海报信息11</span></span><br><span class="line">        ResponseVo&lt;SpuDescEntity&gt; spuDescEntityResponseVo = <span class="built_in">this</span>.pmsClient.querySpuDescById(skuEntity.getSpuId());</span><br><span class="line">        <span class="type">SpuDescEntity</span> <span class="variable">spuDescEntity</span> <span class="operator">=</span> spuDescEntityResponseVo.getData();</span><br><span class="line">        <span class="keyword">if</span> (spuDescEntity != <span class="literal">null</span> &amp;&amp; StringUtils.isNotBlank(spuDescEntity.getDecript())) &#123;</span><br><span class="line">            String[] images = StringUtils.split(spuDescEntity.getDecript(), <span class="string">&quot;,&quot;</span>);</span><br><span class="line">            itemVo.setSpuImages(Arrays.asList(images));</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 根据cid3 spuId skuId查询组及组下的规格参数及值 12</span></span><br><span class="line">        ResponseVo&lt;List&lt;ItemGroupVo&gt;&gt; groupResponseVo = <span class="built_in">this</span>.pmsClient.queryGoupsWithAttrValues(skuEntity.getCategoryId(), skuEntity.getSpuId(), skuId);</span><br><span class="line">        List&lt;ItemGroupVo&gt; itemGroupVos = groupResponseVo.getData();</span><br><span class="line">        itemVo.setGroups(itemGroupVos);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> itemVo;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>完成！！</p>
<h1 id="2-CompletableFuture异步调用"><a href="#2-CompletableFuture异步调用" class="headerlink" title="2. CompletableFuture异步调用"></a>2. CompletableFuture异步调用</h1><p>问题：查询商品详情页的逻辑非常复杂，数据的获取都需要远程调用，必然需要花费更多的时间。</p>
<p>假如商品详情页的每个查询，需要如下标注的时间才能完成</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 1. 获取sku的基本信息	0.5s</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 2. 获取sku的图片信息	0.5s</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 3. 获取sku的促销信息 TODO 1s</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 4. 获取spu的所有销售属性	1s</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 5. 获取规格参数组及组下的规格参数 TODO	1.5s</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 6. spu详情 TODO	1s</span></span><br><span class="line"></span><br><span class="line">.........</span><br></pre></td></tr></table></figure>

<p>那么，用户需要6.5s后才能看到商品详情页的内容。很显然是不能接受的。</p>
<p>如果有多个线程同时完成这6步操作，也许只需要1.5s即可完成响应。</p>
<h2 id="2-1-线程回顾"><a href="#2-1-线程回顾" class="headerlink" title="2.1. 线程回顾"></a>2.1. 线程回顾</h2><p>初始化线程的4种方式：</p>
<ol>
<li>继承Thread</li>
<li>实现Runnable接口</li>
<li>实现Callable接口 + FutureTask （可以拿到返回结果，可以处理异常）</li>
<li>线程池</li>
</ol>
<p>方式1和方式2：主进程无法获取线程的运算结果。不适合当前场景</p>
<p>方式3：主进程可以获取线程的运算结果，并设置给itemVO，但是不利于控制服务器中的线程资源。可以导致服务器资源耗尽。</p>
<p>方式4：通过如下两种方式初始化线程池：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Executors.newFiexedThreadPool(<span class="number">3</span>);</span><br><span class="line"><span class="comment">//或者</span></span><br><span class="line"><span class="keyword">new</span> <span class="title class_">ThreadPoolExecutor</span>(corePoolSize, maximumPoolSize, keepAliveTime, TimeUnit unit, workQueue, threadFactory, handler);</span><br></pre></td></tr></table></figure>

<p>通过线程池性能稳定，也可以获取执行结果，并捕获异常。但是，在业务复杂情况下，一个异步调用可能会依赖于另一个异步调用的执行结果。</p>
<h2 id="2-2-CompletableFuture介绍"><a href="#2-2-CompletableFuture介绍" class="headerlink" title="2.2. CompletableFuture介绍"></a>2.2. CompletableFuture介绍</h2><p>Future是Java 5添加的类，用来描述一个异步计算的结果。你可以使用<code>isDone</code>方法检查计算是否完成，或者使用<code>get</code>阻塞住调用线程，直到计算完成返回结果，你也可以使用<code>cancel</code>方法停止任务的执行。</p>
<p>虽然<code>Future</code>以及相关使用方法提供了异步执行任务的能力，但是对于结果的获取却是很不方便，只能通过阻塞或者轮询的方式得到任务的结果。阻塞的方式显然和我们的异步编程的初衷相违背，轮询的方式又会耗费无谓的CPU资源，而且也不能及时地得到计算结果，为什么不能用观察者设计模式当计算结果完成及时通知监听者呢？</p>
<p>很多语言，比如Node.js，采用回调的方式实现异步编程。Java的一些框架，比如Netty，自己扩展了Java的 <code>Future</code>接口，提供了<code>addListener</code>等多个扩展方法；Google guava也提供了通用的扩展Future；Scala也提供了简单易用且功能强大的Future&#x2F;Promise异步编程模式。</p>
<p>作为正统的Java类库，是不是应该做点什么，加强一下自身库的功能呢？</p>
<p>在Java 8中, 新增加了一个包含50个方法左右的类: CompletableFuture，提供了非常强大的Future的扩展功能，可以帮助我们简化异步编程的复杂性，提供了函数式编程的能力，可以通过回调的方式处理计算结果，并且提供了转换和组合CompletableFuture的方法。</p>
<p>CompletableFuture类实现了Future接口，所以你还是可以像以前一样通过<code>get</code>方法阻塞或者轮询的方式获得结果，但是这种方式不推荐使用。</p>
<p>CompletableFuture和FutureTask同属于Future接口的实现类，都可以获取线程的执行结果。</p>
<p><img src="/assets/1568552614487.png" alt="1568552614487"></p>
<h2 id="2-3-创建异步对象"><a href="#2-3-创建异步对象" class="headerlink" title="2.3. 创建异步对象"></a>2.3. 创建异步对象</h2><p>CompletableFuture 提供了四个静态方法来创建一个异步操作。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">static</span> CompletableFuture&lt;Void&gt; <span class="title function_">runAsync</span><span class="params">(Runnable runnable)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> CompletableFuture&lt;Void&gt; <span class="title function_">runAsync</span><span class="params">(Runnable runnable, Executor executor)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> &lt;U&gt; CompletableFuture&lt;U&gt; <span class="title function_">supplyAsync</span><span class="params">(Supplier&lt;U&gt; supplier)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> &lt;U&gt; CompletableFuture&lt;U&gt; <span class="title function_">supplyAsync</span><span class="params">(Supplier&lt;U&gt; supplier, Executor executor)</span></span><br></pre></td></tr></table></figure>

<p><strong>没有指定Executor的方法会使用ForkJoinPool.commonPool() 作为它的线程池执行异步代码</strong>。如果指定线程池，则使用指定的线程池运行。以下所有的方法都类同。</p>
<ul>
<li>runAsync方法不支持返回值。</li>
<li>supplyAsync可以支持返回值。</li>
</ul>
<h2 id="2-4-计算完成时回调方法"><a href="#2-4-计算完成时回调方法" class="headerlink" title="2.4. 计算完成时回调方法"></a>2.4. 计算完成时回调方法</h2><p>当CompletableFuture的计算结果完成，或者抛出异常的时候，可以执行特定的Action。主要是下面的方法：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> CompletableFuture&lt;T&gt; <span class="title function_">whenComplete</span><span class="params">(BiConsumer&lt;? <span class="built_in">super</span> T,? <span class="built_in">super</span> Throwable&gt; action)</span>;</span><br><span class="line"><span class="keyword">public</span> CompletableFuture&lt;T&gt; <span class="title function_">whenCompleteAsync</span><span class="params">(BiConsumer&lt;? <span class="built_in">super</span> T,? <span class="built_in">super</span> Throwable&gt; action)</span>;</span><br><span class="line"><span class="keyword">public</span> CompletableFuture&lt;T&gt; <span class="title function_">whenCompleteAsync</span><span class="params">(BiConsumer&lt;? <span class="built_in">super</span> T,? <span class="built_in">super</span> Throwable&gt; action, Executor executor)</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> CompletableFuture&lt;T&gt; <span class="title function_">exceptionally</span><span class="params">(Function&lt;Throwable,? extends T&gt; fn)</span>;</span><br></pre></td></tr></table></figure>

<p>whenComplete可以处理正常和异常的计算结果，exceptionally处理异常情况。BiConsumer&lt;? super T,? super Throwable&gt;可以定义处理业务</p>
<p>whenComplete 和 whenCompleteAsync 的区别：<br>        whenComplete：是执行当前任务的线程执行继续执行 whenComplete 的任务。<br>        whenCompleteAsync：是执行把 whenCompleteAsync 这个任务继续提交给线程池来进行执行。</p>
<p><strong>方法不以Async结尾，意味着Action使用相同的线程执行，而Async可能会使用其他线程执行（如果是使用相同的线程池，也可能会被同一个线程选中执行）</strong></p>
<p>代码示例：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CompletableFutureDemo</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> ExecutionException, InterruptedException &#123;</span><br><span class="line">        <span class="type">CompletableFuture</span> <span class="variable">future</span> <span class="operator">=</span> CompletableFuture.supplyAsync(<span class="keyword">new</span> <span class="title class_">Supplier</span>&lt;Object&gt;() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">public</span> Object <span class="title function_">get</span><span class="params">()</span> &#123;</span><br><span class="line">                System.out.println(Thread.currentThread().getName() + <span class="string">&quot;\t completableFuture&quot;</span>);</span><br><span class="line">                <span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">10</span> / <span class="number">0</span>;</span><br><span class="line">                <span class="keyword">return</span> <span class="number">1024</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;).whenComplete(<span class="keyword">new</span> <span class="title class_">BiConsumer</span>&lt;Object, Throwable&gt;() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">accept</span><span class="params">(Object o, Throwable throwable)</span> &#123;</span><br><span class="line">                System.out.println(<span class="string">&quot;-------o=&quot;</span> + o.toString());</span><br><span class="line">                System.out.println(<span class="string">&quot;-------throwable=&quot;</span> + throwable);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;).exceptionally(<span class="keyword">new</span> <span class="title class_">Function</span>&lt;Throwable, Object&gt;() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">public</span> Object <span class="title function_">apply</span><span class="params">(Throwable throwable)</span> &#123;</span><br><span class="line">                System.out.println(<span class="string">&quot;throwable=&quot;</span> + throwable);</span><br><span class="line">                <span class="keyword">return</span> <span class="number">6666</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">        System.out.println(future.get());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h2 id="2-5-线程串行化方法"><a href="#2-5-线程串行化方法" class="headerlink" title="2.5. 线程串行化方法"></a>2.5. 线程串行化方法</h2><p>thenApply 方法：当一个线程依赖另一个线程时，获取上一个任务返回的结果，并返回当前任务的返回值。</p>
<p>thenAccept方法：消费处理结果。接收任务的处理结果，并消费处理，无返回结果。</p>
<p>thenRun方法：只要上面的任务执行完成，就开始执行thenRun，只是处理完任务后，执行 thenRun的后续操作</p>
<p>带有Async默认是异步执行的。这里所谓的异步指的是不在当前线程内执行。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> &lt;U&gt; CompletableFuture&lt;U&gt; <span class="title function_">thenApply</span><span class="params">(Function&lt;? <span class="built_in">super</span> T,? extends U&gt; fn)</span></span><br><span class="line"><span class="keyword">public</span> &lt;U&gt; CompletableFuture&lt;U&gt; <span class="title function_">thenApplyAsync</span><span class="params">(Function&lt;? <span class="built_in">super</span> T,? extends U&gt; fn)</span></span><br><span class="line"><span class="keyword">public</span> &lt;U&gt; CompletableFuture&lt;U&gt; <span class="title function_">thenApplyAsync</span><span class="params">(Function&lt;? <span class="built_in">super</span> T,? extends U&gt; fn, Executor executor)</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> CompletionStage&lt;Void&gt; <span class="title function_">thenAccept</span><span class="params">(Consumer&lt;? <span class="built_in">super</span> T&gt; action)</span>;</span><br><span class="line"><span class="keyword">public</span> CompletionStage&lt;Void&gt; <span class="title function_">thenAcceptAsync</span><span class="params">(Consumer&lt;? <span class="built_in">super</span> T&gt; action)</span>;</span><br><span class="line"><span class="keyword">public</span> CompletionStage&lt;Void&gt; <span class="title function_">thenAcceptAsync</span><span class="params">(Consumer&lt;? <span class="built_in">super</span> T&gt; action,Executor executor)</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> CompletionStage&lt;Void&gt; <span class="title function_">thenRun</span><span class="params">(Runnable action)</span>;</span><br><span class="line"><span class="keyword">public</span> CompletionStage&lt;Void&gt; <span class="title function_">thenRunAsync</span><span class="params">(Runnable action)</span>;</span><br><span class="line"><span class="keyword">public</span> CompletionStage&lt;Void&gt; <span class="title function_">thenRunAsync</span><span class="params">(Runnable action,Executor executor)</span>;</span><br></pre></td></tr></table></figure>

<p>Function&lt;? super T,? extends U&gt;<br>        T：上一个任务返回结果的类型<br>        U：当前任务的返回值类型</p>
<p>代码演示：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> ExecutionException, InterruptedException &#123;</span><br><span class="line">    CompletableFuture&lt;Integer&gt; future = CompletableFuture.supplyAsync(<span class="keyword">new</span> <span class="title class_">Supplier</span>&lt;Integer&gt;() &#123;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="keyword">public</span> Integer <span class="title function_">get</span><span class="params">()</span> &#123;</span><br><span class="line">            System.out.println(Thread.currentThread().getName() + <span class="string">&quot;\t completableFuture&quot;</span>);</span><br><span class="line">            <span class="comment">//int i = 10 / 0;</span></span><br><span class="line">            <span class="keyword">return</span> <span class="number">1024</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;).thenApply(<span class="keyword">new</span> <span class="title class_">Function</span>&lt;Integer, Integer&gt;() &#123;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="keyword">public</span> Integer <span class="title function_">apply</span><span class="params">(Integer o)</span> &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;thenApply方法，上次返回结果：&quot;</span> + o);</span><br><span class="line">            <span class="keyword">return</span>  o * <span class="number">2</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;).whenComplete(<span class="keyword">new</span> <span class="title class_">BiConsumer</span>&lt;Integer, Throwable&gt;() &#123;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">accept</span><span class="params">(Integer o, Throwable throwable)</span> &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;-------o=&quot;</span> + o);</span><br><span class="line">            System.out.println(<span class="string">&quot;-------throwable=&quot;</span> + throwable);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;).exceptionally(<span class="keyword">new</span> <span class="title class_">Function</span>&lt;Throwable, Integer&gt;() &#123;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="keyword">public</span> Integer <span class="title function_">apply</span><span class="params">(Throwable throwable)</span> &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;throwable=&quot;</span> + throwable);</span><br><span class="line">            <span class="keyword">return</span> <span class="number">6666</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">    System.out.println(future.get());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h2 id="2-6-多任务组合"><a href="#2-6-多任务组合" class="headerlink" title="2.6. 多任务组合"></a>2.6. 多任务组合</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> CompletableFuture&lt;Void&gt; <span class="title function_">allOf</span><span class="params">(CompletableFuture&lt;?&gt;... cfs)</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> CompletableFuture&lt;Object&gt; <span class="title function_">anyOf</span><span class="params">(CompletableFuture&lt;?&gt;... cfs)</span>;</span><br></pre></td></tr></table></figure>

<p>allOf：等待所有任务完成</p>
<p>anyOf：只要有一个任务完成</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">    List&lt;CompletableFuture&gt; futures = Arrays.asList(CompletableFuture.completedFuture(<span class="string">&quot;hello&quot;</span>),</span><br><span class="line">                                                    CompletableFuture.completedFuture(<span class="string">&quot; world!&quot;</span>),</span><br><span class="line">                                                    CompletableFuture.completedFuture(<span class="string">&quot; hello&quot;</span>),</span><br><span class="line">                                                    CompletableFuture.completedFuture(<span class="string">&quot;java!&quot;</span>));</span><br><span class="line">    <span class="keyword">final</span> CompletableFuture&lt;Void&gt; allCompleted = CompletableFuture.allOf(futures.toArray(<span class="keyword">new</span> <span class="title class_">CompletableFuture</span>[]&#123;&#125;));</span><br><span class="line">    allCompleted.thenRun(() -&gt; &#123;</span><br><span class="line">        futures.stream().forEach(future -&gt; &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                System.out.println(<span class="string">&quot;get future at:&quot;</span>+System.currentTimeMillis()+<span class="string">&quot;, result:&quot;</span>+future.get());</span><br><span class="line">            &#125; <span class="keyword">catch</span> (InterruptedException | ExecutionException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>测试结果：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">get future at:1568892339473, result:hello</span><br><span class="line">get future at:1568892339473, result: world!</span><br><span class="line">get future at:1568892339473, result: hello</span><br><span class="line">get future at:1568892339473, result:java!</span><br></pre></td></tr></table></figure>

<p>几乎同时完成任务！</p>
<h2 id="2-7-优化商品详情页"><a href="#2-7-优化商品详情页" class="headerlink" title="2.7. 优化商品详情页"></a>2.7. 优化商品详情页</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ItemService</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> GmallPmsClient pmsClient;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> GmallWmsClient wmsClient;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> GmallSmsClient smsClient;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> ThreadPoolExecutor threadPoolExecutor;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> ItemVo <span class="title function_">load</span><span class="params">(Long skuId)</span> &#123;</span><br><span class="line"></span><br><span class="line">        <span class="type">ItemVo</span> <span class="variable">itemVo</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ItemVo</span>();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 根据skuId查询sku的信息1</span></span><br><span class="line">        CompletableFuture&lt;SkuEntity&gt; skuCompletableFuture = CompletableFuture.supplyAsync(() -&gt; &#123;</span><br><span class="line">            ResponseVo&lt;SkuEntity&gt; skuEntityResponseVo = <span class="built_in">this</span>.pmsClient.querySkuById(skuId);</span><br><span class="line">            <span class="type">SkuEntity</span> <span class="variable">skuEntity</span> <span class="operator">=</span> skuEntityResponseVo.getData();</span><br><span class="line">            <span class="keyword">if</span> (skuEntity == <span class="literal">null</span>) &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            itemVo.setSkuId(skuId);</span><br><span class="line">            itemVo.setTitle(skuEntity.getTitle());</span><br><span class="line">            itemVo.setSubTitle(skuEntity.getSubtitle());</span><br><span class="line">            itemVo.setPrice(skuEntity.getPrice());</span><br><span class="line">            itemVo.setWeight(skuEntity.getWeight());</span><br><span class="line">            itemVo.setDefaltImage(skuEntity.getDefaultImage());</span><br><span class="line">            <span class="keyword">return</span> skuEntity;</span><br><span class="line">        &#125;, threadPoolExecutor);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 根据cid3查询分类信息2</span></span><br><span class="line">        CompletableFuture&lt;Void&gt; categoryCompletableFuture = skuCompletableFuture.thenAcceptAsync(skuEntity -&gt; &#123;</span><br><span class="line">            ResponseVo&lt;List&lt;CategoryEntity&gt;&gt; categoryResponseVo = <span class="built_in">this</span>.pmsClient.queryCategoriesByCid3(skuEntity.getCategoryId());</span><br><span class="line">            List&lt;CategoryEntity&gt; categoryEntities = categoryResponseVo.getData();</span><br><span class="line">            itemVo.setCategories(categoryEntities);</span><br><span class="line">        &#125;, threadPoolExecutor);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 根据品牌的id查询品牌3</span></span><br><span class="line">        CompletableFuture&lt;Void&gt; brandCompletableFuture = skuCompletableFuture.thenAcceptAsync(skuEntity -&gt; &#123;</span><br><span class="line">            ResponseVo&lt;BrandEntity&gt; brandEntityResponseVo = <span class="built_in">this</span>.pmsClient.queryBrandById(skuEntity.getBrandId());</span><br><span class="line">            <span class="type">BrandEntity</span> <span class="variable">brandEntity</span> <span class="operator">=</span> brandEntityResponseVo.getData();</span><br><span class="line">            <span class="keyword">if</span> (brandEntity != <span class="literal">null</span>) &#123;</span><br><span class="line">                itemVo.setBrandId(brandEntity.getId());</span><br><span class="line">                itemVo.setBrandName(brandEntity.getName());</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;, threadPoolExecutor);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 根据spuId查询spu4</span></span><br><span class="line">        CompletableFuture&lt;Void&gt; spuCompletableFuture = skuCompletableFuture.thenAcceptAsync(skuEntity -&gt; &#123;</span><br><span class="line">            ResponseVo&lt;SpuEntity&gt; spuEntityResponseVo = <span class="built_in">this</span>.pmsClient.querySpuById(skuEntity.getSpuId());</span><br><span class="line">            <span class="type">SpuEntity</span> <span class="variable">spuEntity</span> <span class="operator">=</span> spuEntityResponseVo.getData();</span><br><span class="line">            <span class="keyword">if</span> (spuEntity != <span class="literal">null</span>) &#123;</span><br><span class="line">                itemVo.setSpuId(spuEntity.getId());</span><br><span class="line">                itemVo.setSpuName(spuEntity.getName());</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;, threadPoolExecutor);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 跟据skuId查询图片5</span></span><br><span class="line">        CompletableFuture&lt;Void&gt; skuImagesCompletableFuture = CompletableFuture.runAsync(() -&gt; &#123;</span><br><span class="line">            ResponseVo&lt;List&lt;SkuImagesEntity&gt;&gt; skuImagesResponseVo = <span class="built_in">this</span>.pmsClient.queryImagesBySkuId(skuId);</span><br><span class="line">            List&lt;SkuImagesEntity&gt; skuImagesEntities = skuImagesResponseVo.getData();</span><br><span class="line">            itemVo.setImages(skuImagesEntities);</span><br><span class="line">        &#125;, threadPoolExecutor);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 根据skuId查询sku营销信息6</span></span><br><span class="line">        CompletableFuture&lt;Void&gt; salesCompletableFuture = CompletableFuture.runAsync(() -&gt; &#123;</span><br><span class="line">            ResponseVo&lt;List&lt;ItemSaleVo&gt;&gt; salesResponseVo = <span class="built_in">this</span>.smsClient.querySalesBySkuId(skuId);</span><br><span class="line">            List&lt;ItemSaleVo&gt; sales = salesResponseVo.getData();</span><br><span class="line">            itemVo.setSales(sales);</span><br><span class="line">        &#125;, threadPoolExecutor);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 根据skuId查询sku的库存信息7</span></span><br><span class="line">        CompletableFuture&lt;Void&gt; storeCompletableFuture = CompletableFuture.runAsync(() -&gt; &#123;</span><br><span class="line">            ResponseVo&lt;List&lt;WareSkuEntity&gt;&gt; wareSkuResponseVo = <span class="built_in">this</span>.wmsClient.queryWareSkusBySkuId(skuId);</span><br><span class="line">            List&lt;WareSkuEntity&gt; wareSkuEntities = wareSkuResponseVo.getData();</span><br><span class="line">            <span class="keyword">if</span> (!CollectionUtils.isEmpty(wareSkuEntities)) &#123;</span><br><span class="line">                itemVo.setStore(wareSkuEntities.stream().anyMatch(wareSkuEntity -&gt; wareSkuEntity.getStock() - wareSkuEntity.getStockLocked() &gt; <span class="number">0</span>));</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;, threadPoolExecutor);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 根据spuId查询spu下的所有sku的销售属性</span></span><br><span class="line">        CompletableFuture&lt;Void&gt; saleAttrsCompletableFuture = skuCompletableFuture.thenAcceptAsync(skuEntity -&gt; &#123;</span><br><span class="line">            ResponseVo&lt;List&lt;SaleAttrValueVo&gt;&gt; saleAttrValueVoResponseVo = <span class="built_in">this</span>.pmsClient.querySkuAttrValuesBySpuId(skuEntity.getSpuId());</span><br><span class="line">            List&lt;SaleAttrValueVo&gt; saleAttrValueVos = saleAttrValueVoResponseVo.getData();</span><br><span class="line">            itemVo.setSaleAttrs(saleAttrValueVos);</span><br><span class="line">        &#125;, threadPoolExecutor);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 当前sku的销售属性</span></span><br><span class="line">        CompletableFuture&lt;Void&gt; saleAttrCompletableFuture = CompletableFuture.runAsync(() -&gt; &#123;</span><br><span class="line">            ResponseVo&lt;List&lt;SkuAttrValueEntity&gt;&gt; saleAttrResponseVo = <span class="built_in">this</span>.pmsClient.querySkuAttrValuesBySkuId(skuId);</span><br><span class="line">            List&lt;SkuAttrValueEntity&gt; skuAttrValueEntities = saleAttrResponseVo.getData();</span><br><span class="line">            Map&lt;Long, String&gt; map = skuAttrValueEntities.stream().collect(Collectors.toMap(SkuAttrValueEntity::getAttrId, SkuAttrValueEntity::getAttrValue));</span><br><span class="line">            itemVo.setSaleAttr(map);</span><br><span class="line">        &#125;, threadPoolExecutor);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 根据spuId查询spu下的所有sku及销售属性的映射关系</span></span><br><span class="line">        CompletableFuture&lt;Void&gt; skusJsonCompletableFuture = skuCompletableFuture.thenAcceptAsync(skuEntity -&gt; &#123;</span><br><span class="line">            ResponseVo&lt;String&gt; skusJsonResponseVo = <span class="built_in">this</span>.pmsClient.querySkusJsonBySpuId(skuEntity.getSpuId());</span><br><span class="line">            <span class="type">String</span> <span class="variable">skusJson</span> <span class="operator">=</span> skusJsonResponseVo.getData();</span><br><span class="line">            itemVo.setSkusJson(skusJson);</span><br><span class="line">        &#125;, threadPoolExecutor);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 根据spuId查询spu的海报信息9</span></span><br><span class="line">        CompletableFuture&lt;Void&gt; spuImagesCompletableFuture = skuCompletableFuture.thenAcceptAsync(skuEntity -&gt; &#123;</span><br><span class="line">            ResponseVo&lt;SpuDescEntity&gt; spuDescEntityResponseVo = <span class="built_in">this</span>.pmsClient.querySpuDescById(skuEntity.getSpuId());</span><br><span class="line">            <span class="type">SpuDescEntity</span> <span class="variable">spuDescEntity</span> <span class="operator">=</span> spuDescEntityResponseVo.getData();</span><br><span class="line">            <span class="keyword">if</span> (spuDescEntity != <span class="literal">null</span> &amp;&amp; StringUtils.isNotBlank(spuDescEntity.getDecript())) &#123;</span><br><span class="line">                String[] images = StringUtils.split(spuDescEntity.getDecript(), <span class="string">&quot;,&quot;</span>);</span><br><span class="line">                itemVo.setSpuImages(Arrays.asList(images));</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;, threadPoolExecutor);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 根据cid3 spuId skuId查询组及组下的规格参数及值 10</span></span><br><span class="line">        CompletableFuture&lt;Void&gt; groupCompletableFuture = skuCompletableFuture.thenAcceptAsync(skuEntity -&gt; &#123;</span><br><span class="line">            ResponseVo&lt;List&lt;ItemGroupVo&gt;&gt; groupResponseVo = <span class="built_in">this</span>.pmsClient.queryGoupsWithAttrValues(skuEntity.getCategoryId(), skuEntity.getSpuId(), skuId);</span><br><span class="line">            List&lt;ItemGroupVo&gt; itemGroupVos = groupResponseVo.getData();</span><br><span class="line">            itemVo.setGroups(itemGroupVos);</span><br><span class="line">        &#125;, threadPoolExecutor);</span><br><span class="line"></span><br><span class="line">        CompletableFuture.allOf(categoryCompletableFuture, brandCompletableFuture, spuCompletableFuture,</span><br><span class="line">                skuImagesCompletableFuture, salesCompletableFuture, storeCompletableFuture, saleAttrsCompletableFuture,</span><br><span class="line">                saleAttrCompletableFuture, skusJsonCompletableFuture, spuImagesCompletableFuture, groupCompletableFuture).join();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> itemVo;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h1 id="3-前后端联调"><a href="#3-前后端联调" class="headerlink" title="3. 前后端联调"></a>3. 前后端联调</h1><p>把课前资料《前端工程\动态页面》的对应item.html和common目录copy到工程：</p>
<p> <img src="/assets/1589448529092.png" alt="1589448529092"></p>
<p>并在pom.xml中引入thymeleaf依赖：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-thymeleaf<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>在application.yml中添加thymeleaf的配置：</p>
<p><img src="/assets/1589450178655.png" alt="1589450178655"></p>
<p>修改nginx中的配置，添加item.gmall.com域名</p>
<p><img src="/assets/1589448463053.png" alt="1589448463053"></p>
<p>网关中添加添加同步路由：</p>
<p><img src="/assets/1589449144103.png" alt="1589449144103"></p>
<h2 id="3-1-跳转到商品详情页"><a href="#3-1-跳转到商品详情页" class="headerlink" title="3.1. 跳转到商品详情页"></a>3.1. 跳转到商品详情页</h2><p>修改ItemController的方法调转到商品详情页面：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="comment">//@RequestMapping(&quot;item&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ItemController</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> ItemService itemService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(&quot;&#123;skuId&#125;.html&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">load</span><span class="params">(<span class="meta">@PathVariable(&quot;skuId&quot;)</span>Long skuId, Model model)</span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="type">ItemVo</span> <span class="variable">itemVo</span> <span class="operator">=</span> <span class="built_in">this</span>.itemService.load(skuId);</span><br><span class="line">        model.addAttribute(<span class="string">&quot;itemVo&quot;</span>, itemVo);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;item&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h2 id="3-2-页面结构"><a href="#3-2-页面结构" class="headerlink" title="3.2. 页面结构"></a>3.2. 页面结构</h2><p>参照京东的商品详情页，如下：</p>
<p><img src="/assets/1589461080401.png" alt="1589461080401"></p>
<p>主要包含3部分：面包屑、sku大图片及基本信息、页面下方的商品详情。</p>
<p>谷粒商城也是包含这三部分内容，页面源码结构如下：</p>
<p><img src="/assets/1589460868869.png" alt="1589460868869"></p>
<h2 id="3-3-面包屑"><a href="#3-3-面包屑" class="headerlink" title="3.3. 面包屑"></a>3.3. 面包屑</h2><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 面包屑：分类 品牌 spu --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;crumb-wrap&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">ul</span> <span class="attr">class</span>=<span class="string">&quot;sui-breadcrumb&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">li</span> <span class="attr">th:each</span>=<span class="string">&quot;category : *&#123;categories&#125;&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;#&quot;</span> <span class="attr">th:text</span>=<span class="string">&quot;$&#123;category.name&#125;&quot;</span>&gt;</span>手机、数码、通讯<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">li</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;#&quot;</span> <span class="attr">th:text</span>=<span class="string">&quot;*&#123;brandName&#125;&quot;</span>&gt;</span>Apple苹果<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">&quot;active&quot;</span> <span class="attr">th:text</span>=<span class="string">&quot;*&#123;spuName&#125;&quot;</span>&gt;</span>iphone 6S系类<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>



<h2 id="3-4-商品基本信息"><a href="#3-4-商品基本信息" class="headerlink" title="3.4. 商品基本信息"></a>3.4. 商品基本信息</h2><p><img src="/assets/1589714713684.png" alt="1589714713684"></p>
<h3 id="3-4-1-商品图片列表"><a href="#3-4-1-商品图片列表" class="headerlink" title="3.4.1. 商品图片列表"></a>3.4.1. 商品图片列表</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 商品大图片列表 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;fl preview-wrap&quot;</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--放大镜效果--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;zoom&quot;</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--图片预览--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;preview&quot;</span> <span class="attr">class</span>=<span class="string">&quot;spec-preview&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">&quot;jqzoom&quot;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">img</span> <span class="attr">th:jqimg</span>=<span class="string">&quot;*&#123;defaltImage&#125;&quot;</span> <span class="attr">th:src</span>=<span class="string">&quot;*&#123;defaltImage&#125;&quot;</span> <span class="attr">width</span>=<span class="string">&quot;400&quot;</span> <span class="attr">height</span>=<span class="string">&quot;400&quot;</span> /&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--下方的缩略图--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;spec-scroll&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">a</span> <span class="attr">class</span>=<span class="string">&quot;prev&quot;</span>&gt;</span><span class="symbol">&amp;lt;</span><span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!--左右按钮--&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;items&quot;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">ul</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">li</span> <span class="attr">th:each</span>=<span class="string">&quot;image : *&#123;images&#125;&quot;</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">img</span> <span class="attr">th:src</span>=<span class="string">&quot;$&#123;image.url&#125;&quot;</span> <span class="attr">th:bimg</span>=<span class="string">&quot;$&#123;image.url&#125;&quot;</span> <span class="attr">onmousemove</span>=<span class="string">&quot;preview(this)&quot;</span> /&gt;</span></span><br><span class="line">                    <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">a</span> <span class="attr">class</span>=<span class="string">&quot;next&quot;</span>&gt;</span><span class="symbol">&amp;gt;</span><span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>



<h3 id="3-4-2-sku基本信息"><a href="#3-4-2-sku基本信息" class="headerlink" title="3.4.2. sku基本信息"></a>3.4.2. sku基本信息</h3><p>包含：标题 副标题 价格 促销 重量等等</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 标题 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;sku-name&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h4</span> <span class="attr">th:text</span>=<span class="string">&quot;*&#123;title&#125;&quot;</span>&gt;</span>Apple iPhone 6s（A1700）64G玫瑰金色 移动通信电信4G手机<span class="tag">&lt;/<span class="name">h4</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 副标题 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;news&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">span</span> <span class="attr">th:text</span>=<span class="string">&quot;*&#123;subTitle&#125;&quot;</span>&gt;</span>推荐选择下方[移动优惠购],手机套餐齐搞定,不用换号,每月还有花费返<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 价格、评价、促销 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;summary&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;summary-wrap&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;fl title&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">i</span>&gt;</span>价　　格<span class="tag">&lt;/<span class="name">i</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;fl price&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">i</span>&gt;</span>¥<span class="tag">&lt;/<span class="name">i</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">$&#123;#numbers.formatDecimal(num,0,&#x27;COMMA&#x27;,2,&#x27;POINT&#x27;)&#125;则显示 .00</span></span><br><span class="line"><span class="comment">$&#123;#numbers.formatDecimal(num,1,&#x27;COMMA&#x27;,2,&#x27;POINT&#x27;)&#125;则显示 0.00</span></span><br><span class="line"><span class="comment">--&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">em</span> <span class="attr">th:text</span>=<span class="string">&quot;*&#123;#numbers.formatDecimal(price, 1, &#x27;COMMA&#x27;, 2, &#x27;POINT&#x27;)&#125;&quot;</span>&gt;</span>5999.00<span class="tag">&lt;/<span class="name">em</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">span</span>&gt;</span>降价通知<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;fr remark&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">i</span>&gt;</span>累计评价<span class="tag">&lt;/<span class="name">i</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">em</span>&gt;</span>62344<span class="tag">&lt;/<span class="name">em</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;summary-wrap&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;fl title&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">i</span>&gt;</span>促　　销<span class="tag">&lt;/<span class="name">i</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;fl fix-width&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">th:each</span>=<span class="string">&quot;sale : *&#123;sales&#125;&quot;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">i</span> <span class="attr">class</span>=<span class="string">&quot;red-bg&quot;</span> <span class="attr">th:text</span>=<span class="string">&quot;$&#123;sale.type&#125;&quot;</span>&gt;</span>加价购<span class="tag">&lt;/<span class="name">i</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">em</span> <span class="attr">class</span>=<span class="string">&quot;t-gray&quot;</span> <span class="attr">th:text</span>=<span class="string">&quot;$&#123;sale.desc&#125;&quot;</span>&gt;</span>满999.00另加20.00元，或满1999.00另加30.00元，或满2999.00另加40.00元，即可在购物车换购热销商品<span class="tag">&lt;/<span class="name">em</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 支持 配送 重量 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;support&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;summary-wrap&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;fl title&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">i</span>&gt;</span>支　　持<span class="tag">&lt;/<span class="name">i</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;fl fix-width&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">em</span> <span class="attr">class</span>=<span class="string">&quot;t-gray&quot;</span>&gt;</span>以旧换新，闲置手机回收 4G套餐超值抢 礼品购<span class="tag">&lt;/<span class="name">em</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;summary-wrap&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;fl title&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">i</span>&gt;</span>配 送 至<span class="tag">&lt;/<span class="name">i</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;fl fix-width&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">em</span> <span class="attr">class</span>=<span class="string">&quot;t-gray&quot;</span>&gt;</span>上海市松江区大江商厦6层<span class="tag">&lt;/<span class="name">em</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;summary-wrap&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;fl title&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">i</span>&gt;</span>重 量(g)<span class="tag">&lt;/<span class="name">i</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;fl fix-width&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">em</span> <span class="attr">class</span>=<span class="string">&quot;t-gray&quot;</span> <span class="attr">th:text</span>=<span class="string">&quot;*&#123;weight&#125;&quot;</span>&gt;</span>500<span class="tag">&lt;/<span class="name">em</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>



<h3 id="3-4-3-销售属性"><a href="#3-4-3-销售属性" class="headerlink" title="3.4.3. 销售属性"></a>3.4.3. 销售属性</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 销售属性 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;clearfix choose&quot;</span> <span class="attr">id</span>=<span class="string">&quot;app&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;specification&quot;</span> <span class="attr">class</span>=<span class="string">&quot;summary-wrap clearfix&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dl</span> <span class="attr">v-for</span>=<span class="string">&quot;attr in saleAttrs&quot;</span> <span class="attr">:key</span>=<span class="string">&quot;attr.attrId&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">dt</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;fl title&quot;</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">i</span>&gt;</span>选择&#123;&#123;attr.attrName&#125;&#125;<span class="tag">&lt;/<span class="name">i</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">dt</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">dd</span> <span class="attr">v-for</span>=<span class="string">&quot;attrValue,index in attr.attrValues&quot;</span> <span class="attr">:key</span>=<span class="string">&quot;index&quot;</span> @<span class="attr">click</span>=<span class="string">&quot;saleAttr[attr.attrId]=attrValue&quot;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;javascript:;&quot;</span> <span class="attr">:class</span>=<span class="string">&quot;&#123;&#x27;selected&#x27;:attrValue === saleAttr[attr.attrId]&#125;&quot;</span>&gt;</span>&#123;&#123;attrValue&#125;&#125;<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">dd</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dl</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>vuejs的代码实现：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">th:inline</span>=<span class="string">&quot;javascript&quot;</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">new</span> <span class="title class_">Vue</span>(&#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="attr">el</span>: <span class="string">&#x27;#app&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">        <span class="attr">data</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="attr">saleAttrs</span>: [[$&#123;itemVo.<span class="property">saleAttrs</span>&#125;]], <span class="comment">// 销售属性可选项</span></span></span><br><span class="line"><span class="language-javascript">            <span class="attr">saleAttr</span>: [[$&#123;itemVo.<span class="property">saleAttr</span>&#125;]],</span></span><br><span class="line"><span class="language-javascript">            <span class="attr">skusJson</span>: <span class="title class_">JSON</span>.<span class="title function_">parse</span>(<span class="built_in">decodeURI</span>([[$&#123;itemVo.<span class="property">skusJson</span>&#125;]])), <span class="comment">// 销售属性和skuId的关系</span></span></span><br><span class="line"><span class="language-javascript">        <span class="attr">skuId</span>: [[$&#123;itemVo.<span class="property">skuId</span>&#125;]]</span></span><br><span class="line"><span class="language-javascript">    &#125;,</span></span><br><span class="line"><span class="language-javascript">        <span class="attr">watch</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="attr">saleAttr</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">deep</span>: <span class="literal">true</span>,</span></span><br><span class="line"><span class="language-javascript">                    <span class="title function_">handler</span>(<span class="params">newSaleAttr</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">                    <span class="variable language_">console</span>.<span class="title function_">log</span>(newSaleAttr)</span></span><br><span class="line"><span class="language-javascript">                    <span class="keyword">let</span> key = <span class="title class_">Object</span>.<span class="title function_">values</span>(newSaleAttr).<span class="title function_">join</span>(<span class="string">&quot;,&quot;</span>)</span></span><br><span class="line"><span class="language-javascript">                    <span class="variable language_">this</span>.<span class="property">skuId</span> = <span class="variable language_">this</span>.<span class="property">skusJson</span>[key]</span></span><br><span class="line"><span class="language-javascript">                    <span class="variable language_">window</span>.<span class="property">location</span> = <span class="string">`http://item.gmall.com/<span class="subst">$&#123;<span class="variable language_">this</span>.skuId&#125;</span>.html`</span></span></span><br><span class="line"><span class="language-javascript">                &#125;</span></span><br><span class="line"><span class="language-javascript">            &#125;</span></span><br><span class="line"><span class="language-javascript">        &#125;</span></span><br><span class="line"><span class="language-javascript">    &#125;)</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>



<h2 id="3-5-商品详情"><a href="#3-5-商品详情" class="headerlink" title="3.5. 商品详情"></a>3.5. 商品详情</h2><p>商品描述大海报的渲染：</p>
<p><img src="/assets/1589715253381.png" alt="1589715253381"></p>
<p>规格参数的渲染：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 规格参数 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;two&quot;</span> <span class="attr">class</span>=<span class="string">&quot;tab-pane&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;Ptable&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;Ptable-item&quot;</span> <span class="attr">th:each</span>=<span class="string">&quot;group : *&#123;groups&#125;&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">h3</span> <span class="attr">th:text</span>=<span class="string">&quot;$&#123;group.groupName&#125;&quot;</span>&gt;</span>主体<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">dl</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">div</span> <span class="attr">th:each</span>=<span class="string">&quot;attr : $&#123;group.attrValues&#125;&quot;</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">dt</span> <span class="attr">th:text</span>=<span class="string">&quot;$&#123;attr.attrName&#125;&quot;</span>&gt;</span>品牌<span class="tag">&lt;/<span class="name">dt</span>&gt;</span><span class="tag">&lt;<span class="name">dd</span> <span class="attr">th:text</span>=<span class="string">&quot;$&#123;attr.attrValue&#125;&quot;</span>&gt;</span>华为（HUAWEI）<span class="tag">&lt;/<span class="name">dd</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">dl</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>





</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta"><i class="fas fa-circle-user fa-fw"></i>文章作者: </span><span class="post-copyright-info"><a href="https://beiliu266.github.io">John Doe</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta"><i class="fas fa-square-arrow-up-right fa-fw"></i>文章链接: </span><span class="post-copyright-info"><a href="https://beiliu266.github.io/2024/01/09/guli/10%E3%80%81%E5%95%86%E5%93%81%E8%AF%A6%E6%83%85%E9%A1%B5-%E5%BC%82%E6%AD%A5%E7%BC%96%E6%8E%92/">https://beiliu266.github.io/2024/01/09/guli/10%E3%80%81%E5%95%86%E5%93%81%E8%AF%A6%E6%83%85%E9%A1%B5-%E5%BC%82%E6%AD%A5%E7%BC%96%E6%8E%92/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta"><i class="fas fa-circle-exclamation fa-fw"></i>版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="https://beiliu266.github.io" target="_blank">Hexo</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"></div><div class="post_share"><div class="social-share" data-image="https://i.loli.net/2021/02/24/5O1day2nriDzjSu.png" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/2024/01/09/guli/9%E3%80%81%E9%A6%96%E9%A1%B5%E5%95%86%E5%93%81%E5%88%86%E7%B1%BB/" title=""><div class="cover" style="background: var(--default-bg-color)"></div><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info"></div></div></a></div><div class="next-post pull-right"><a href="/2024/01/09/guli/8%E3%80%81rabbitmq/" title=""><div class="cover" style="background: var(--default-bg-color)"></div><div class="pagination-info"><div class="label">下一篇</div><div class="next_info"></div></div></a></div></nav></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src="https://i.loli.net/2021/02/24/5O1day2nriDzjSu.png" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__name">John Doe</div><div class="author-info__description"></div></div><div class="card-info-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">27</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">0</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">0</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/xxxxxx"><i class="fab fa-github"></i><span>Follow Me</span></a></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>公告</span></div><div class="announcement_content">This is my Blog</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#1-%E5%95%86%E5%93%81%E8%AF%A6%E6%83%85"><span class="toc-number">1.</span> <span class="toc-text">1. 商品详情</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-1-%E5%88%9B%E5%BB%BAmodule"><span class="toc-number">1.1.</span> <span class="toc-text">1.1. 创建module</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#1-2-%E6%95%B0%E6%8D%AE%E6%A8%A1%E5%9E%8B"><span class="toc-number">1.2.</span> <span class="toc-text">1.2. 数据模型</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#1-3-%E8%BF%9C%E7%A8%8B%E8%B0%83%E7%94%A8%E6%8E%A5%E5%8F%A3"><span class="toc-number">1.3.</span> <span class="toc-text">1.3. 远程调用接口</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-3-1-%E6%B7%BB%E5%8A%A0%E8%BF%9C%E7%A8%8B%E6%8E%A5%E5%8F%A3"><span class="toc-number">1.3.1.</span> <span class="toc-text">1.3.1. 添加远程接口</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-3-2-%E6%A0%B9%E6%8D%AE%E4%B8%89%E7%BA%A7%E5%88%86%E7%B1%BBid%E6%9F%A5%E8%AF%A2%E4%B8%80%E4%BA%8C%E4%B8%89%E7%BA%A7%E5%88%86%E7%B1%BB"><span class="toc-number">1.3.2.</span> <span class="toc-text">1.3.2. 根据三级分类id查询一二三级分类</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-3-3-%E6%A0%B9%E6%8D%AEskuId%E6%9F%A5%E8%AF%A2sku%E7%9A%84%E5%9B%BE%E7%89%87"><span class="toc-number">1.3.3.</span> <span class="toc-text">1.3.3. 根据skuId查询sku的图片</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-3-4-%E6%9F%A5%E8%AF%A2sku%E7%9A%84%E8%90%A5%E9%94%80%E4%BF%A1%E6%81%AF"><span class="toc-number">1.3.4.</span> <span class="toc-text">1.3.4. 查询sku的营销信息</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-3-5-%E6%A0%B9%E6%8D%AEspuId%E6%9F%A5%E8%AF%A2spu%E4%B8%8B%E7%9A%84%E6%89%80%E6%9C%89%E9%94%80%E5%94%AE%E5%B1%9E%E6%80%A7"><span class="toc-number">1.3.5.</span> <span class="toc-text">1.3.5. 根据spuId查询spu下的所有销售属性</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-3-6-%E6%9F%A5%E8%AF%A2spu%E4%B8%8BskuId%E5%8F%8A%E9%94%80%E5%94%AE%E5%B1%9E%E6%80%A7%E7%9A%84%E5%85%B3%E7%B3%BB"><span class="toc-number">1.3.6.</span> <span class="toc-text">1.3.6. 查询spu下skuId及销售属性的关系</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-3-7-%E6%9F%A5%E8%AF%A2%E7%BB%84%E5%8F%8A%E7%BB%84%E4%B8%8B%E5%8F%82%E6%95%B0%E5%92%8C%E5%80%BC"><span class="toc-number">1.3.7.</span> <span class="toc-text">1.3.7. 查询组及组下参数和值</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#1-4-%E7%BB%99%E5%95%86%E5%93%81%E8%AF%A6%E6%83%85%E9%A1%B5%E6%8F%90%E4%BE%9B%E6%95%B0%E6%8D%AE"><span class="toc-number">1.4.</span> <span class="toc-text">1.4. 给商品详情页提供数据</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#2-CompletableFuture%E5%BC%82%E6%AD%A5%E8%B0%83%E7%94%A8"><span class="toc-number">2.</span> <span class="toc-text">2. CompletableFuture异步调用</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#2-1-%E7%BA%BF%E7%A8%8B%E5%9B%9E%E9%A1%BE"><span class="toc-number">2.1.</span> <span class="toc-text">2.1. 线程回顾</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-2-CompletableFuture%E4%BB%8B%E7%BB%8D"><span class="toc-number">2.2.</span> <span class="toc-text">2.2. CompletableFuture介绍</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-3-%E5%88%9B%E5%BB%BA%E5%BC%82%E6%AD%A5%E5%AF%B9%E8%B1%A1"><span class="toc-number">2.3.</span> <span class="toc-text">2.3. 创建异步对象</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-4-%E8%AE%A1%E7%AE%97%E5%AE%8C%E6%88%90%E6%97%B6%E5%9B%9E%E8%B0%83%E6%96%B9%E6%B3%95"><span class="toc-number">2.4.</span> <span class="toc-text">2.4. 计算完成时回调方法</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-5-%E7%BA%BF%E7%A8%8B%E4%B8%B2%E8%A1%8C%E5%8C%96%E6%96%B9%E6%B3%95"><span class="toc-number">2.5.</span> <span class="toc-text">2.5. 线程串行化方法</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-6-%E5%A4%9A%E4%BB%BB%E5%8A%A1%E7%BB%84%E5%90%88"><span class="toc-number">2.6.</span> <span class="toc-text">2.6. 多任务组合</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-7-%E4%BC%98%E5%8C%96%E5%95%86%E5%93%81%E8%AF%A6%E6%83%85%E9%A1%B5"><span class="toc-number">2.7.</span> <span class="toc-text">2.7. 优化商品详情页</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#3-%E5%89%8D%E5%90%8E%E7%AB%AF%E8%81%94%E8%B0%83"><span class="toc-number">3.</span> <span class="toc-text">3. 前后端联调</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#3-1-%E8%B7%B3%E8%BD%AC%E5%88%B0%E5%95%86%E5%93%81%E8%AF%A6%E6%83%85%E9%A1%B5"><span class="toc-number">3.1.</span> <span class="toc-text">3.1. 跳转到商品详情页</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-2-%E9%A1%B5%E9%9D%A2%E7%BB%93%E6%9E%84"><span class="toc-number">3.2.</span> <span class="toc-text">3.2. 页面结构</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-3-%E9%9D%A2%E5%8C%85%E5%B1%91"><span class="toc-number">3.3.</span> <span class="toc-text">3.3. 面包屑</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-4-%E5%95%86%E5%93%81%E5%9F%BA%E6%9C%AC%E4%BF%A1%E6%81%AF"><span class="toc-number">3.4.</span> <span class="toc-text">3.4. 商品基本信息</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#3-4-1-%E5%95%86%E5%93%81%E5%9B%BE%E7%89%87%E5%88%97%E8%A1%A8"><span class="toc-number">3.4.1.</span> <span class="toc-text">3.4.1. 商品图片列表</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-4-2-sku%E5%9F%BA%E6%9C%AC%E4%BF%A1%E6%81%AF"><span class="toc-number">3.4.2.</span> <span class="toc-text">3.4.2. sku基本信息</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-4-3-%E9%94%80%E5%94%AE%E5%B1%9E%E6%80%A7"><span class="toc-number">3.4.3.</span> <span class="toc-text">3.4.3. 销售属性</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-5-%E5%95%86%E5%93%81%E8%AF%A6%E6%83%85"><span class="toc-number">3.5.</span> <span class="toc-text">3.5. 商品详情</span></a></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2024/01/09/guli/14%E3%80%81%E6%94%AF%E4%BB%98%E3%80%81%E7%A7%92%E6%9D%80/" title="无题">无题</a><time datetime="2024-01-09T12:30:18.807Z" title="发表于 2024-01-09 20:30:18">2024-01-09</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2024/01/09/guli/12%E3%80%81%E8%B4%AD%E7%89%A9%E8%BD%A6%E3%80%81SpringTask/" title="无题">无题</a><time datetime="2024-01-09T12:30:18.807Z" title="发表于 2024-01-09 20:30:18">2024-01-09</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2024/01/09/guli/13%E3%80%81%E8%AE%A2%E5%8D%95%E3%80%81%E5%BA%93%E5%AD%98/" title="无题">无题</a><time datetime="2024-01-09T12:30:18.807Z" title="发表于 2024-01-09 20:30:18">2024-01-09</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2024/01/09/guli/es%E5%85%A5%E9%97%A8/" title="无题">无题</a><time datetime="2024-01-09T12:30:18.807Z" title="发表于 2024-01-09 20:30:18">2024-01-09</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2024/01/09/guli/11%E3%80%81%E5%8D%95%E7%82%B9%E7%99%BB%E5%BD%95%EF%BC%88jwt%EF%BC%89/" title="无题">无题</a><time datetime="2024-01-09T12:30:18.803Z" title="发表于 2024-01-09 20:30:18">2024-01-09</time></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div class="copyright">&copy;2020 - 2024 By John Doe</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="回到顶部"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox/fancybox.umd.min.js"></script><div class="js-pjax"></div><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div><script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"log":false,"pluginJsPath":"lib/","pluginModelPath":"assets/","pluginRootPath":"live2dw/","tagMode":false});</script></body></html>