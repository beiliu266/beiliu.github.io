<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>Hexo | Hexo</title><meta name="author" content="John Doe"><meta name="copyright" content="John Doe"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="title:规格参数及商品新增商品系统接口商城的核心自然是商品，而商品多了以后，肯定要进行分类，并且不同的商品会有不同的品牌信息，我们需要依次去完成：品牌、商品分类、商品的开发。 品牌在系统搭建后，增删改查甚至文件上传都可以正常使用。 接下来完善商品分类及商品功能的增删改查功能。 参考课前资料中的《后台管理系统接口文档.md》    程序源码论坛-1024，网址 www.cx1314.cn  仅">
<meta property="og:type" content="article">
<meta property="og:title" content="Hexo">
<meta property="og:url" content="https://beiliu266.github.io/2024/01/09/guli/3%E3%80%81%E8%A7%84%E6%A0%BC%E5%8F%82%E6%95%B0%E5%8F%8A%E5%95%86%E5%93%81%E6%96%B0%E5%A2%9E/index.html">
<meta property="og:site_name" content="Hexo">
<meta property="og:description" content="title:规格参数及商品新增商品系统接口商城的核心自然是商品，而商品多了以后，肯定要进行分类，并且不同的商品会有不同的品牌信息，我们需要依次去完成：品牌、商品分类、商品的开发。 品牌在系统搭建后，增删改查甚至文件上传都可以正常使用。 接下来完善商品分类及商品功能的增删改查功能。 参考课前资料中的《后台管理系统接口文档.md》    程序源码论坛-1024，网址 www.cx1314.cn  仅">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://i.loli.net/2021/02/24/5O1day2nriDzjSu.png">
<meta property="article:published_time" content="2024-01-09T12:30:18.795Z">
<meta property="article:modified_time" content="2024-01-09T12:42:28.229Z">
<meta property="article:author" content="John Doe">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://i.loli.net/2021/02/24/5O1day2nriDzjSu.png"><link rel="shortcut icon" href="/img/favicon.png"><link rel="canonical" href="https://beiliu266.github.io/2024/01/09/guli/3%E3%80%81%E8%A7%84%E6%A0%BC%E5%8F%82%E6%95%B0%E5%8F%8A%E5%95%86%E5%93%81%E6%96%B0%E5%A2%9E/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox/fancybox.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  dateSuffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: undefined,
  infinitegrid: {
    js: 'https://cdn.jsdelivr.net/npm/@egjs/infinitegrid/dist/infinitegrid.min.js',
    buttonText: '加载更多'
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: false,
  },
  autoDarkmode: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'Hexo',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2024-01-09 20:42:28'
}</script><script>(win=>{
      win.saveToLocal = {
        set: (key, value, ttl) => {
          if (ttl === 0) return
          const now = Date.now()
          const expiry = now + ttl * 86400000
          const item = {
            value,
            expiry
          }
          localStorage.setItem(key, JSON.stringify(item))
        },
      
        get: key => {
          const itemStr = localStorage.getItem(key)
      
          if (!itemStr) {
            return undefined
          }
          const item = JSON.parse(itemStr)
          const now = Date.now()
      
          if (now > item.expiry) {
            localStorage.removeItem(key)
            return undefined
          }
          return item.value
        }
      }
    
      win.getScript = (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        script.onerror = reject
        script.onload = script.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          script.onload = script.onreadystatechange = null
          resolve()
        }

        Object.keys(attr).forEach(key => {
          script.setAttribute(key, attr[key])
        })

        document.head.appendChild(script)
      })
    
      win.getCSS = (url, id = false) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onerror = reject
        link.onload = link.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          link.onload = link.onreadystatechange = null
          resolve()
        }
        document.head.appendChild(link)
      })
    
      win.activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
        if (t === 'dark') activateDarkMode()
        else if (t === 'light') activateLightMode()
      
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
      const detectApple = () => {
        if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
          document.documentElement.classList.add('apple')
        }
      }
      detectApple()
    })(window)</script><meta name="generator" content="Hexo 7.0.0"></head><body><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="https://i.loli.net/2021/02/24/5O1day2nriDzjSu.png" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="sidebar-site-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">28</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">0</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">0</div></a></div><hr class="custom-hr"/></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header"><nav id="nav"><span id="blog-info"><a href="/" title="Hexo"><span class="site-name">Hexo</span></a></span><div id="menus"><div id="toggle-menu"><a class="site-page" href="javascript:void(0);"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">无题</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2024-01-09T12:30:18.795Z" title="发表于 2024-01-09 20:30:18">2024-01-09</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2024-01-09T12:42:28.229Z" title="更新于 2024-01-09 20:42:28">2024-01-09</time></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title=""><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><hr>
<h2 id="title-规格参数及商品新增"><a href="#title-规格参数及商品新增" class="headerlink" title="title:规格参数及商品新增"></a>title:规格参数及商品新增</h2><h1 id="商品系统接口"><a href="#商品系统接口" class="headerlink" title="商品系统接口"></a>商品系统接口</h1><p>商城的核心自然是商品，而商品多了以后，肯定要进行分类，并且不同的商品会有不同的品牌信息，我们需要依次去完成：品牌、商品分类、商品的开发。</p>
<p>品牌在系统搭建后，增删改查甚至文件上传都可以正常使用。</p>
<p>接下来完善商品分类及商品功能的增删改查功能。</p>
<p>参考课前资料中的《后台管理系统接口文档.md》</p>
<pre><code>   程序源码论坛-1024，网址 www.cx1314.cn  仅分享最流行最优质的IT资源！	

   不同于其他论坛平台，这里只有精品、稀有资源，已泛滥、已过时、垃圾资源不录入！

   Java,前端,python,人工智能,大数据,云计算...持续更新资源-最新完整且均不加密、、、
</code></pre>
<p>活动线报，宅男福利，最新大片…</p>
<pre><code>   程序员的新大陆-更新最快的IT资源社区！开发者必备平台！

   欢迎访问：www.cx1314.cn      百度搜索-&gt;  程序源码论坛
</code></pre>
<h1 id="1-商品分类"><a href="#1-商品分类" class="headerlink" title="1. 商品分类"></a>1. 商品分类</h1><p>数据结构：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> `pms_category` (</span><br><span class="line">  `id` <span class="type">bigint</span>(<span class="number">20</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> AUTO_INCREMENT COMMENT <span class="string">&#x27;分类id&#x27;</span>,</span><br><span class="line">  `name` <span class="type">char</span>(<span class="number">50</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;分类名称&#x27;</span>,</span><br><span class="line">  `parent_id` <span class="type">bigint</span>(<span class="number">20</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;父分类id&#x27;</span>,</span><br><span class="line">  `status` tinyint(<span class="number">4</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;是否显示[0-不显示，1显示]&#x27;</span>,</span><br><span class="line">  `sort` <span class="type">int</span>(<span class="number">11</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;排序&#x27;</span>,</span><br><span class="line">  `icon` <span class="type">char</span>(<span class="number">255</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;图标地址&#x27;</span>,</span><br><span class="line">  `unit` <span class="type">char</span>(<span class="number">50</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;计量单位&#x27;</span>,</span><br><span class="line">  <span class="keyword">PRIMARY</span> KEY (`id`)</span><br><span class="line">) ENGINE<span class="operator">=</span>InnoDB AUTO_INCREMENT<span class="operator">=</span><span class="number">1433</span> <span class="keyword">DEFAULT</span> CHARSET<span class="operator">=</span>utf8mb4 COMMENT<span class="operator">=</span><span class="string">&#x27;商品三级分类&#x27;</span>;</span><br></pre></td></tr></table></figure>

<p>因为商品分类会有层级关系，因此这里我们加入了<code>parent_id</code>字段，对本表中的其它分类进行自关联。</p>
<p><img src="/assets/1584591973794.png" alt="1584591973794"></p>
<p>查看控制台，浏览器会发出如下请求</p>
<p><img src="/assets/1584592964081.png" alt="1584592964081"></p>
<p>参照接口文档，开发接口</p>
<h2 id="1-1-CategoryController"><a href="#1-1-CategoryController" class="headerlink" title="1.1.   CategoryController"></a>1.1.   CategoryController</h2><p>请求地址：parent&#x2F;{parentId}，因为&#x2F;pms&#x2F;category已经配置在CategoryController上</p>
<p>请求方式：GET</p>
<p>请求参数：parentId</p>
<p>响应：<code>ResponseVO&lt;List&lt;CategoryEntity&gt;&gt;</code></p>
<p>给CategoryController添加一个查询方法：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ApiOperation(&quot;根据父id查询分类&quot;)</span></span><br><span class="line"><span class="meta">@GetMapping(&quot;parent/&#123;parentId&#125;&quot;)</span></span><br><span class="line"><span class="keyword">public</span> ResponseVo&lt;List&lt;CategoryEntity&gt;&gt; <span class="title function_">queryCategory</span><span class="params">(<span class="meta">@PathVariable(&quot;parentId&quot;)</span>Long parentId)</span>&#123;</span><br><span class="line">    List&lt;CategoryEntity&gt; categoryEntityList = <span class="built_in">this</span>.categoryService.queryCategory(parentId);</span><br><span class="line">    <span class="keyword">return</span> ResponseVo.ok(categoryEntityList);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h2 id="1-2-CategoryService"><a href="#1-2-CategoryService" class="headerlink" title="1.2.   CategoryService"></a>1.2.   CategoryService</h2><p>在CategoryService接口中添加接口方法</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">List&lt;CategoryEntity&gt; <span class="title function_">queryCategory</span><span class="params">(Long parentId)</span>;</span><br></pre></td></tr></table></figure>

<p>在CategoryServiceImpl实现类中实现该方法：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> CategoryMapper categoryMapper;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> List&lt;CategoryEntity&gt; <span class="title function_">queryCategory</span><span class="params">(Long parentId)</span> &#123;</span><br><span class="line">    <span class="comment">// 构造查询条件</span></span><br><span class="line">    QueryWrapper&lt;CategoryEntity&gt; wrapper = <span class="keyword">new</span> <span class="title class_">QueryWrapper</span>&lt;&gt;();</span><br><span class="line">    <span class="comment">// 如果parentId为-1，说明用户没有传该字段，查询所有</span></span><br><span class="line">    <span class="keyword">if</span> (parentId != -<span class="number">1</span>)&#123;</span><br><span class="line">        wrapper.eq(<span class="string">&quot;parent_id&quot;</span>, parentId);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">this</span>.categoryMapper.selectList(wrapper);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h2 id="1-3-重启测试"><a href="#1-3-重启测试" class="headerlink" title="1.3.   重启测试"></a>1.3.   重启测试</h2><p><img src="/assets/1567475835910.png" alt="1567475835910"></p>
<h2 id="1-4-根据父节点查询"><a href="#1-4-根据父节点查询" class="headerlink" title="1.4.  根据父节点查询"></a>1.4.  根据父节点查询</h2><p>新增商品时，先根据parentId&#x3D;0查询一级节点，选择一级分类后，需要根据父节点查询子节点。</p>
<p><img src="/assets/1567476312461.png" alt="1567476312461"></p>
<h1 id="2-商品信息"><a href="#2-商品信息" class="headerlink" title="2. 商品信息"></a>2. 商品信息</h1><h2 id="2-1-SPU和SKU设计"><a href="#2-1-SPU和SKU设计" class="headerlink" title="2.1.   SPU和SKU设计"></a>2.1.   SPU和SKU设计</h2><p>SPU：Standard Product Unit （标准产品单位） ，一组具有共同属性的商品集</p>
<p>SKU：Stock Keeping Unit（库存量单位），SPU商品集因具体特性不同而细分的每个商品</p>
<p>以图为例来看：</p>
<p><img src="/assets/1526085541996.png" alt="1526085541996"></p>
<ul>
<li>本页的 华为Mate10 就是一个商品集（SPU）</li>
<li>因为颜色、内存等不同，而细分出不同的Mate10，如亮黑色128G版。（SKU）</li>
</ul>
<p>可以看出：</p>
<ul>
<li>SPU是一个抽象的商品集概念，为了方便后台的管理。</li>
<li>SKU才是具体要销售的商品，每一个SKU的价格、库存可能会不一样，用户购买的是SKU而不是SPU</li>
</ul>
<p>表结构设计：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- spu表 --</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> `pms_spu` (</span><br><span class="line">  `id` <span class="type">bigint</span>(<span class="number">20</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> AUTO_INCREMENT COMMENT <span class="string">&#x27;商品id&#x27;</span>,</span><br><span class="line">  `name` <span class="type">varchar</span>(<span class="number">200</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;商品名称&#x27;</span>,</span><br><span class="line">  `category_id` <span class="type">bigint</span>(<span class="number">20</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;所属分类id&#x27;</span>,</span><br><span class="line">  `brand_id` <span class="type">bigint</span>(<span class="number">20</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;品牌id&#x27;</span>,</span><br><span class="line">  `publish_status` tinyint(<span class="number">4</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;上架状态[0 - 下架，1 - 上架]&#x27;</span>,</span><br><span class="line">  `create_time` datetime <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;创建时间&#x27;</span>,</span><br><span class="line">  `update_time` datetime <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;更新时间&#x27;</span>,</span><br><span class="line">  <span class="keyword">PRIMARY</span> KEY (`id`)</span><br><span class="line">) ENGINE<span class="operator">=</span>InnoDB <span class="keyword">DEFAULT</span> CHARSET<span class="operator">=</span>utf8 COMMENT<span class="operator">=</span><span class="string">&#x27;spu信息&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 商品描述表 --</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> `pms_spu_desc` (</span><br><span class="line">  `spu_id` <span class="type">bigint</span>(<span class="number">20</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;商品id&#x27;</span>,</span><br><span class="line">  `decript` longtext COMMENT <span class="string">&#x27;商品介绍&#x27;</span>,</span><br><span class="line">  <span class="keyword">PRIMARY</span> KEY (`spu_id`)</span><br><span class="line">) ENGINE<span class="operator">=</span>InnoDB <span class="keyword">DEFAULT</span> CHARSET<span class="operator">=</span>utf8 COMMENT<span class="operator">=</span><span class="string">&#x27;spu信息介绍&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- sku表 --</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> `pms_sku` (</span><br><span class="line">  `id` <span class="type">bigint</span>(<span class="number">20</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> AUTO_INCREMENT COMMENT <span class="string">&#x27;skuId&#x27;</span>,</span><br><span class="line">  `spu_id` <span class="type">bigint</span>(<span class="number">20</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;spuId&#x27;</span>,</span><br><span class="line">  `name` <span class="type">varchar</span>(<span class="number">255</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;sku名称&#x27;</span>,</span><br><span class="line">  `category_id` <span class="type">bigint</span>(<span class="number">20</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;所属分类id&#x27;</span>,</span><br><span class="line">  `brand_id` <span class="type">bigint</span>(<span class="number">20</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;品牌id&#x27;</span>,</span><br><span class="line">  `default_image` <span class="type">varchar</span>(<span class="number">255</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;默认图片&#x27;</span>,</span><br><span class="line">  `title` <span class="type">varchar</span>(<span class="number">255</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;标题&#x27;</span>,</span><br><span class="line">  `subtitle` <span class="type">varchar</span>(<span class="number">2000</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;副标题&#x27;</span>,</span><br><span class="line">  `price` <span class="type">decimal</span>(<span class="number">18</span>,<span class="number">4</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;价格&#x27;</span>,</span><br><span class="line">  `weight` <span class="type">int</span>(<span class="number">20</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;重量（克）&#x27;</span>,</span><br><span class="line">  <span class="keyword">PRIMARY</span> KEY (`id`)</span><br><span class="line">) ENGINE<span class="operator">=</span>InnoDB <span class="keyword">DEFAULT</span> CHARSET<span class="operator">=</span>utf8 COMMENT<span class="operator">=</span><span class="string">&#x27;sku信息&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- sku图片表 --</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> `pms_sku_images` (</span><br><span class="line">  `id` <span class="type">bigint</span>(<span class="number">20</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> AUTO_INCREMENT COMMENT <span class="string">&#x27;id&#x27;</span>,</span><br><span class="line">  `sku_id` <span class="type">bigint</span>(<span class="number">20</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;sku_id&#x27;</span>,</span><br><span class="line">  `url` <span class="type">varchar</span>(<span class="number">255</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;图片地址&#x27;</span>,</span><br><span class="line">  `sort` <span class="type">int</span>(<span class="number">11</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;排序&#x27;</span>,</span><br><span class="line">  `default_status` <span class="type">int</span>(<span class="number">11</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;默认图[0 - 不是默认图，1 - 是默认图]&#x27;</span>,</span><br><span class="line">  <span class="keyword">PRIMARY</span> KEY (`id`)</span><br><span class="line">) ENGINE<span class="operator">=</span>InnoDB <span class="keyword">DEFAULT</span> CHARSET<span class="operator">=</span>utf8 COMMENT<span class="operator">=</span><span class="string">&#x27;sku图片&#x27;</span>;</span><br></pre></td></tr></table></figure>



<h2 id="2-2-规格参数设计"><a href="#2-2-规格参数设计" class="headerlink" title="2.2.   规格参数设计"></a>2.2.   规格参数设计</h2><p><img src="/assets/1567485141477.png" alt="1567485141477"></p>
<p>商品规格参数有以下特点：</p>
<ul>
<li>规格参数都有<strong>分组</strong></li>
<li>同一类SPU（三级分类，如手机）的规格参数<strong>名</strong>是统一的。例如：iphone X，galaxy S10等。</li>
<li>同一spu，有些规格参数<strong>值</strong>是不变的，如：摄像头像素、摄像头数量等；而有些规格参数的<strong>值</strong>，会随着你选择的sku发生变化，如：内存、机身颜色、存储等。</li>
<li>有些规格参数需要作为sku选项（销售属性），例如：机身颜色、存储、版本等</li>
<li>有些规格参数需要参与检索（检索属性），例如：屏幕尺寸、分辨率、操作系统等</li>
<li>有些规格参数需要快速展示在商品介绍的上方</li>
</ul>
<p>综上，表设计如下：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 规格参数分组（属性分组）</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> `pms_attr_group` (</span><br><span class="line">  `id` <span class="type">bigint</span>(<span class="number">20</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> AUTO_INCREMENT COMMENT <span class="string">&#x27;分组id&#x27;</span>,</span><br><span class="line">  `name` <span class="type">char</span>(<span class="number">20</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;组名&#x27;</span>,</span><br><span class="line">  `sort` <span class="type">int</span>(<span class="number">11</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;排序&#x27;</span>,</span><br><span class="line">  `icon` <span class="type">varchar</span>(<span class="number">255</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;组图标&#x27;</span>,</span><br><span class="line">  `category_id` <span class="type">bigint</span>(<span class="number">20</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;所属分类id&#x27;</span>,</span><br><span class="line">  `remark` <span class="type">varchar</span>(<span class="number">255</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;备注&#x27;</span>,</span><br><span class="line">  <span class="keyword">PRIMARY</span> KEY (`id`)</span><br><span class="line">) ENGINE<span class="operator">=</span>InnoDB <span class="keyword">DEFAULT</span> CHARSET<span class="operator">=</span>utf8 COMMENT<span class="operator">=</span><span class="string">&#x27;属性分组&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 规格参数表</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> `pms_attr` (</span><br><span class="line">  `id` <span class="type">bigint</span>(<span class="number">20</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> AUTO_INCREMENT COMMENT <span class="string">&#x27;属性id&#x27;</span>,</span><br><span class="line">  `name` <span class="type">char</span>(<span class="number">30</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;属性名&#x27;</span>,</span><br><span class="line">  `search_type` tinyint(<span class="number">4</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;是否需要检索[0-不需要，1-需要]&#x27;</span>,</span><br><span class="line">  `icon` <span class="type">varchar</span>(<span class="number">255</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;属性图标&#x27;</span>,</span><br><span class="line">  `value_select` <span class="type">char</span>(<span class="number">255</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;可选值列表[用逗号分隔]&#x27;</span>,</span><br><span class="line">  `type` tinyint(<span class="number">4</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;属性类型[0-销售属性，1-基本属性，2-既是销售属性又是基本属性]&#x27;</span>,</span><br><span class="line">  `enable` <span class="type">bigint</span>(<span class="number">20</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;启用状态[0 - 禁用，1 - 启用]&#x27;</span>,</span><br><span class="line">  `show_desc` tinyint(<span class="number">4</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;快速展示【是否展示在介绍上；0-否 1-是】，在sku中仍然可以调整&#x27;</span>,</span><br><span class="line">  `category_id` <span class="type">bigint</span>(<span class="number">20</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;所属分类&#x27;</span>,</span><br><span class="line">  `group_id` <span class="type">bigint</span>(<span class="number">20</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;规格分组id&#x27;</span>,</span><br><span class="line">  <span class="keyword">PRIMARY</span> KEY (`id`)</span><br><span class="line">) ENGINE<span class="operator">=</span>InnoDB <span class="keyword">DEFAULT</span> CHARSET<span class="operator">=</span>utf8 COMMENT<span class="operator">=</span><span class="string">&#x27;商品属性&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 通用规格参数值表</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> `pms_spu_attr_value` (</span><br><span class="line">  `id` <span class="type">bigint</span>(<span class="number">20</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> AUTO_INCREMENT COMMENT <span class="string">&#x27;id&#x27;</span>,</span><br><span class="line">  `spu_id` <span class="type">bigint</span>(<span class="number">20</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;商品id&#x27;</span>,</span><br><span class="line">  `attr_id` <span class="type">bigint</span>(<span class="number">20</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;属性id&#x27;</span>,</span><br><span class="line">  `attr_name` <span class="type">varchar</span>(<span class="number">200</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;属性名&#x27;</span>,</span><br><span class="line">  `attr_value` <span class="type">varchar</span>(<span class="number">200</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;属性值&#x27;</span>,</span><br><span class="line">  `sort` <span class="type">int</span>(<span class="number">11</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;顺序&#x27;</span>,</span><br><span class="line">  <span class="keyword">PRIMARY</span> KEY (`id`)</span><br><span class="line">) ENGINE<span class="operator">=</span>InnoDB <span class="keyword">DEFAULT</span> CHARSET<span class="operator">=</span>utf8 COMMENT<span class="operator">=</span><span class="string">&#x27;spu属性值&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 销售规格参数值表</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> `pms_sku_attr_value` (</span><br><span class="line">  `id` <span class="type">bigint</span>(<span class="number">20</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> AUTO_INCREMENT COMMENT <span class="string">&#x27;id&#x27;</span>,</span><br><span class="line">  `sku_id` <span class="type">bigint</span>(<span class="number">20</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;sku_id&#x27;</span>,</span><br><span class="line">  `attr_id` <span class="type">bigint</span>(<span class="number">20</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;attr_id&#x27;</span>,</span><br><span class="line">  `attr_name` <span class="type">varchar</span>(<span class="number">200</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;销售属性名&#x27;</span>,</span><br><span class="line">  `attr_value` <span class="type">varchar</span>(<span class="number">200</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;销售属性值&#x27;</span>,</span><br><span class="line">  `sort` <span class="type">int</span>(<span class="number">11</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;顺序&#x27;</span>,</span><br><span class="line">  <span class="keyword">PRIMARY</span> KEY (`id`)</span><br><span class="line">) ENGINE<span class="operator">=</span>InnoDB <span class="keyword">DEFAULT</span> CHARSET<span class="operator">=</span>utf8 COMMENT<span class="operator">=</span><span class="string">&#x27;sku销售属性&amp;值&#x27;</span>;</span><br></pre></td></tr></table></figure>



<h2 id="2-3-规格属性查询"><a href="#2-3-规格属性查询" class="headerlink" title="2.3.   规格属性查询"></a>2.3.   规格属性查询</h2><p><img src="/assets/1584621122426.png" alt="1584621122426"></p>
<h3 id="2-3-1-查询规格分组"><a href="#2-3-1-查询规格分组" class="headerlink" title="2.3.1.   查询规格分组"></a>2.3.1.   查询规格分组</h3><p>查看控制台，对应的发送了3个请求：</p>
<p><img src="/assets/1584621550824.png" alt="1584621550824"></p>
<p>其中有一个是查询分组。结合接口文档：</p>
<p>请求地址：category&#x2F;{cid}，Controller上已经标记了&#x2F;pms&#x2F;attrgroup</p>
<p>请求方式：GET</p>
<p>请求参数：一些基本分页条件已经封装到PageParamVo，然后有一个占位符参数（商品分类：225）</p>
<p>正确响应：<code>ResponseVo&lt;PageResultVO&gt;</code></p>
<p>AttrGroupController中添加Controller方法：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ApiOperation(&quot;根据三级分类id查询&quot;)</span></span><br><span class="line"><span class="meta">@GetMapping(&quot;category/&#123;cid&#125;&quot;)</span></span><br><span class="line"><span class="keyword">public</span> ResponseVo&lt;List&lt;AttrGroupEntity&gt;&gt; <span class="title function_">queryByCidPage</span><span class="params">(<span class="meta">@PathVariable(&quot;cid&quot;)</span>Long cid)</span>&#123;</span><br><span class="line"></span><br><span class="line">    List&lt;AttrGroupEntity&gt; groupEntities = <span class="built_in">this</span>.attrGroupService.list(<span class="keyword">new</span> <span class="title class_">QueryWrapper</span>&lt;AttrGroupEntity&gt;().eq(<span class="string">&quot;category_id&quot;</span>, cid));</span><br><span class="line">    <span class="keyword">return</span> ResponseVo.ok(groupEntities);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>测试效果：</p>
<p><img src="/assets/1584621584538.png" alt="1584621584538"></p>
<h3 id="2-3-2-查询分组下的规格参数"><a href="#2-3-2-查询分组下的规格参数" class="headerlink" title="2.3.2.   查询分组下的规格参数"></a>2.3.2.   查询分组下的规格参数</h3><p>点击属性分组下的维护关联关系，可以查看该分组下的所有属性，并可以添加、删除关联关系。</p>
<p><img src="/assets/1584669844142.png" alt="1584669844142"></p>
<p>参考接口文档：</p>
<p>请求地址：group&#x2F;{gid}，已经在AttrController上配置&#x2F;pms&#x2F;attr</p>
<p>请求方式：GET</p>
<p>请求参数：gid</p>
<p>正确响应：Response&lt;List<AttrEntity>&gt;</p>
<p>AttrController添加方法：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@GetMapping(&quot;group/&#123;gid&#125;&quot;)</span></span><br><span class="line"><span class="meta">@ApiOperation(&quot;分页查询&quot;)</span></span><br><span class="line"><span class="keyword">public</span> ResponseVo&lt;List&lt;AttrEntity&gt;&gt; <span class="title function_">queryAttrsByGid</span><span class="params">(<span class="meta">@PathVariable(&quot;gid&quot;)</span>Long gid)</span>&#123;</span><br><span class="line">    List&lt;AttrEntity&gt; attrEntities = <span class="built_in">this</span>.attrService.list(<span class="keyword">new</span> <span class="title class_">QueryWrapper</span>&lt;AttrEntity&gt;().eq(<span class="string">&quot;group_id&quot;</span>, gid));</span><br><span class="line">    <span class="keyword">return</span> ResponseVo.ok(attrEntities);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>测试：</p>
<p><img src="/assets/1584670473377.png" alt="1584670473377"></p>
<h2 id="2-4-商品查询"><a href="#2-4-商品查询" class="headerlink" title="2.4.   商品查询"></a>2.4.   商品查询</h2><h3 id="2-4-1-查询商品列表"><a href="#2-4-1-查询商品列表" class="headerlink" title="2.4.1.   查询商品列表"></a>2.4.1.   查询商品列表</h3><p><img src="/assets/1567513319657.png" alt="1567513319657"></p>
<p>查看控制台：</p>
<p><img src="/assets/1584674738425.png" alt="1584674738425"></p>
<p>结合接口文档</p>
<p>请求地址：category&#x2F;{categoryId}，SpuInfoController类上的路径是&#x2F;pms&#x2F;spuinfo</p>
<p>请求方式：GET</p>
<p>请求参数：PageParamVo+ categoryId</p>
<p>正确响应：ResponseVo<PageResultVo></p>
<p>SpuInfoController添加方法：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ApiOperation(&quot;spu商品信息查询&quot;)</span></span><br><span class="line"><span class="meta">@GetMapping(&quot;category/&#123;categoryId&#125;&quot;)</span></span><br><span class="line"><span class="keyword">public</span> ResponseVo&lt;PageResultVo&gt; <span class="title function_">querySpuInfo</span><span class="params">(PageParamVo pageParamVo, <span class="meta">@PathVariable(&quot;categoryId&quot;)</span>Long categoryId)</span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="type">PageResultVo</span> <span class="variable">pageResultVo</span> <span class="operator">=</span> <span class="built_in">this</span>.spuService.querySpuInfo(pageParamVo, categoryId);</span><br><span class="line">    <span class="keyword">return</span> ResponseVo.ok(pageResultVo);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>SpuInfoService接口方法：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">PageResultVo querySpuInfo(PageParamVo pageParamVo, Long categoryId);</span><br></pre></td></tr></table></figure>



<p>SpuInfoServiceImpl实现类实现该方法：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> PageResultVo <span class="title function_">querySpuInfo</span><span class="params">(PageParamVo pageParamVo, Long categoryId)</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 封装查询条件</span></span><br><span class="line">    QueryWrapper&lt;SpuEntity&gt; wrapper = <span class="keyword">new</span> <span class="title class_">QueryWrapper</span>&lt;&gt;();</span><br><span class="line">    <span class="comment">// 如果分类id不为0，要根据分类id查，否则查全部</span></span><br><span class="line">    <span class="keyword">if</span> (categoryId != <span class="number">0</span>)&#123;</span><br><span class="line">        wrapper.eq(<span class="string">&quot;category_id&quot;</span>, categoryId);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 如果用户输入了检索条件，根据检索条件查</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">key</span> <span class="operator">=</span> pageParamVo.getKey();</span><br><span class="line">    <span class="keyword">if</span> (StringUtils.isNotBlank(key))&#123;</span><br><span class="line">        wrapper.and(t -&gt; t.like(<span class="string">&quot;name&quot;</span>, key).or().like(<span class="string">&quot;id&quot;</span>, key));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">PageResultVo</span>(<span class="built_in">this</span>.page(pageParamVo.getPage(), wrapper));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>测试：</p>
<p><img src="/assets/1567520074569.png" alt="1567520074569"></p>
<h3 id="2-4-2-查询SPU下的SKU"><a href="#2-4-2-查询SPU下的SKU" class="headerlink" title="2.4.2.   查询SPU下的SKU"></a>2.4.2.   查询SPU下的SKU</h3><p>找到<code>库存管理</code>下的<code>商品库存</code></p>
<p><img src="/assets/1567521129311.png" alt="1567521129311"></p>
<p>点击一个商品的<code>库存维护</code>：</p>
<p><img src="/assets/1584771702197.png" alt="1584771702197"></p>
<p>结合接口文档：</p>
<p>请求地址：spu&#x2F;{spuId}</p>
<p>请求方式：GET</p>
<p>请求参数：spuId</p>
<p>正确响应：<code>Resp&lt;List&lt;SkuEntity&gt;&gt;</code></p>
<p>给SkuInfoController添加方法：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 根据spuId查询sku列表</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line"><span class="meta">@GetMapping(&quot;spu/&#123;spuId&#125;&quot;)</span></span><br><span class="line"><span class="meta">@ApiOperation(&quot;根据spuId查询sku列表&quot;)</span></span><br><span class="line"><span class="keyword">public</span> ResponseVo&lt;List&lt;SkuEntity&gt;&gt; <span class="title function_">list</span><span class="params">(<span class="meta">@PathVariable(&quot;spuId&quot;)</span>Long spuId)</span>&#123;</span><br><span class="line">    List&lt;SkuEntity&gt; skuEntities = skuService.list(<span class="keyword">new</span> <span class="title class_">QueryWrapper</span>&lt;SkuEntity&gt;().eq(<span class="string">&quot;spu_id&quot;</span>, spuId));</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> ResponseVo.ok(skuEntities);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>测试：</p>
<p><img src="/assets/1567521804729.png" alt="1567521804729"></p>
<h3 id="2-4-3-查询SKU的库存信息"><a href="#2-4-3-查询SKU的库存信息" class="headerlink" title="2.4.3.   查询SKU的库存信息"></a>2.4.3.   查询SKU的库存信息</h3><p>sku列表中的<code>库存维护</code></p>
<p><img src="/assets/1567523065617.png" alt="1567523065617"></p>
<p><img src="/assets/1584775206306.png" alt="1584775206306"></p>
<p>参照接口文档：</p>
<p>请求地址：&#x2F;sku&#x2F;{skuId} 在gmall-wms系统的WareSkuController中已经配置了&#x2F;wms&#x2F;waresku&#x2F;</p>
<p>请求方式：GET</p>
<p>请求参数：skuId</p>
<p>正确响应：<code>ResponseVo&lt;List&lt;WareSkuEntity&gt;&gt;</code></p>
<p>WareSkuController添加方法：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ApiOperation(&quot;根据skuId查询库存信息&quot;)</span></span><br><span class="line"><span class="meta">@GetMapping(&quot;sku/&#123;skuId&#125;&quot;)</span></span><br><span class="line"><span class="keyword">public</span> ResponseVo&lt;List&lt;WareSkuEntity&gt;&gt; <span class="title function_">queryWareSkuBySkuId</span><span class="params">(<span class="meta">@PathVariable(&quot;skuId&quot;)</span>Long skuId)</span>&#123;</span><br><span class="line"></span><br><span class="line">    List&lt;WareSkuEntity&gt; wareSkuEntities = <span class="built_in">this</span>.wareSkuService.list(<span class="keyword">new</span> <span class="title class_">QueryWrapper</span>&lt;WareSkuEntity&gt;().eq(<span class="string">&quot;sku_id&quot;</span>, skuId));</span><br><span class="line">    <span class="keyword">return</span> ResponseVo.ok(wareSkuEntities);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>测试：</p>
<p><img src="/assets/1584779661541.png" alt="1584779661541"></p>
<h2 id="2-5-商品新增"><a href="#2-5-商品新增" class="headerlink" title="2.5.   商品新增"></a>2.5.   商品新增</h2><p><img src="/assets/1567560984539.png" alt="1567560984539"></p>
<p>点击<code>添加spu</code>按钮，跳转到新增spu页面</p>
<p><img src="/assets/1567561565352.png" alt="1567561565352"></p>
<p>填写完表单，点击<code>下一步</code></p>
<p><img src="/assets/1584697495113.png" alt="1584697495113"></p>
<p>进入<code>录入spu属性信息</code>，但是没有显示spu属性（即规格参数）。</p>
<h3 id="2-5-1-查询分类下的分组及其规格参数"><a href="#2-5-1-查询分类下的分组及其规格参数" class="headerlink" title="2.5.1.    查询分类下的分组及其规格参数"></a>2.5.1.    查询分类下的分组及其规格参数</h3><p>当添加商品时，应该根据用户选择的商品分类，显示不同规格参数名，让用户填写对应的参数值。上图控制台发送的这个请求，就是根据分类id查询分组及组下的属性，并动态生成一个表单，让用户填写参数值</p>
<p>参照接口文档：</p>
<p>请求地址：&#x2F;withattrs&#x2F;{catId}</p>
<p>请求方式：GET</p>
<p>请求参数：catId</p>
<p>正确响应：<code>ResponseVo&lt;List&lt;?&gt;&gt;</code></p>
<p>这里的响应数据比AttrGroupEntity多出来一个字段，就是组下的属性列表attrEntities。所以要给AttrGroupEntity扩展一个字段，有两种扩展方式：</p>
<ol>
<li>直接在AttrGroupEntity中添加一个字段attrEntities</li>
<li>编写一个扩展类GroupVo继承AttrGroupEntity，然后扩展一个attrEntities</li>
</ol>
<p>推荐使用第二种方式，因为AttrGroupEntity作为一个基础实体类和数据库操作密切相关，很多人都会用到。</p>
<p>GroupVo实体类：</p>
<p><img src="/assets/1584698223491.png" alt="1584698223491"></p>
<p>AttrGroupController添加方法：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ApiOperation(&quot;根据三级分类id查询分组及组下的规格参数&quot;)</span></span><br><span class="line"><span class="meta">@GetMapping(&quot;/withattrs/&#123;catId&#125;&quot;)</span></span><br><span class="line"><span class="keyword">public</span> ResponseVo&lt;List&lt;GroupVo&gt;&gt; <span class="title function_">queryByCid</span><span class="params">(<span class="meta">@PathVariable(&quot;catId&quot;)</span>Long cid)</span>&#123;</span><br><span class="line"></span><br><span class="line">    List&lt;GroupVo&gt; groupVos = <span class="built_in">this</span>.attrGroupService.queryByCid(cid);</span><br><span class="line">    <span class="keyword">return</span> ResponseVo.ok(groupVos);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>AttrGroupService的接口方法：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">List&lt;GroupVo&gt; <span class="title function_">queryByCid</span><span class="params">(Long cid)</span>;</span><br></pre></td></tr></table></figure>



<p>AttrGroupServiceImpl实现类实现接口方法：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> List&lt;GroupVo&gt; <span class="title function_">queryByCid</span><span class="params">(Long cid)</span> &#123;</span><br><span class="line">    <span class="comment">// 查询所有的分组</span></span><br><span class="line">    List&lt;AttrGroupEntity&gt; attrGroupEntities = <span class="built_in">this</span>.list(<span class="keyword">new</span> <span class="title class_">QueryWrapper</span>&lt;AttrGroupEntity&gt;().eq(<span class="string">&quot;category_id&quot;</span>, cid));</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 查询出每组下的规格参数</span></span><br><span class="line">    <span class="keyword">return</span> attrGroupEntities.stream().map(attrGroupEntity -&gt; &#123;</span><br><span class="line">        <span class="type">GroupVo</span> <span class="variable">groupVo</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">GroupVo</span>();</span><br><span class="line">        BeanUtils.copyProperties(attrGroupEntity, groupVo);</span><br><span class="line">        <span class="comment">// 查询规格参数，只需查询出每个分组下的通用属性就可以了（不需要销售属性）</span></span><br><span class="line">        List&lt;AttrEntity&gt; attrEntities = <span class="built_in">this</span>.attrMapper.selectList(<span class="keyword">new</span> <span class="title class_">QueryWrapper</span>&lt;AttrEntity&gt;().eq(<span class="string">&quot;group_id&quot;</span>, attrGroupEntity.getId()).eq(<span class="string">&quot;type&quot;</span>, <span class="number">1</span>));</span><br><span class="line">        groupVo.setAttrEntities(attrEntities);</span><br><span class="line">        <span class="keyword">return</span> groupVo;</span><br><span class="line">    &#125;).collect(Collectors.toList());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>测试：</p>
<p><img src="/assets/1584714398957.png" alt="1584714398957"></p>
<h3 id="2-5-2-查询分类下的销售属性"><a href="#2-5-2-查询分类下的销售属性" class="headerlink" title="2.5.2. 查询分类下的销售属性"></a>2.5.2. 查询分类下的销售属性</h3><p>点击“下一步”进入第三步，页面没有数据。查看控制台发送了查询请求：</p>
<p><img src="/assets/1584714509858.png" alt="1584714509858"></p>
<p>参照接口文档：</p>
<p>请求地址：category&#x2F;{cid}?type&#x3D;0&amp;searchType&#x3D;1</p>
<p>请求方式：GET</p>
<p>请求参数：cid, type, searchType</p>
<p>正确响应：<code>ResponseVo&lt;List&lt;AttrEntity&gt;&gt;</code></p>
<p>AttrController:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@GetMapping(&quot;category/&#123;cid&#125;&quot;)</span></span><br><span class="line"><span class="meta">@ApiOperation(&quot;分类查询&quot;)</span></span><br><span class="line"><span class="keyword">public</span> ResponseVo&lt;List&lt;AttrEntity&gt;&gt; <span class="title function_">queryAttrsByCid</span><span class="params">(<span class="meta">@PathVariable(&quot;cid&quot;)</span>Long cid,</span></span><br><span class="line"><span class="params">                                                    <span class="meta">@RequestParam(value = &quot;type&quot;, required = false)</span>Integer type,</span></span><br><span class="line"><span class="params">                                                    <span class="meta">@RequestParam(value = &quot;searchType&quot;, required = false)</span> Integer searchType)</span>&#123;</span><br><span class="line">    List&lt;AttrEntity&gt; attrEntities = <span class="built_in">this</span>.attrService.queryAttrsByCid(cid, type, searchType);</span><br><span class="line">    <span class="keyword">return</span> ResponseVo.ok(attrEntities);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>AttrService:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">List&lt;AttrEntity&gt; <span class="title function_">queryAttrsByCid</span><span class="params">(Long cid, Integer type, Integer searchType)</span>;</span><br></pre></td></tr></table></figure>



<p>AttrServiceImpl:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> List&lt;AttrEntity&gt; <span class="title function_">queryAttrsByCid</span><span class="params">(Long cid, Integer type, Integer searchType)</span> &#123;</span><br><span class="line">    QueryWrapper&lt;AttrEntity&gt; queryWrapper = <span class="keyword">new</span> <span class="title class_">QueryWrapper</span>&lt;&gt;();</span><br><span class="line">    <span class="comment">// 分类id如果为0，查询所有分类的规格参数</span></span><br><span class="line">    <span class="keyword">if</span> (cid != <span class="number">0</span>) &#123;</span><br><span class="line">        queryWrapper.eq(<span class="string">&quot;category_id&quot;</span>, cid);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 如果参数类型不为空</span></span><br><span class="line">    <span class="keyword">if</span> (type != <span class="literal">null</span>) &#123;</span><br><span class="line">        queryWrapper.eq(<span class="string">&quot;type&quot;</span>, type);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 如果参数类型不为空</span></span><br><span class="line">    <span class="keyword">if</span> (searchType != <span class="literal">null</span>) &#123;</span><br><span class="line">        queryWrapper.eq(<span class="string">&quot;search_type&quot;</span>, searchType);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">this</span>.list(queryWrapper);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="2-5-3-为页面提交的数据构建数据模型"><a href="#2-5-3-为页面提交的数据构建数据模型" class="headerlink" title="2.5.3. 为页面提交的数据构建数据模型"></a>2.5.3. 为页面提交的数据构建数据模型</h3><p><img src="/assets/1584718209086.png" alt="1584718209086"></p>
<p>每个sku都可以再次展开，sku基本信息，优惠信息，以及图片上传</p>
<p><img src="/assets/1567576282861.png" alt="1567576282861"></p>
<p>最后点击确定，显示保存成功！？查看数据库你会发现它只保存了spu的基本信息。</p>
<p>查看控制台，可以看到：</p>
<p><img src="/assets/1584718286014.png" alt="1584718286014"></p>
<p>提交的数据非常复杂，如下：</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">	<span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;华为mate30pro&quot;</span><span class="punctuation">,</span></span><br><span class="line">	<span class="attr">&quot;brandId&quot;</span><span class="punctuation">:</span> <span class="number">2</span><span class="punctuation">,</span></span><br><span class="line">	<span class="attr">&quot;categoryId&quot;</span><span class="punctuation">:</span> <span class="number">225</span><span class="punctuation">,</span></span><br><span class="line">	<span class="attr">&quot;publishStatus&quot;</span><span class="punctuation">:</span> <span class="number">1</span><span class="punctuation">,</span></span><br><span class="line">	<span class="attr">&quot;spuImages&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="string">&quot;https://ggmall.oss-cn-shanghai.aliyuncs.com/2020-03-20/2e3c0156-a8a5-4ae2-8e5d-e3061069fa95_eda8c4c43653595f (1).jpg&quot;</span><span class="punctuation">,</span> <span class="string">&quot;https://ggmall.oss-cn-shanghai.aliyuncs.com/2020-03-20/41af1ab5-6625-4ef3-8991-ddece4933fe8_eda8c4c43653595f (1).jpg&quot;</span><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">	<span class="attr">&quot;baseAttrs&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="punctuation">&#123;</span></span><br><span class="line">		<span class="attr">&quot;id&quot;</span><span class="punctuation">:</span> <span class="number">1</span><span class="punctuation">,</span></span><br><span class="line">		<span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;上市年份&quot;</span><span class="punctuation">,</span></span><br><span class="line">		<span class="attr">&quot;valueSelected&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="string">&quot;2019&quot;</span><span class="punctuation">]</span></span><br><span class="line">	<span class="punctuation">&#125;</span><span class="punctuation">,</span> <span class="punctuation">&#123;</span></span><br><span class="line">		<span class="attr">&quot;id&quot;</span><span class="punctuation">:</span> <span class="number">2</span><span class="punctuation">,</span></span><br><span class="line">		<span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;产品名称&quot;</span><span class="punctuation">,</span></span><br><span class="line">		<span class="attr">&quot;valueSelected&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="string">&quot;HUAWEI Mate 30&quot;</span><span class="punctuation">]</span></span><br><span class="line">	<span class="punctuation">&#125;</span><span class="punctuation">,</span> <span class="punctuation">&#123;</span></span><br><span class="line">		<span class="attr">&quot;id&quot;</span><span class="punctuation">:</span> <span class="number">6</span><span class="punctuation">,</span></span><br><span class="line">		<span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;CPU品牌&quot;</span><span class="punctuation">,</span></span><br><span class="line">		<span class="attr">&quot;valueSelected&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="string">&quot;麒麟&quot;</span><span class="punctuation">]</span></span><br><span class="line">	<span class="punctuation">&#125;</span><span class="punctuation">,</span> <span class="punctuation">&#123;</span></span><br><span class="line">		<span class="attr">&quot;id&quot;</span><span class="punctuation">:</span> <span class="number">7</span><span class="punctuation">,</span></span><br><span class="line">		<span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;CPU型号&quot;</span><span class="punctuation">,</span></span><br><span class="line">		<span class="attr">&quot;valueSelected&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="string">&quot;麒麟990 5G&quot;</span><span class="punctuation">]</span></span><br><span class="line">	<span class="punctuation">&#125;</span><span class="punctuation">,</span> <span class="punctuation">&#123;</span></span><br><span class="line">		<span class="attr">&quot;id&quot;</span><span class="punctuation">:</span> <span class="number">8</span><span class="punctuation">,</span></span><br><span class="line">		<span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;分辨率&quot;</span><span class="punctuation">,</span></span><br><span class="line">		<span class="attr">&quot;valueSelected&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="string">&quot;FHD+ 2340×1080 像素&quot;</span><span class="punctuation">]</span></span><br><span class="line">	<span class="punctuation">&#125;</span><span class="punctuation">,</span> <span class="punctuation">&#123;</span></span><br><span class="line">		<span class="attr">&quot;id&quot;</span><span class="punctuation">:</span> <span class="number">9</span><span class="punctuation">,</span></span><br><span class="line">		<span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;屏幕尺寸&quot;</span><span class="punctuation">,</span></span><br><span class="line">		<span class="attr">&quot;valueSelected&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="string">&quot;7&quot;</span><span class="punctuation">]</span></span><br><span class="line">	<span class="punctuation">&#125;</span><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">	<span class="attr">&quot;skus&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="punctuation">&#123;</span></span><br><span class="line">		<span class="attr">&quot;attr_3&quot;</span><span class="punctuation">:</span> <span class="string">&quot;黑色&quot;</span><span class="punctuation">,</span></span><br><span class="line">		<span class="attr">&quot;price&quot;</span><span class="punctuation">:</span> <span class="string">&quot;5000&quot;</span><span class="punctuation">,</span></span><br><span class="line">		<span class="attr">&quot;stock&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">		<span class="attr">&quot;growBounds&quot;</span><span class="punctuation">:</span> <span class="string">&quot;2000&quot;</span><span class="punctuation">,</span></span><br><span class="line">		<span class="attr">&quot;buyBounds&quot;</span><span class="punctuation">:</span> <span class="string">&quot;1000&quot;</span><span class="punctuation">,</span></span><br><span class="line">		<span class="attr">&quot;work&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="number">1</span><span class="punctuation">,</span> <span class="number">0</span><span class="punctuation">,</span> <span class="number">1</span><span class="punctuation">,</span> <span class="number">0</span><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">		<span class="attr">&quot;fullCount&quot;</span><span class="punctuation">:</span> <span class="string">&quot;2&quot;</span><span class="punctuation">,</span></span><br><span class="line">		<span class="attr">&quot;discount&quot;</span><span class="punctuation">:</span> <span class="string">&quot;90&quot;</span><span class="punctuation">,</span></span><br><span class="line">		<span class="attr">&quot;fullPrice&quot;</span><span class="punctuation">:</span> <span class="string">&quot;5000&quot;</span><span class="punctuation">,</span></span><br><span class="line">		<span class="attr">&quot;reducePrice&quot;</span><span class="punctuation">:</span> <span class="string">&quot;500&quot;</span><span class="punctuation">,</span></span><br><span class="line">		<span class="attr">&quot;fullAddOther&quot;</span><span class="punctuation">:</span> <span class="number">1</span><span class="punctuation">,</span></span><br><span class="line">		<span class="attr">&quot;images&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="string">&quot;https://ggmall.oss-cn-shanghai.aliyuncs.com/2020-03-20/d877660d-93a3-4d9a-8c8d-ce5f5e5e1904_eda8c4c43653595f (1).jpg&quot;</span><span class="punctuation">,</span> <span class="string">&quot;https://ggmall.oss-cn-shanghai.aliyuncs.com/2020-03-20/01f785b4-b984-4246-8724-5a1d2c423fd0_e9ad9735fc3f0686.jpg&quot;</span><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">		<span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;华为mate30pro 黑色,8G,256G&quot;</span><span class="punctuation">,</span></span><br><span class="line">		<span class="attr">&quot;title&quot;</span><span class="punctuation">:</span> <span class="string">&quot;华为 HUAWEI Mate 30 5G 麒麟990 4000万超感光徕卡影像双超级快充8GB+256GB亮黑色5G全网通游戏手机&quot;</span><span class="punctuation">,</span></span><br><span class="line">		<span class="attr">&quot;subTitle&quot;</span><span class="punctuation">:</span> <span class="string">&quot;华为mate30pro 黑色,8G,256G&quot;</span><span class="punctuation">,</span></span><br><span class="line">		<span class="attr">&quot;weight&quot;</span><span class="punctuation">:</span> <span class="string">&quot;500&quot;</span><span class="punctuation">,</span></span><br><span class="line">		<span class="attr">&quot;attr_4&quot;</span><span class="punctuation">:</span> <span class="string">&quot;8G&quot;</span><span class="punctuation">,</span></span><br><span class="line">		<span class="attr">&quot;attr_5&quot;</span><span class="punctuation">:</span> <span class="string">&quot;256G&quot;</span><span class="punctuation">,</span></span><br><span class="line">		<span class="attr">&quot;ladderAddOther&quot;</span><span class="punctuation">:</span> <span class="number">1</span><span class="punctuation">,</span></span><br><span class="line">		<span class="attr">&quot;subtitle&quot;</span><span class="punctuation">:</span> <span class="string">&quot;【直降500元！到手价4999元！享12期免息！低至13.7元/天】双4000万徕卡电影四摄；Mate30直降500元享12期》&quot;</span><span class="punctuation">,</span></span><br><span class="line">		<span class="attr">&quot;saleAttrs&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="punctuation">&#123;</span></span><br><span class="line">			<span class="attr">&quot;attrId&quot;</span><span class="punctuation">:</span> <span class="string">&quot;3&quot;</span><span class="punctuation">,</span></span><br><span class="line">			<span class="attr">&quot;attrValue&quot;</span><span class="punctuation">:</span> <span class="string">&quot;黑色&quot;</span></span><br><span class="line">		<span class="punctuation">&#125;</span><span class="punctuation">,</span> <span class="punctuation">&#123;</span></span><br><span class="line">			<span class="attr">&quot;attrId&quot;</span><span class="punctuation">:</span> <span class="string">&quot;4&quot;</span><span class="punctuation">,</span></span><br><span class="line">			<span class="attr">&quot;attrValue&quot;</span><span class="punctuation">:</span> <span class="string">&quot;8G&quot;</span></span><br><span class="line">		<span class="punctuation">&#125;</span><span class="punctuation">,</span> <span class="punctuation">&#123;</span></span><br><span class="line">			<span class="attr">&quot;attrId&quot;</span><span class="punctuation">:</span> <span class="string">&quot;5&quot;</span><span class="punctuation">,</span></span><br><span class="line">			<span class="attr">&quot;attrValue&quot;</span><span class="punctuation">:</span> <span class="string">&quot;256G&quot;</span></span><br><span class="line">		<span class="punctuation">&#125;</span><span class="punctuation">]</span></span><br><span class="line">	<span class="punctuation">&#125;</span><span class="punctuation">,</span> <span class="punctuation">&#123;</span></span><br><span class="line">		<span class="attr">&quot;attr_3&quot;</span><span class="punctuation">:</span> <span class="string">&quot;黑色&quot;</span><span class="punctuation">,</span></span><br><span class="line">		<span class="attr">&quot;price&quot;</span><span class="punctuation">:</span> <span class="string">&quot;6000&quot;</span><span class="punctuation">,</span></span><br><span class="line">		<span class="attr">&quot;stock&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">		<span class="attr">&quot;growBounds&quot;</span><span class="punctuation">:</span> <span class="string">&quot;1000&quot;</span><span class="punctuation">,</span></span><br><span class="line">		<span class="attr">&quot;buyBounds&quot;</span><span class="punctuation">:</span> <span class="string">&quot;1000&quot;</span><span class="punctuation">,</span></span><br><span class="line">		<span class="attr">&quot;work&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="number">1</span><span class="punctuation">,</span> <span class="number">0</span><span class="punctuation">,</span> <span class="number">1</span><span class="punctuation">,</span> <span class="number">0</span><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">		<span class="attr">&quot;fullCount&quot;</span><span class="punctuation">:</span> <span class="string">&quot;3&quot;</span><span class="punctuation">,</span></span><br><span class="line">		<span class="attr">&quot;discount&quot;</span><span class="punctuation">:</span> <span class="string">&quot;80&quot;</span><span class="punctuation">,</span></span><br><span class="line">		<span class="attr">&quot;fullPrice&quot;</span><span class="punctuation">:</span> <span class="string">&quot;6000&quot;</span><span class="punctuation">,</span></span><br><span class="line">		<span class="attr">&quot;reducePrice&quot;</span><span class="punctuation">:</span> <span class="string">&quot;2000&quot;</span><span class="punctuation">,</span></span><br><span class="line">		<span class="attr">&quot;fullAddOther&quot;</span><span class="punctuation">:</span> <span class="number">1</span><span class="punctuation">,</span></span><br><span class="line">		<span class="attr">&quot;images&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="string">&quot;https://ggmall.oss-cn-shanghai.aliyuncs.com/2020-03-20/7cf5c7d2-f9a2-4767-8e90-d41b67a5ffd2_e9ad9735fc3f0686.jpg&quot;</span><span class="punctuation">,</span> <span class="string">&quot;https://ggmall.oss-cn-shanghai.aliyuncs.com/2020-03-20/8e7189ce-5043-4d4c-8a8b-e3728360e451_802254cca298ae79 (1).jpg&quot;</span><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">		<span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;华为mate30pro 黑色,8G,512G&quot;</span><span class="punctuation">,</span></span><br><span class="line">		<span class="attr">&quot;title&quot;</span><span class="punctuation">:</span> <span class="string">&quot;华为 HUAWEI Mate 30 5G 麒麟990 4000万超感光徕卡影像双超级快充8GB+128GB亮黑色5G全网通游戏手机&quot;</span><span class="punctuation">,</span></span><br><span class="line">		<span class="attr">&quot;subTitle&quot;</span><span class="punctuation">:</span> <span class="string">&quot;华为mate30pro 黑色,8G,512G&quot;</span><span class="punctuation">,</span></span><br><span class="line">		<span class="attr">&quot;weight&quot;</span><span class="punctuation">:</span> <span class="string">&quot;510&quot;</span><span class="punctuation">,</span></span><br><span class="line">		<span class="attr">&quot;attr_4&quot;</span><span class="punctuation">:</span> <span class="string">&quot;8G&quot;</span><span class="punctuation">,</span></span><br><span class="line">		<span class="attr">&quot;attr_5&quot;</span><span class="punctuation">:</span> <span class="string">&quot;512G&quot;</span><span class="punctuation">,</span></span><br><span class="line">		<span class="attr">&quot;ladderAddOther&quot;</span><span class="punctuation">:</span> <span class="number">1</span><span class="punctuation">,</span></span><br><span class="line">		<span class="attr">&quot;subtitle&quot;</span><span class="punctuation">:</span> <span class="string">&quot;【直降500元！到手价4499元！享12期免息！低至12.3元/天】双4000万徕卡电影四摄；Mate30直降500元享12期》&quot;</span><span class="punctuation">,</span></span><br><span class="line">		<span class="attr">&quot;saleAttrs&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="punctuation">&#123;</span></span><br><span class="line">			<span class="attr">&quot;attrId&quot;</span><span class="punctuation">:</span> <span class="string">&quot;3&quot;</span><span class="punctuation">,</span></span><br><span class="line">			<span class="attr">&quot;attrValue&quot;</span><span class="punctuation">:</span> <span class="string">&quot;黑色&quot;</span></span><br><span class="line">		<span class="punctuation">&#125;</span><span class="punctuation">,</span> <span class="punctuation">&#123;</span></span><br><span class="line">			<span class="attr">&quot;attrId&quot;</span><span class="punctuation">:</span> <span class="string">&quot;4&quot;</span><span class="punctuation">,</span></span><br><span class="line">			<span class="attr">&quot;attrValue&quot;</span><span class="punctuation">:</span> <span class="string">&quot;8G&quot;</span></span><br><span class="line">		<span class="punctuation">&#125;</span><span class="punctuation">,</span> <span class="punctuation">&#123;</span></span><br><span class="line">			<span class="attr">&quot;attrId&quot;</span><span class="punctuation">:</span> <span class="string">&quot;5&quot;</span><span class="punctuation">,</span></span><br><span class="line">			<span class="attr">&quot;attrValue&quot;</span><span class="punctuation">:</span> <span class="string">&quot;512G&quot;</span></span><br><span class="line">		<span class="punctuation">&#125;</span><span class="punctuation">]</span></span><br><span class="line">	<span class="punctuation">&#125;</span><span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<p>由于提交的是json数据，所以只能通过一个对象来进行接收，这就需要咱们来构建一个VO对象。涉及的表肯定也不只spu一张表。</p>
<p>这么复杂的数据结构，我们一层层的剥茧抽丝式的查看：</p>
<h4 id="2-5-2-1-先看json数据的最外层"><a href="#2-5-2-1-先看json数据的最外层" class="headerlink" title="2.5.2.1.   先看json数据的最外层"></a>2.5.2.1.   先看json数据的最外层</h4><p>对应pms_spu表的信息，还多了三个字段：spuImages、baseAttrs、skus。也就是说需要对SpuInfoEntity进行扩展。首选可以确定这三个字段是集合，因为值都有方括号。</p>
<p><img src="/assets/1584718471261.png" alt="1584718471261"></p>
<p>创建SpuVO对象：</p>
<p> <img src="/assets/1584718569421.png" alt="1584718569421"></p>
<p>内容如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * spuInfo扩展对象</span></span><br><span class="line"><span class="comment"> * 包含：spuInfo基本信息、spuImages图片信息、baseAttrs基本属性信息、skus信息</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SpuVO</span> <span class="keyword">extends</span> <span class="title class_">SpuInfoEntity</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 图片信息</span></span><br><span class="line">    <span class="keyword">private</span> List&lt;?&gt; spuImages;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 基本属性信息</span></span><br><span class="line">    <span class="keyword">private</span> List&lt;?&gt; baseAttrs;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// sku信息</span></span><br><span class="line">    <span class="keyword">private</span> List&lt;?&gt; skus;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>接下来就分析这三个集合中，都是什么数据类型的数据。</p>
<h4 id="2-5-2-2-spuImages"><a href="#2-5-2-2-spuImages" class="headerlink" title="2.5.2.2.   spuImages"></a>2.5.2.2.   spuImages</h4><p>首先spuImages很简单，就是字符串数组：</p>
<p><img src="/assets/1567582227035.png" alt="1567582227035"></p>
<p>也就是说，SpuInfoVO对象是这样的：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * spu扩展对象</span></span><br><span class="line"><span class="comment"> * 包含：spu基本信息、spuImages图片信息、baseAttrs基本属性信息、skus信息</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SpuVO</span> <span class="keyword">extends</span> <span class="title class_">SpuInfoEntity</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 图片信息</span></span><br><span class="line">    <span class="keyword">private</span> List&lt;String&gt; spuImages;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 基本属性信息</span></span><br><span class="line">    <span class="keyword">private</span> List&lt;?&gt; baseAttrs;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// sku信息</span></span><br><span class="line">    <span class="keyword">private</span> List&lt;?&gt; skus;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h4 id="2-5-2-3-baseAttrs"><a href="#2-5-2-3-baseAttrs" class="headerlink" title="2.5.2.3.   baseAttrs"></a>2.5.2.3.   baseAttrs</h4><p>对应的表是pms_spu_attr_value，对应的实体类是SpuAttrValueEntity</p>
<p><img src="/assets/1567582744402.png" alt="1567582744402"></p>
<p>注意：attrValue的值在实体类中是String，而传过来时参数名是valueSelected，值为集合类型。</p>
<p>所以，必须扩展SpuAttrValueEntity类：</p>
<p> <img src="/assets/1567584097320.png" alt="1567584097320"></p>
<p>重写setter方法，因为参数接收时的本质是调用setter方法接收的：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SpuAttrValueVo</span> <span class="keyword">extends</span> <span class="title class_">SpuAttrValueEntity</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setValueSelected</span><span class="params">(List&lt;Object&gt; valueSelected)</span>&#123;</span><br><span class="line">        <span class="comment">// 如果接受的集合为空，则不设置</span></span><br><span class="line">        <span class="keyword">if</span> (CollectionUtils.isEmpty(valueSelected))&#123;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">this</span>.setAttrValue(StringUtils.join(valueSelected, <span class="string">&quot;,&quot;</span>));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>现在SpuInfoVO中的第二参数的集合泛型也搞定了：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SpuVo</span> <span class="keyword">extends</span> <span class="title class_">SpuEntity</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 图片信息</span></span><br><span class="line">    <span class="keyword">private</span> List&lt;String&gt; spuImages;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 基本属性信息</span></span><br><span class="line">    <span class="keyword">private</span> List&lt;SpuAttrValueVo&gt; baseAttrs;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// sku信息</span></span><br><span class="line">    <span class="keyword">private</span> List&lt;?&gt; skus;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h4 id="2-5-2-4-skus"><a href="#2-5-2-4-skus" class="headerlink" title="2.5.2.4.   skus"></a>2.5.2.4.   skus</h4><p>一部分字段对应的是pms_sku这张表，对应的实体类是SkuEntity。</p>
<p><img src="/assets/1584719056119.png" alt="1584719056119"></p>
<p>images这个字段保存到pms_sku_images这张表。</p>
<p>一部分字段对应的是sms_sku_bounds表，对应的实体类是gmall-sms服务中的SkuBoundsEntity</p>
<p><img src="/assets/1567585469132.png" alt="1567585469132"></p>
<p>一部分字段对应的表是sms_sku_full_reduction，对应的实体类是gmall-sms微服务中的SkuFullReductionEntity</p>
<p><img src="/assets/1567585679204.png" alt="1567585679204"></p>
<p>一部分字段对应的表是sms_sku_ladder，对应的实体类是gmall-sms微服务的SkuLadderEntity</p>
<p><img src="/assets/1567586094915.png" alt="1567586094915"></p>
<p>最后一个字段就是saleAttrs，对应的是pms_sku_attr_value，实体类是<code>List&lt;SkuAttrValueEntity&gt;</code></p>
<p><img src="/assets/1567586459917.png" alt="1567586459917"></p>
<p>由于java是单继承，所以这里只能选择一个继承，其他的字段在从对应的实体类中copy过来。这里选择扩展SkuEntity这个实体类：（注意：带下划线的字段为垃圾字段，不用接收）</p>
<p> <img src="/assets/1584719555226.png" alt="1584719555226"></p>
<p>内容如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SkuVo</span> <span class="keyword">extends</span> <span class="title class_">SkuEntity</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> List&lt;String&gt; images;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 积分活动</span></span><br><span class="line">    <span class="keyword">private</span> BigDecimal growBounds;</span><br><span class="line">    <span class="keyword">private</span> BigDecimal buyBounds;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 优惠生效情况[1111（四个状态位，从右到左）;</span></span><br><span class="line"><span class="comment">     * 0 - 无优惠，成长积分是否赠送;</span></span><br><span class="line"><span class="comment">     * 1 - 无优惠，购物积分是否赠送;</span></span><br><span class="line"><span class="comment">     * 2 - 有优惠，成长积分是否赠送;</span></span><br><span class="line"><span class="comment">     * 3 - 有优惠，购物积分是否赠送【状态位0：不赠送，1：赠送】]</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> List&lt;Integer&gt; work;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 满减活动</span></span><br><span class="line">    <span class="keyword">private</span> BigDecimal fullPrice;</span><br><span class="line">    <span class="keyword">private</span> BigDecimal reducePrice;</span><br><span class="line">    <span class="keyword">private</span> Integer fullAddOther;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Integer fullCount;</span><br><span class="line">    <span class="keyword">private</span> BigDecimal discount;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 是否叠加其他优惠[0-不可叠加，1-可叠加]</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> Integer addOther;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> List&lt;SkuAttrValueEntity&gt; saleAttrs;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>最终的SpuVO：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SpuVo</span> <span class="keyword">extends</span> <span class="title class_">SpuEntity</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 图片信息</span></span><br><span class="line">    <span class="keyword">private</span> List&lt;String&gt; spuImages;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 基本属性信息</span></span><br><span class="line">    <span class="keyword">private</span> List&lt;SpuAttrValueVo&gt; baseAttrs;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// sku信息</span></span><br><span class="line">    <span class="keyword">private</span> List&lt;SkuVo&gt; skus;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="2-5-3-完成SPU新增功能"><a href="#2-5-3-完成SPU新增功能" class="headerlink" title="2.5.3.   完成SPU新增功能"></a>2.5.3.   完成SPU新增功能</h3><p>SpuController：改造之前的新增方法</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 保存</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line"><span class="meta">@PostMapping</span></span><br><span class="line"><span class="meta">@ApiOperation(&quot;保存&quot;)</span></span><br><span class="line"><span class="keyword">public</span> ResponseVo&lt;Object&gt; <span class="title function_">save</span><span class="params">(<span class="meta">@RequestBody</span> SpuVo spuVo)</span>&#123;</span><br><span class="line">    spuService.bigSave(spuVo);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> ResponseVo.ok();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>SpuService接口添加方法：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">void</span> <span class="title function_">bigSave</span><span class="params">(SpuVo spu)</span>;</span><br></pre></td></tr></table></figure>



<p>SpuServiceImpl实现类实现新增方法：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Autowired</span></span><br><span class="line"><span class="keyword">private</span> SpuDescMapper descMapper;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Autowired</span></span><br><span class="line"><span class="keyword">private</span> SpuAttrValueService baseService;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">bigSave</span><span class="params">(SpuVo spuVo)</span> &#123;</span><br><span class="line">    <span class="comment">/// 1.保存spu相关</span></span><br><span class="line">    <span class="comment">// 1.1. 保存spu基本信息 spu_info</span></span><br><span class="line">    spuVo.setPublishStatus(<span class="number">1</span>); <span class="comment">// 默认是已上架</span></span><br><span class="line">    spuVo.setCreateTime(<span class="keyword">new</span> <span class="title class_">Date</span>());</span><br><span class="line">    spuVo.setUpdateTime(spuVo.getCreateTime()); <span class="comment">// 新增时，更新时间和创建时间一致</span></span><br><span class="line">    <span class="built_in">this</span>.save(spuVo);</span><br><span class="line">    <span class="type">Long</span> <span class="variable">spuId</span> <span class="operator">=</span> spuVo.getId(); <span class="comment">// 获取新增后的spuId</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 1.2. 保存spu的描述信息 spu_info_desc</span></span><br><span class="line">    <span class="type">SpuDescEntity</span> <span class="variable">spuInfoDescEntity</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SpuDescEntity</span>();</span><br><span class="line">    <span class="comment">// 注意：spu_info_desc表的主键是spu_id,需要在实体类中配置该主键不是自增主键</span></span><br><span class="line">    spuInfoDescEntity.setSpuId(spuId);</span><br><span class="line">    <span class="comment">// 把商品的图片描述，保存到spu详情中，图片地址以逗号进行分割</span></span><br><span class="line">    spuInfoDescEntity.setDecript(StringUtils.join(spuVo.getSpuImages(), <span class="string">&quot;,&quot;</span>));</span><br><span class="line">    <span class="built_in">this</span>.descMapper.insert(spuInfoDescEntity);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 1.3. 保存spu的规格参数信息</span></span><br><span class="line">    List&lt;SpuAttrValueVo&gt; baseAttrs = spuVo.getBaseAttrs();</span><br><span class="line">    <span class="keyword">if</span> (!CollectionUtils.isEmpty(baseAttrs)) &#123;</span><br><span class="line">        List&lt;SpuAttrValueEntity&gt; spuAttrValueEntities = baseAttrs.stream().map(spuAttrValueVO -&gt; &#123;</span><br><span class="line">            spuAttrValueVO.setSpuId(spuId);</span><br><span class="line">            spuAttrValueVO.setSort(<span class="number">0</span>);</span><br><span class="line">            <span class="keyword">return</span> spuAttrValueVO;</span><br><span class="line">        &#125;).collect(Collectors.toList());</span><br><span class="line">        <span class="built_in">this</span>.baseService.saveBatch(spuAttrValueEntities);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/// 2. 保存sku相关信息</span></span><br><span class="line">    <span class="comment">// 2.1. 保存sku基本信息</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 2.2. 保存sku图片信息</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 2.3. 保存sku的规格参数（销售属性）</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 3. 保存营销相关信息，需要远程调用gmall-sms</span></span><br><span class="line">    <span class="comment">// 3.1. 积分优惠</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 3.2. 满减优惠</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 3.3. 数量折扣</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p><strong>注意：SpuDescEntity对象的主键需要设置为手动设置，无法手动设置。</strong></p>
<p><img src="/assets/1584722502507.png" alt="1584722502507"></p>
<p>测试效果：3张表的值均可正常插入</p>
<p><img src="/assets/1584722548563.png" alt="1584722548563"></p>
<p><img src="/assets/1584722595999.png" alt="1584722595999"></p>
<p><img src="/assets/1584722625124.png" alt="1584722625124"></p>
<h3 id="2-5-4-完成SKU新增功能"><a href="#2-5-4-完成SKU新增功能" class="headerlink" title="2.5.4.   完成SKU新增功能"></a>2.5.4.   完成SKU新增功能</h3><p>继续完善SpuServiceImpl实现类新增方法：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Autowired</span></span><br><span class="line"><span class="keyword">private</span> SpuDescMapper descMapper;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Autowired</span></span><br><span class="line"><span class="keyword">private</span> SpuAttrValueService baseService;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Autowired</span></span><br><span class="line"><span class="keyword">private</span> SkuMapper skuMapper;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Autowired</span></span><br><span class="line"><span class="keyword">private</span> SkuImagesService skuImagesService;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Autowired</span></span><br><span class="line"><span class="keyword">private</span> SkuAttrValueService skuAttrValueService;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">bigSave</span><span class="params">(SpuVo spuVo)</span> &#123;</span><br><span class="line">    <span class="comment">/// 1.保存spu相关</span></span><br><span class="line">    <span class="comment">// 1.1. 保存spu基本信息 spu_info</span></span><br><span class="line">    spuVo.setPublishStatus(<span class="number">1</span>); <span class="comment">// 默认是已上架</span></span><br><span class="line">    spuVo.setCreateTime(<span class="keyword">new</span> <span class="title class_">Date</span>());</span><br><span class="line">    spuVo.setUpdateTime(spuVo.getCreateTime()); <span class="comment">// 新增时，更新时间和创建时间一致</span></span><br><span class="line">    <span class="built_in">this</span>.save(spuVo);</span><br><span class="line">    <span class="type">Long</span> <span class="variable">spuId</span> <span class="operator">=</span> spuVo.getId(); <span class="comment">// 获取新增后的spuId</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 1.2. 保存spu的描述信息 spu_info_desc</span></span><br><span class="line">    <span class="type">SpuDescEntity</span> <span class="variable">spuInfoDescEntity</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SpuDescEntity</span>();</span><br><span class="line">    <span class="comment">// 注意：spu_info_desc表的主键是spu_id,需要在实体类中配置该主键不是自增主键</span></span><br><span class="line">    spuInfoDescEntity.setSpuId(spuId);</span><br><span class="line">    <span class="comment">// 把商品的图片描述，保存到spu详情中，图片地址以逗号进行分割</span></span><br><span class="line">    spuInfoDescEntity.setDecript(StringUtils.join(spuVo.getSpuImages(), <span class="string">&quot;,&quot;</span>));</span><br><span class="line">    <span class="built_in">this</span>.descMapper.insert(spuInfoDescEntity);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 1.3. 保存spu的规格参数信息</span></span><br><span class="line">    List&lt;SpuAttrValueVo&gt; baseAttrs = spuVo.getBaseAttrs();</span><br><span class="line">    <span class="keyword">if</span> (!CollectionUtils.isEmpty(baseAttrs)) &#123;</span><br><span class="line">        List&lt;SpuAttrValueEntity&gt; spuAttrValueEntities = baseAttrs.stream().map(spuAttrValueVO -&gt; &#123;</span><br><span class="line">            spuAttrValueVO.setSpuId(spuId);</span><br><span class="line">            spuAttrValueVO.setSort(<span class="number">0</span>);</span><br><span class="line">            <span class="keyword">return</span> spuAttrValueVO;</span><br><span class="line">        &#125;).collect(Collectors.toList());</span><br><span class="line">        <span class="built_in">this</span>.baseService.saveBatch(spuAttrValueEntities);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/// 2. 保存sku相关信息</span></span><br><span class="line">    List&lt;SkuVo&gt; skuVos = spuVo.getSkus();</span><br><span class="line">    <span class="keyword">if</span> (CollectionUtils.isEmpty(skuVos))&#123;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    skuVos.forEach(skuVo -&gt; &#123;</span><br><span class="line">        <span class="comment">// 2.1. 保存sku基本信息</span></span><br><span class="line">        <span class="type">SkuEntity</span> <span class="variable">skuEntity</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SkuEntity</span>();</span><br><span class="line">        BeanUtils.copyProperties(skuVo, skuEntity);</span><br><span class="line">        <span class="comment">// 品牌和分类的id需要从spuInfo中获取</span></span><br><span class="line">        skuEntity.setBrandId(spuVo.getBrandId());</span><br><span class="line">        skuEntity.setCatagoryId(spuVo.getCategoryId());</span><br><span class="line">        <span class="comment">// 获取图片列表</span></span><br><span class="line">        List&lt;String&gt; images = skuVo.getImages();</span><br><span class="line">        <span class="comment">// 如果图片列表不为null，则设置默认图片</span></span><br><span class="line">        <span class="keyword">if</span> (!CollectionUtils.isEmpty(images))&#123;</span><br><span class="line">            <span class="comment">// 设置第一张图片作为默认图片</span></span><br><span class="line">            skuEntity.setDefaultImage(skuEntity.getDefaultImage()==<span class="literal">null</span> ? images.get(<span class="number">0</span>) : skuEntity.getDefaultImage());</span><br><span class="line">        &#125;</span><br><span class="line">        skuEntity.setSpuId(spuId);</span><br><span class="line">        <span class="built_in">this</span>.skuMapper.insert(skuEntity);</span><br><span class="line">        <span class="comment">// 获取skuId</span></span><br><span class="line">        <span class="type">Long</span> <span class="variable">skuId</span> <span class="operator">=</span> skuEntity.getId();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 2.2. 保存sku图片信息</span></span><br><span class="line">        <span class="keyword">if</span> (!CollectionUtils.isEmpty(images))&#123;</span><br><span class="line">            <span class="type">String</span> <span class="variable">defaultImage</span> <span class="operator">=</span> images.get(<span class="number">0</span>);</span><br><span class="line">            List&lt;SkuImagesEntity&gt; skuImageses = images.stream().map(image -&gt; &#123;</span><br><span class="line">                <span class="type">SkuImagesEntity</span> <span class="variable">skuImagesEntity</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SkuImagesEntity</span>();</span><br><span class="line">                skuImagesEntity.setDefaultStatus(StringUtils.equals(defaultImage, image) ? <span class="number">1</span> : <span class="number">0</span>);</span><br><span class="line">                skuImagesEntity.setSkuId(skuId);</span><br><span class="line">                skuImagesEntity.setSort(<span class="number">0</span>);</span><br><span class="line">                skuImagesEntity.setUrl(image);</span><br><span class="line">                <span class="keyword">return</span> skuImagesEntity;</span><br><span class="line">            &#125;).collect(Collectors.toList());</span><br><span class="line">            <span class="built_in">this</span>.skuImagesService.saveBatch(skuImageses);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 2.3. 保存sku的规格参数（销售属性）</span></span><br><span class="line">        List&lt;SkuAttrValueEntity&gt; saleAttrs = skuVo.getSaleAttrs();</span><br><span class="line">        saleAttrs.forEach(saleAttr -&gt; &#123;</span><br><span class="line">            <span class="comment">// 设置属性名，需要根据id查询AttrEntity</span></span><br><span class="line">            saleAttr.setSort(<span class="number">0</span>);</span><br><span class="line">            saleAttr.setSkuId(skuId);</span><br><span class="line">        &#125;);</span><br><span class="line">        <span class="built_in">this</span>.skuAttrValueService.saveBatch(saleAttrs);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 3. 保存营销相关信息，需要远程调用gmall-sms</span></span><br><span class="line">        <span class="comment">// 3.1. 积分优惠</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// 3.2. 满减优惠</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// 3.3. 数量折扣</span></span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>测试：sku相关的3张表保存成功</p>
<p><img src="/assets/1584723319043.png" alt="1584723319043"></p>
<p><img src="/assets/1584723350642.png" alt="1584723350642"></p>
<p><img src="/assets/1584723375965.png" alt="1584723375965"></p>
<h3 id="2-5-5-sms提供营销保存接口"><a href="#2-5-5-sms提供营销保存接口" class="headerlink" title="2.5.5.    sms提供营销保存接口"></a>2.5.5.    sms提供营销保存接口</h3><p>SkuVo中剩余没有保存的字段都是营销信息的字段，需要把这些数据传输给营销系统，接下来首先创建一个数据模型</p>
<p>在gmall-sms中添加VO对象</p>
<p> <img src="/assets/1584764077728.png" alt="1584764077728"></p>
<p>内容如下：营销信息 + skuId</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SkuSaleVo</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Long skuId;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 积分活动</span></span><br><span class="line">    <span class="keyword">private</span> BigDecimal growBounds;</span><br><span class="line">    <span class="keyword">private</span> BigDecimal buyBounds;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 优惠生效情况[1111（四个状态位，从右到左）;</span></span><br><span class="line"><span class="comment">     * 0 - 无优惠，成长积分是否赠送;</span></span><br><span class="line"><span class="comment">     * 1 - 无优惠，购物积分是否赠送;</span></span><br><span class="line"><span class="comment">     * 2 - 有优惠，成长积分是否赠送;</span></span><br><span class="line"><span class="comment">     * 3 - 有优惠，购物积分是否赠送【状态位0：不赠送，1：赠送】]</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> List&lt;Integer&gt; work;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 满减活动</span></span><br><span class="line">    <span class="keyword">private</span> BigDecimal fullPrice;</span><br><span class="line">    <span class="keyword">private</span> BigDecimal reducePrice;</span><br><span class="line">    <span class="keyword">private</span> Integer fullAddOther;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Integer fullCount;</span><br><span class="line">    <span class="keyword">private</span> BigDecimal discount;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 是否叠加其他优惠[0-不可叠加，1-可叠加]</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> Integer addOther;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>在SkuBoundsController中添加方法：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ApiOperation(&quot;新增sku的营销信息&quot;)</span></span><br><span class="line"><span class="meta">@PostMapping(&quot;/skusale/save&quot;)</span></span><br><span class="line"><span class="keyword">public</span> ResponseVo&lt;Object&gt; <span class="title function_">saveSkuSaleInfo</span><span class="params">(<span class="meta">@RequestBody</span> SkuSaleVo skuSaleVo)</span>&#123;</span><br><span class="line">    <span class="built_in">this</span>.skuBoundsService.saveSkuSaleInfo(skuSaleVo);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> ResponseVo.ok(<span class="literal">null</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>给SkuBoundsService接口添加方法：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">void</span> <span class="title function_">saveSkuSaleInfo</span><span class="params">(SkuSaleVo skuSaleVo)</span>;</span><br></pre></td></tr></table></figure>



<p>给SkuBoundsServiceImpl实现类添加实现方法：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Autowired</span></span><br><span class="line"><span class="keyword">private</span> SkuFullReductionMapper skuFullReductionMapper;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Autowired</span></span><br><span class="line"><span class="keyword">private</span> SkuLadderMapper skuLadderMapper;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">saveSkuSaleInfo</span><span class="params">(SkuSaleVo skuSaleVo)</span> &#123;</span><br><span class="line">    <span class="comment">// 3.1. 积分优惠</span></span><br><span class="line">    <span class="type">SkuBoundsEntity</span> <span class="variable">skuBoundsEntity</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SkuBoundsEntity</span>();</span><br><span class="line">    BeanUtils.copyProperties(skuSaleVo, skuBoundsEntity);</span><br><span class="line">    <span class="comment">// 数据库保存的是整数0-15，页面绑定是0000-1111</span></span><br><span class="line">    List&lt;Integer&gt; work = skuSaleVo.getWork();</span><br><span class="line">    <span class="keyword">if</span> (!CollectionUtils.isEmpty(work))&#123;</span><br><span class="line">        skuBoundsEntity.setWork(work.get(<span class="number">0</span>) * <span class="number">8</span> + work.get(<span class="number">1</span>) * <span class="number">4</span> + work.get(<span class="number">2</span>) * <span class="number">2</span> + work.get(<span class="number">3</span>));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">this</span>.save(skuBoundsEntity);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 3.2. 满减优惠</span></span><br><span class="line">    <span class="type">SkuFullReductionEntity</span> <span class="variable">skuFullReductionEntity</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SkuFullReductionEntity</span>();</span><br><span class="line">    BeanUtils.copyProperties(skuSaleVo, skuFullReductionEntity);</span><br><span class="line">    skuFullReductionEntity.setAddOther(skuSaleVo.getFullAddOther());</span><br><span class="line">    <span class="built_in">this</span>.skuFullReductionMapper.insert(skuFullReductionEntity);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 3.3. 数量折扣</span></span><br><span class="line">    <span class="type">SkuLadderEntity</span> <span class="variable">skuLadderEntity</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SkuLadderEntity</span>();</span><br><span class="line">    BeanUtils.copyProperties(skuSaleVo, skuLadderEntity);</span><br><span class="line">    <span class="built_in">this</span>.skuLadderMapper.insert(skuLadderEntity);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="2-5-6-pms调用营销保存接口"><a href="#2-5-6-pms调用营销保存接口" class="headerlink" title="2.5.6.   pms调用营销保存接口"></a>2.5.6.   pms调用营销保存接口</h3><p>feign的玩法分以下三步：</p>
<ol>
<li>引入openfeign的启动器，已添加</li>
<li>在引导类上添加@EnableFeignClients</li>
<li>编写feign接口</li>
</ol>
<p>在gmall-pms的引导类（GmallPmsApplication）上添加@EnableFeignClients注解</p>
<p><img src="/assets/1584764490061.png" alt="1584764490061"></p>
<p>添加SkuSaleVo实体类和GmallSmsClient接口</p>
<p> <img src="/assets/1584766226032.png" alt="1584766226032"></p>
<p>SkuSaleVo的内容参照gmall-sms中的SkuSaleVo的内容</p>
<p>GmallSmsClient的内容：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@FeignClient(&quot;sms-service&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">GmallSmsClient</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@PostMapping(&quot;/sms/skubounds/skusale/save&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> ResponseVo&lt;Object&gt; <span class="title function_">saveSkuSaleInfo</span><span class="params">(<span class="meta">@RequestBody</span> SkuSaleVo skuSaleVo)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>完成商品新增：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Autowired</span></span><br><span class="line"><span class="keyword">private</span> SpuDescMapper descMapper;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Autowired</span></span><br><span class="line"><span class="keyword">private</span> SpuAttrValueService baseService;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Autowired</span></span><br><span class="line"><span class="keyword">private</span> SkuMapper skuMapper;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Autowired</span></span><br><span class="line"><span class="keyword">private</span> SkuImagesService skuImagesService;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Autowired</span></span><br><span class="line"><span class="keyword">private</span> SkuAttrValueService skuAttrValueService;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Autowired</span></span><br><span class="line"><span class="keyword">private</span> GmallSmsClient smsClient;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">bigSave</span><span class="params">(SpuVo spuVo)</span> &#123;</span><br><span class="line">    <span class="comment">/// 1.保存spu相关</span></span><br><span class="line">    <span class="comment">// 1.1. 保存spu基本信息 spu_info</span></span><br><span class="line">    <span class="type">Long</span> <span class="variable">spuId</span> <span class="operator">=</span> saveSpu(spuVo);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 1.2. 保存spu的描述信息 spu_info_desc</span></span><br><span class="line">    saveSpuDesc(spuVo, spuId);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 1.3. 保存spu的规格参数信息</span></span><br><span class="line">    saveBaseAttr(spuVo, spuId);</span><br><span class="line"></span><br><span class="line">    <span class="comment">/// 2. 保存sku相关信息</span></span><br><span class="line">    saveSku(spuVo, spuId);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">saveSku</span><span class="params">(SpuVo spuVo, Long spuId)</span> &#123;</span><br><span class="line">    List&lt;SkuVo&gt; skuVos = spuVo.getSkus();</span><br><span class="line">    <span class="keyword">if</span> (CollectionUtils.isEmpty(skuVos))&#123;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    skuVos.forEach(skuVo -&gt; &#123;</span><br><span class="line">        <span class="comment">// 2.1. 保存sku基本信息</span></span><br><span class="line">        <span class="type">SkuEntity</span> <span class="variable">skuEntity</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SkuEntity</span>();</span><br><span class="line">        BeanUtils.copyProperties(skuVo, skuEntity);</span><br><span class="line">        <span class="comment">// 品牌和分类的id需要从spuInfo中获取</span></span><br><span class="line">        skuEntity.setBrandId(spuVo.getBrandId());</span><br><span class="line">        skuEntity.setCatagoryId(spuVo.getCategoryId());</span><br><span class="line">        <span class="comment">// 获取图片列表</span></span><br><span class="line">        List&lt;String&gt; images = skuVo.getImages();</span><br><span class="line">        <span class="comment">// 如果图片列表不为null，则设置默认图片</span></span><br><span class="line">        <span class="keyword">if</span> (!CollectionUtils.isEmpty(images))&#123;</span><br><span class="line">            <span class="comment">// 设置第一张图片作为默认图片</span></span><br><span class="line">            skuEntity.setDefaultImage(skuEntity.getDefaultImage()==<span class="literal">null</span> ? images.get(<span class="number">0</span>) : skuEntity.getDefaultImage());</span><br><span class="line">        &#125;</span><br><span class="line">        skuEntity.setSpuId(spuId);</span><br><span class="line">        <span class="built_in">this</span>.skuMapper.insert(skuEntity);</span><br><span class="line">        <span class="comment">// 获取skuId</span></span><br><span class="line">        <span class="type">Long</span> <span class="variable">skuId</span> <span class="operator">=</span> skuEntity.getId();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 2.2. 保存sku图片信息</span></span><br><span class="line">        <span class="keyword">if</span> (!CollectionUtils.isEmpty(images))&#123;</span><br><span class="line">            <span class="type">String</span> <span class="variable">defaultImage</span> <span class="operator">=</span> images.get(<span class="number">0</span>);</span><br><span class="line">            List&lt;SkuImagesEntity&gt; skuImageses = images.stream().map(image -&gt; &#123;</span><br><span class="line">                <span class="type">SkuImagesEntity</span> <span class="variable">skuImagesEntity</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SkuImagesEntity</span>();</span><br><span class="line">                skuImagesEntity.setDefaultStatus(StringUtils.equals(defaultImage, image) ? <span class="number">1</span> : <span class="number">0</span>);</span><br><span class="line">                skuImagesEntity.setSkuId(skuId);</span><br><span class="line">                skuImagesEntity.setSort(<span class="number">0</span>);</span><br><span class="line">                skuImagesEntity.setUrl(image);</span><br><span class="line">                <span class="keyword">return</span> skuImagesEntity;</span><br><span class="line">            &#125;).collect(Collectors.toList());</span><br><span class="line">            <span class="built_in">this</span>.skuImagesService.saveBatch(skuImageses);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 2.3. 保存sku的规格参数（销售属性）</span></span><br><span class="line">        List&lt;SkuAttrValueEntity&gt; saleAttrs = skuVo.getSaleAttrs();</span><br><span class="line">        saleAttrs.forEach(saleAttr -&gt; &#123;</span><br><span class="line">            <span class="comment">// 设置属性名，需要根据id查询AttrEntity</span></span><br><span class="line">            saleAttr.setSort(<span class="number">0</span>);</span><br><span class="line">            saleAttr.setSkuId(skuId);</span><br><span class="line">        &#125;);</span><br><span class="line">        <span class="built_in">this</span>.skuAttrValueService.saveBatch(saleAttrs);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 3. 保存营销相关信息，需要远程调用gmall-sms</span></span><br><span class="line">        <span class="type">SkuSaleVo</span> <span class="variable">skuSaleVo</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SkuSaleVo</span>();</span><br><span class="line">        BeanUtils.copyProperties(skuVo, skuSaleVo);</span><br><span class="line">        skuSaleVo.setSkuId(skuId);</span><br><span class="line">        <span class="built_in">this</span>.smsClient.saveSkuSaleInfo(skuSaleVo);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">saveBaseAttr</span><span class="params">(SpuVo spuVo, Long spuId)</span> &#123;</span><br><span class="line">    List&lt;SpuAttrValueVo&gt; baseAttrs = spuVo.getBaseAttrs();</span><br><span class="line">    <span class="keyword">if</span> (!CollectionUtils.isEmpty(baseAttrs)) &#123;</span><br><span class="line">        List&lt;SpuAttrValueEntity&gt; spuAttrValueEntities = baseAttrs.stream().map(spuAttrValueVO -&gt; &#123;</span><br><span class="line">            spuAttrValueVO.setSpuId(spuId);</span><br><span class="line">            spuAttrValueVO.setSort(<span class="number">0</span>);</span><br><span class="line">            <span class="keyword">return</span> spuAttrValueVO;</span><br><span class="line">        &#125;).collect(Collectors.toList());</span><br><span class="line">        <span class="built_in">this</span>.baseService.saveBatch(spuAttrValueEntities);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">saveSpuDesc</span><span class="params">(SpuVo spuVo, Long spuId)</span> &#123;</span><br><span class="line">    <span class="type">SpuDescEntity</span> <span class="variable">spuInfoDescEntity</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SpuDescEntity</span>();</span><br><span class="line">    <span class="comment">// 注意：spu_info_desc表的主键是spu_id,需要在实体类中配置该主键不是自增主键</span></span><br><span class="line">    spuInfoDescEntity.setSpuId(spuId);</span><br><span class="line">    <span class="comment">// 把商品的图片描述，保存到spu详情中，图片地址以逗号进行分割</span></span><br><span class="line">    spuInfoDescEntity.setDecript(StringUtils.join(spuVo.getSpuImages(), <span class="string">&quot;,&quot;</span>));</span><br><span class="line">    <span class="built_in">this</span>.descMapper.insert(spuInfoDescEntity);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> Long <span class="title function_">saveSpu</span><span class="params">(SpuVo spuVo)</span> &#123;</span><br><span class="line">    spuVo.setPublishStatus(<span class="number">1</span>); <span class="comment">// 默认是已上架</span></span><br><span class="line">    spuVo.setCreateTime(<span class="keyword">new</span> <span class="title class_">Date</span>());</span><br><span class="line">    spuVo.setUpdateTime(spuVo.getCreateTime()); <span class="comment">// 新增时，更新时间和创建时间一致</span></span><br><span class="line">    <span class="built_in">this</span>.save(spuVo);</span><br><span class="line">    <span class="keyword">return</span> spuVo.getId();</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h1 id="3-feign的最佳实践"><a href="#3-feign的最佳实践" class="headerlink" title="3. feign的最佳实践"></a>3. feign的最佳实践</h1><p><img src="/assets/1584766480880.png" alt="1584766480880"></p>
<p>以上的这些代码直接从营销微服务中拷贝而来，完全一致。差别就是没有方法的具体实现。大家觉得这样有没有问题？</p>
<p>而FeignClient代码遵循SpringMVC的风格，因此与商品微服务的Controller完全一致。这样就存在一定的问题：</p>
<ul>
<li>代码冗余。尽管不用写实现，只是写接口，但服务调用方要写与服务controller一致的代码，有几个消费者就要写几次。另外DTO对象，在每个需要feign的工程里面都要维护一份。</li>
<li>增加开发成本。调用方还得清楚知道接口的路径，才能编写正确的FeignClient。</li>
</ul>
<p>解决方案：</p>
<ul>
<li>我们的服务提供方不仅提供实体类，还要提供api接口声明</li>
<li>调用方不用自己编写接口方法声明，直接继承提供方给的Api接口即可</li>
</ul>
<p>第一步：服务的提供方在<code>gmall-sms-interface</code>中提供API接口，并编写接口声明：</p>
<p>第二步：在调用方<code>gmall-pms</code>中编写FeignClient，但不要写方法声明了，直接继承<code>gmall-sms-interface</code>提供的api接口：</p>
<h2 id="3-1-服务提供方添加接口工程"><a href="#3-1-服务提供方添加接口工程" class="headerlink" title="3.1.   服务提供方添加接口工程"></a>3.1.   服务提供方添加接口工程</h2><p>服务提供方需要创建接口工程：</p>
<p><img src="/assets/1567616497727.png" alt="1567616497727"></p>
<p><img src="/assets/1567616540202.png" alt="1567616540202"></p>
<p><img src="/assets/1567616575235.png" alt="1567616575235"></p>
<p>工程结构如下：</p>
<p> <img src="/assets/1584766903411.png" alt="1584766903411"></p>
<p>pom.xml中的内容：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">project</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">parent</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>gmall<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.atguigu<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>0.0.1-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">parent</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">modelVersion</span>&gt;</span>4.0.0<span class="tag">&lt;/<span class="name">modelVersion</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>gmall-sms-interface<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.atguigu<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>gmall-common<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>0.0.1-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-webmvc<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>5.2.4.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br></pre></td></tr></table></figure>



<p>SkuSaleVo的内容跟之前没有变化，只是移动到接口工程了</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SkuSaleVO</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> Long skuId;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 积分活动</span></span><br><span class="line">    <span class="keyword">private</span> BigDecimal growBounds;</span><br><span class="line">    <span class="keyword">private</span> BigDecimal buyBounds;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 优惠生效情况[1111（四个状态位，从右到左）;</span></span><br><span class="line"><span class="comment">     * 0 - 无优惠，成长积分是否赠送;</span></span><br><span class="line"><span class="comment">     * 1 - 无优惠，购物积分是否赠送;</span></span><br><span class="line"><span class="comment">     * 2 - 有优惠，成长积分是否赠送;</span></span><br><span class="line"><span class="comment">     * 3 - 有优惠，购物积分是否赠送【状态位0：不赠送，1：赠送】]</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> List&lt;Integer&gt; work;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 满减活动</span></span><br><span class="line">    <span class="keyword">private</span> BigDecimal fullPrice;</span><br><span class="line">    <span class="keyword">private</span> BigDecimal reducePrice;</span><br><span class="line">    <span class="keyword">private</span> Integer fullAddOther;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Integer fullCount;</span><br><span class="line">    <span class="keyword">private</span> BigDecimal discount;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 是否叠加其他优惠[0-不可叠加，1-可叠加]</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> Integer addOther;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>SkuSaleApi接口：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">GmallSmsApi</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@PostMapping(&quot;/sms/skubounds/skusale/save&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> Resp&lt;Object&gt; <span class="title function_">saveSkuSaleInfo</span><span class="params">(<span class="meta">@RequestBody</span> SkuSaleVO skuSaleVO)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h2 id="3-2-服务提供方微服务"><a href="#3-2-服务提供方微服务" class="headerlink" title="3.2.   服务提供方微服务"></a>3.2.   服务提供方微服务</h2><p>只要引入接口工程，重新到一下包即可</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.atguigu<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>gmall-sms-interface<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>0.0.1-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>之前微服务中定义的Vo可以删掉了：</p>
<p> <img src="/assets/1567617868566.png" alt="1567617868566"></p>
<h2 id="3-3-服务消费方"><a href="#3-3-服务消费方" class="headerlink" title="3.3.   服务消费方"></a>3.3.   服务消费方</h2><p> <img src="/assets/1584767441863.png" alt="1584767441863"></p>
<p>也需要依赖营销的接口工程即可：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.atguigu<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>gmall-sms-interface<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>0.0.1-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>也不需要自己定义Vo了，另外GmallSmsClient内容变的及其简单：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@FeignClient(&quot;sms-service&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">GmallSmsClient</span> <span class="keyword">extends</span> <span class="title class_">GmallSmsApi</span> &#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h2 id="3-4-小结"><a href="#3-4-小结" class="headerlink" title="3.4.   小结"></a>3.4.   小结</h2><p><img src="/assets/1567618674250.png" alt="1567618674250"></p>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta"><i class="fas fa-circle-user fa-fw"></i>文章作者: </span><span class="post-copyright-info"><a href="https://beiliu266.github.io">John Doe</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta"><i class="fas fa-square-arrow-up-right fa-fw"></i>文章链接: </span><span class="post-copyright-info"><a href="https://beiliu266.github.io/2024/01/09/guli/3%E3%80%81%E8%A7%84%E6%A0%BC%E5%8F%82%E6%95%B0%E5%8F%8A%E5%95%86%E5%93%81%E6%96%B0%E5%A2%9E/">https://beiliu266.github.io/2024/01/09/guli/3%E3%80%81%E8%A7%84%E6%A0%BC%E5%8F%82%E6%95%B0%E5%8F%8A%E5%95%86%E5%93%81%E6%96%B0%E5%A2%9E/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta"><i class="fas fa-circle-exclamation fa-fw"></i>版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="https://beiliu266.github.io" target="_blank">Hexo</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"></div><div class="post_share"><div class="social-share" data-image="https://i.loli.net/2021/02/24/5O1day2nriDzjSu.png" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/2024/01/09/guli/4%E3%80%81%E6%9C%AC%E5%9C%B0%E4%BA%8B%E5%8A%A1%E3%80%81%E5%88%86%E5%B8%83%E5%BC%8F%E4%BA%8B%E5%8A%A1%E5%8F%8Aseata/" title=""><div class="cover" style="background: var(--default-bg-color)"></div><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info"></div></div></a></div><div class="next-post pull-right"><a href="/2024/01/09/guli/2%E3%80%81%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA%E3%80%81%E5%9F%9F%E5%90%8D%E3%80%81CORS%E3%80%81OSS/" title=""><div class="cover" style="background: var(--default-bg-color)"></div><div class="pagination-info"><div class="label">下一篇</div><div class="next_info"></div></div></a></div></nav></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src="https://i.loli.net/2021/02/24/5O1day2nriDzjSu.png" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__name">John Doe</div><div class="author-info__description"></div></div><div class="card-info-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">28</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">0</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">0</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/xxxxxx"><i class="fab fa-github"></i><span>Follow Me</span></a></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>公告</span></div><div class="announcement_content">This is my Blog</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#title-%E8%A7%84%E6%A0%BC%E5%8F%82%E6%95%B0%E5%8F%8A%E5%95%86%E5%93%81%E6%96%B0%E5%A2%9E"><span class="toc-number">1.</span> <span class="toc-text">title:规格参数及商品新增</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%95%86%E5%93%81%E7%B3%BB%E7%BB%9F%E6%8E%A5%E5%8F%A3"><span class="toc-number"></span> <span class="toc-text">商品系统接口</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#1-%E5%95%86%E5%93%81%E5%88%86%E7%B1%BB"><span class="toc-number"></span> <span class="toc-text">1. 商品分类</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-1-CategoryController"><span class="toc-number">1.</span> <span class="toc-text">1.1.   CategoryController</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#1-2-CategoryService"><span class="toc-number">2.</span> <span class="toc-text">1.2.   CategoryService</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#1-3-%E9%87%8D%E5%90%AF%E6%B5%8B%E8%AF%95"><span class="toc-number">3.</span> <span class="toc-text">1.3.   重启测试</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#1-4-%E6%A0%B9%E6%8D%AE%E7%88%B6%E8%8A%82%E7%82%B9%E6%9F%A5%E8%AF%A2"><span class="toc-number">4.</span> <span class="toc-text">1.4.  根据父节点查询</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#2-%E5%95%86%E5%93%81%E4%BF%A1%E6%81%AF"><span class="toc-number"></span> <span class="toc-text">2. 商品信息</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#2-1-SPU%E5%92%8CSKU%E8%AE%BE%E8%AE%A1"><span class="toc-number">1.</span> <span class="toc-text">2.1.   SPU和SKU设计</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-2-%E8%A7%84%E6%A0%BC%E5%8F%82%E6%95%B0%E8%AE%BE%E8%AE%A1"><span class="toc-number">2.</span> <span class="toc-text">2.2.   规格参数设计</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-3-%E8%A7%84%E6%A0%BC%E5%B1%9E%E6%80%A7%E6%9F%A5%E8%AF%A2"><span class="toc-number">3.</span> <span class="toc-text">2.3.   规格属性查询</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#2-3-1-%E6%9F%A5%E8%AF%A2%E8%A7%84%E6%A0%BC%E5%88%86%E7%BB%84"><span class="toc-number">3.1.</span> <span class="toc-text">2.3.1.   查询规格分组</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-3-2-%E6%9F%A5%E8%AF%A2%E5%88%86%E7%BB%84%E4%B8%8B%E7%9A%84%E8%A7%84%E6%A0%BC%E5%8F%82%E6%95%B0"><span class="toc-number">3.2.</span> <span class="toc-text">2.3.2.   查询分组下的规格参数</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-4-%E5%95%86%E5%93%81%E6%9F%A5%E8%AF%A2"><span class="toc-number">4.</span> <span class="toc-text">2.4.   商品查询</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#2-4-1-%E6%9F%A5%E8%AF%A2%E5%95%86%E5%93%81%E5%88%97%E8%A1%A8"><span class="toc-number">4.1.</span> <span class="toc-text">2.4.1.   查询商品列表</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-4-2-%E6%9F%A5%E8%AF%A2SPU%E4%B8%8B%E7%9A%84SKU"><span class="toc-number">4.2.</span> <span class="toc-text">2.4.2.   查询SPU下的SKU</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-4-3-%E6%9F%A5%E8%AF%A2SKU%E7%9A%84%E5%BA%93%E5%AD%98%E4%BF%A1%E6%81%AF"><span class="toc-number">4.3.</span> <span class="toc-text">2.4.3.   查询SKU的库存信息</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-5-%E5%95%86%E5%93%81%E6%96%B0%E5%A2%9E"><span class="toc-number">5.</span> <span class="toc-text">2.5.   商品新增</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#2-5-1-%E6%9F%A5%E8%AF%A2%E5%88%86%E7%B1%BB%E4%B8%8B%E7%9A%84%E5%88%86%E7%BB%84%E5%8F%8A%E5%85%B6%E8%A7%84%E6%A0%BC%E5%8F%82%E6%95%B0"><span class="toc-number">5.1.</span> <span class="toc-text">2.5.1.    查询分类下的分组及其规格参数</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-5-2-%E6%9F%A5%E8%AF%A2%E5%88%86%E7%B1%BB%E4%B8%8B%E7%9A%84%E9%94%80%E5%94%AE%E5%B1%9E%E6%80%A7"><span class="toc-number">5.2.</span> <span class="toc-text">2.5.2. 查询分类下的销售属性</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-5-3-%E4%B8%BA%E9%A1%B5%E9%9D%A2%E6%8F%90%E4%BA%A4%E7%9A%84%E6%95%B0%E6%8D%AE%E6%9E%84%E5%BB%BA%E6%95%B0%E6%8D%AE%E6%A8%A1%E5%9E%8B"><span class="toc-number">5.3.</span> <span class="toc-text">2.5.3. 为页面提交的数据构建数据模型</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#2-5-2-1-%E5%85%88%E7%9C%8Bjson%E6%95%B0%E6%8D%AE%E7%9A%84%E6%9C%80%E5%A4%96%E5%B1%82"><span class="toc-number">5.3.1.</span> <span class="toc-text">2.5.2.1.   先看json数据的最外层</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-5-2-2-spuImages"><span class="toc-number">5.3.2.</span> <span class="toc-text">2.5.2.2.   spuImages</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-5-2-3-baseAttrs"><span class="toc-number">5.3.3.</span> <span class="toc-text">2.5.2.3.   baseAttrs</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-5-2-4-skus"><span class="toc-number">5.3.4.</span> <span class="toc-text">2.5.2.4.   skus</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-5-3-%E5%AE%8C%E6%88%90SPU%E6%96%B0%E5%A2%9E%E5%8A%9F%E8%83%BD"><span class="toc-number">5.4.</span> <span class="toc-text">2.5.3.   完成SPU新增功能</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-5-4-%E5%AE%8C%E6%88%90SKU%E6%96%B0%E5%A2%9E%E5%8A%9F%E8%83%BD"><span class="toc-number">5.5.</span> <span class="toc-text">2.5.4.   完成SKU新增功能</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-5-5-sms%E6%8F%90%E4%BE%9B%E8%90%A5%E9%94%80%E4%BF%9D%E5%AD%98%E6%8E%A5%E5%8F%A3"><span class="toc-number">5.6.</span> <span class="toc-text">2.5.5.    sms提供营销保存接口</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-5-6-pms%E8%B0%83%E7%94%A8%E8%90%A5%E9%94%80%E4%BF%9D%E5%AD%98%E6%8E%A5%E5%8F%A3"><span class="toc-number">5.7.</span> <span class="toc-text">2.5.6.   pms调用营销保存接口</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#3-feign%E7%9A%84%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5"><span class="toc-number"></span> <span class="toc-text">3. feign的最佳实践</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#3-1-%E6%9C%8D%E5%8A%A1%E6%8F%90%E4%BE%9B%E6%96%B9%E6%B7%BB%E5%8A%A0%E6%8E%A5%E5%8F%A3%E5%B7%A5%E7%A8%8B"><span class="toc-number">1.</span> <span class="toc-text">3.1.   服务提供方添加接口工程</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-2-%E6%9C%8D%E5%8A%A1%E6%8F%90%E4%BE%9B%E6%96%B9%E5%BE%AE%E6%9C%8D%E5%8A%A1"><span class="toc-number">2.</span> <span class="toc-text">3.2.   服务提供方微服务</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-3-%E6%9C%8D%E5%8A%A1%E6%B6%88%E8%B4%B9%E6%96%B9"><span class="toc-number">3.</span> <span class="toc-text">3.3.   服务消费方</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-4-%E5%B0%8F%E7%BB%93"><span class="toc-number">4.</span> <span class="toc-text">3.4.   小结</span></a></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2024/01/09/guli/k8s%E5%BF%AB%E9%80%9F%E5%85%A5%E9%97%A8/" title="无题">无题</a><time datetime="2024-01-09T12:30:18.811Z" title="发表于 2024-01-09 20:30:18">2024-01-09</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2024/01/09/guli/14%E3%80%81%E6%94%AF%E4%BB%98%E3%80%81%E7%A7%92%E6%9D%80/" title="无题">无题</a><time datetime="2024-01-09T12:30:18.807Z" title="发表于 2024-01-09 20:30:18">2024-01-09</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2024/01/09/guli/12%E3%80%81%E8%B4%AD%E7%89%A9%E8%BD%A6%E3%80%81SpringTask/" title="无题">无题</a><time datetime="2024-01-09T12:30:18.807Z" title="发表于 2024-01-09 20:30:18">2024-01-09</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2024/01/09/guli/13%E3%80%81%E8%AE%A2%E5%8D%95%E3%80%81%E5%BA%93%E5%AD%98/" title="无题">无题</a><time datetime="2024-01-09T12:30:18.807Z" title="发表于 2024-01-09 20:30:18">2024-01-09</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2024/01/09/guli/es%E5%85%A5%E9%97%A8/" title="无题">无题</a><time datetime="2024-01-09T12:30:18.807Z" title="发表于 2024-01-09 20:30:18">2024-01-09</time></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div class="copyright">&copy;2020 - 2024 By John Doe</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="回到顶部"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox/fancybox.umd.min.js"></script><div class="js-pjax"></div><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div><script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"log":false,"pluginJsPath":"lib/","pluginModelPath":"assets/","pluginRootPath":"live2dw/","tagMode":false});</script></body></html>